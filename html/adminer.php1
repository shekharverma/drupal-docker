<?php
/** Adminer - Compact database management
* @link https://www.adminer.org/
* @author Jakub Vrana, https://www.vrana.cz/
* @copyright 2007 Jakub Vrana
* @license https://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0
* @license https://www.gnu.org/licenses/gpl-2.0.html GNU General Public License, version 2 (one or other)
* @version 4.7.1
*/error_reporting(6135);$tc=!preg_match('~^(unsafe_raw)?$~',ini_get("filter.default"));if($tc||ini_get("filter.default_flags")){foreach(array('_GET','_POST','_COOKIE','_SERVER')as$X){$Zg=filter_input_array(constant("INPUT$X"),FILTER_UNSAFE_RAW);if($Zg)$$X=$Zg;}}if(function_exists("mb_internal_encoding"))mb_internal_encoding("8bit");function
connection(){global$f;return$f;}function
adminer(){global$b;return$b;}function
version(){global$ga;return$ga;}function
idf_unescape($v){$sd=substr($v,-1);return
str_replace($sd.$sd,$sd,substr($v,1,-1));}function
escape_string($X){return
substr(q($X),1,-1);}function
number($X){return
preg_replace('~[^0-9]+~','',$X);}function
number_type(){return'((?<!o)int(?!er)|numeric|real|float|double|decimal|money)';}function
remove_slashes($ef,$tc=false){if(get_magic_quotes_gpc()){while(list($z,$X)=each($ef)){foreach($X
as$kd=>$W){unset($ef[$z][$kd]);if(is_array($W)){$ef[$z][stripslashes($kd)]=$W;$ef[]=&$ef[$z][stripslashes($kd)];}else$ef[$z][stripslashes($kd)]=($tc?$W:stripslashes($W));}}}}function
bracket_escape($v,$Aa=false){static$Mg=array(':'=>':1',']'=>':2','['=>':3','"'=>':4');return
strtr($v,($Aa?array_flip($Mg):$Mg));}function
min_version($nh,$Ed="",$g=null){global$f;if(!$g)$g=$f;$Mf=$g->server_info;if($Ed&&preg_match('~([\d.]+)-MariaDB~',$Mf,$C)){$Mf=$C[1];$nh=$Ed;}return(version_compare($Mf,$nh)>=0);}function
charset($f){return(min_version("5.5.3",0,$f)?"utf8mb4":"utf8");}function
script($Vf,$Lg="\n"){return"<script".nonce().">$Vf</script>$Lg";}function
script_src($eh){return"<script src='".h($eh)."'".nonce()."></script>\n";}function
nonce(){return' nonce="'.get_nonce().'"';}function
target_blank(){return' target="_blank" rel="noreferrer noopener"';}function
h($fg){return
str_replace("\0","&#0;",htmlspecialchars($fg,ENT_QUOTES,'utf-8'));}function
nl_br($fg){return
str_replace("\n","<br>",$fg);}function
checkbox($E,$Y,$Oa,$od="",$oe="",$Sa="",$pd=""){$K="<input type='checkbox' name='$E' value='".h($Y)."'".($Oa?" checked":"").($pd?" aria-labelledby='$pd'":"").">".($oe?script("qsl('input').onclick = function () { $oe };",""):"");return($od!=""||$Sa?"<label".($Sa?" class='$Sa'":"").">$K".h($od)."</label>":$K);}function
optionlist($se,$Hf=null,$hh=false){$K="";foreach($se
as$kd=>$W){$te=array($kd=>$W);if(is_array($W)){$K.='<optgroup label="'.h($kd).'">';$te=$W;}foreach($te
as$z=>$X)$K.='<option'.($hh||is_string($z)?' value="'.h($z).'"':'').(($hh||is_string($z)?(string)$z:$X)===$Hf?' selected':'').'>'.h($X);if(is_array($W))$K.='</optgroup>';}return$K;}function
html_select($E,$se,$Y="",$ne=true,$pd=""){if($ne)return"<select name='".h($E)."'".($pd?" aria-labelledby='$pd'":"").">".optionlist($se,$Y)."</select>".(is_string($ne)?script("qsl('select').onchange = function () { $ne };",""):"");$K="";foreach($se
as$z=>$X)$K.="<label><input type='radio' name='".h($E)."' value='".h($z)."'".($z==$Y?" checked":"").">".h($X)."</label>";return$K;}function
select_input($xa,$se,$Y="",$ne="",$Re=""){$ug=($se?"select":"input");return"<$ug$xa".($se?"><option value=''>$Re".optionlist($se,$Y,true)."</select>":" size='10' value='".h($Y)."' placeholder='$Re'>").($ne?script("qsl('$ug').onchange = $ne;",""):"");}function
confirm($D="",$If="qsl('input')"){return
script("$If.onclick = function () { return confirm('".($D?js_escape($D):lang(0))."'); };","");}function
print_fieldset($u,$xd,$qh=false){echo"<fieldset><legend>","<a href='#fieldset-$u'>$xd</a>",script("qsl('a').onclick = partial(toggle, 'fieldset-$u');",""),"</legend>","<div id='fieldset-$u'".($qh?"":" class='hidden'").">\n";}function
bold($Ha,$Sa=""){return($Ha?" class='active $Sa'":($Sa?" class='$Sa'":""));}function
odd($K=' class="odd"'){static$t=0;if(!$K)$t=-1;return($t++%2?$K:'');}function
js_escape($fg){return
addcslashes($fg,"\r\n'\\/");}function
json_row($z,$X=null){static$uc=true;if($uc)echo"{";if($z!=""){echo($uc?"":",")."\n\t\"".addcslashes($z,"\r\n\t\"\\/").'": '.($X!==null?'"'.addcslashes($X,"\r\n\"\\/").'"':'null');$uc=false;}else{echo"\n}\n";$uc=true;}}function
ini_bool($Yc){$X=ini_get($Yc);return(preg_match('~^(on|true|yes)$~i',$X)||(int)$X);}function
sid(){static$K;if($K===null)$K=(SID&&!($_COOKIE&&ini_bool("session.use_cookies")));return$K;}function
set_password($mh,$O,$V,$G){$_SESSION["pwds"][$mh][$O][$V]=($_COOKIE["adminer_key"]&&is_string($G)?array(encrypt_string($G,$_COOKIE["adminer_key"])):$G);}function
get_password(){$K=get_session("pwds");if(is_array($K))$K=($_COOKIE["adminer_key"]?decrypt_string($K[0],$_COOKIE["adminer_key"]):false);return$K;}function
q($fg){global$f;return$f->quote($fg);}function
get_vals($I,$c=0){global$f;$K=array();$J=$f->query($I);if(is_object($J)){while($L=$J->fetch_row())$K[]=$L[$c];}return$K;}function
get_key_vals($I,$g=null,$Pf=true){global$f;if(!is_object($g))$g=$f;$K=array();$J=$g->query($I);if(is_object($J)){while($L=$J->fetch_row()){if($Pf)$K[$L[0]]=$L[1];else$K[]=$L[0];}}return$K;}function
get_rows($I,$g=null,$l="<p class='error'>"){global$f;$eb=(is_object($g)?$g:$f);$K=array();$J=$eb->query($I);if(is_object($J)){while($L=$J->fetch_assoc())$K[]=$L;}elseif(!$J&&!is_object($g)&&$l&&defined("PAGE_HEADER"))echo$l.error()."\n";return$K;}function
unique_array($L,$x){foreach($x
as$w){if(preg_match("~PRIMARY|UNIQUE~",$w["type"])){$K=array();foreach($w["columns"]as$z){if(!isset($L[$z]))continue
2;$K[$z]=$L[$z];}return$K;}}}function
escape_key($z){if(preg_match('(^([\w(]+)('.str_replace("_",".*",preg_quote(idf_escape("_"))).')([ \w)]+)$)',$z,$C))return$C[1].idf_escape(idf_unescape($C[2])).$C[3];return
idf_escape($z);}function
where($Z,$n=array()){global$f,$y;$K=array();foreach((array)$Z["where"]as$z=>$X){$z=bracket_escape($z,1);$c=escape_key($z);$K[]=$c.($y=="sql"&&preg_match('~^[0-9]*\.[0-9]*$~',$X)?" LIKE ".q(addcslashes($X,"%_\\")):($y=="mssql"?" LIKE ".q(preg_replace('~[_%[]~','[\0]',$X)):" = ".unconvert_field($n[$z],q($X))));if($y=="sql"&&preg_match('~char|text~',$n[$z]["type"])&&preg_match("~[^ -@]~",$X))$K[]="$c = ".q($X)." COLLATE ".charset($f)."_bin";}foreach((array)$Z["null"]as$z)$K[]=escape_key($z)." IS NULL";return
implode(" AND ",$K);}function
where_check($X,$n=array()){parse_str($X,$Na);remove_slashes(array(&$Na));return
where($Na,$n);}function
where_link($t,$c,$Y,$pe="="){return"&where%5B$t%5D%5Bcol%5D=".urlencode($c)."&where%5B$t%5D%5Bop%5D=".urlencode(($Y!==null?$pe:"IS NULL"))."&where%5B$t%5D%5Bval%5D=".urlencode($Y);}function
convert_fields($d,$n,$N=array()){$K="";foreach($d
as$z=>$X){if($N&&!in_array(idf_escape($z),$N))continue;$va=convert_field($n[$z]);if($va)$K.=", $va AS ".idf_escape($z);}return$K;}function
cookie($E,$Y,$_d=2592000){global$ba;return
header("Set-Cookie: $E=".urlencode($Y).($_d?"; expires=".gmdate("D, d M Y H:i:s",time()+$_d)." GMT":"")."; path=".preg_replace('~\?.*~','',$_SERVER["REQUEST_URI"]).($ba?"; secure":"")."; HttpOnly; SameSite=lax",false);}function
restart_session(){if(!ini_bool("session.use_cookies"))session_start();}function
stop_session($wc=false){if(!ini_bool("session.use_cookies")||($wc&&@ini_set("session.use_cookies",false)!==false))session_write_close();}function&get_session($z){return$_SESSION[$z][DRIVER][SERVER][$_GET["username"]];}function
set_session($z,$X){$_SESSION[$z][DRIVER][SERVER][$_GET["username"]]=$X;}function
auth_url($mh,$O,$V,$j=null){global$Ib;preg_match('~([^?]*)\??(.*)~',remove_from_uri(implode("|",array_keys($Ib))."|username|".($j!==null?"db|":"").session_name()),$C);return"$C[1]?".(sid()?SID."&":"").($mh!="server"||$O!=""?urlencode($mh)."=".urlencode($O)."&":"")."username=".urlencode($V).($j!=""?"&db=".urlencode($j):"").($C[2]?"&$C[2]":"");}function
is_ajax(){return($_SERVER["HTTP_X_REQUESTED_WITH"]=="XMLHttpRequest");}function
redirect($B,$D=null){if($D!==null){restart_session();$_SESSION["messages"][preg_replace('~^[^?]*~','',($B!==null?$B:$_SERVER["REQUEST_URI"]))][]=$D;}if($B!==null){if($B=="")$B=".";header("Location: $B");exit;}}function
query_redirect($I,$B,$D,$mf=true,$gc=true,$nc=false,$Ag=""){global$f,$l,$b;if($gc){$bg=microtime(true);$nc=!$f->query($I);$Ag=format_time($bg);}$Xf="";if($I)$Xf=$b->messageQuery($I,$Ag,$nc);if($nc){$l=error().$Xf.script("messagesPrint();");return
false;}if($mf)redirect($B,$D.$Xf);return
true;}function
queries($I){global$f;static$hf=array();static$bg;if(!$bg)$bg=microtime(true);if($I===null)return
array(implode("\n",$hf),format_time($bg));$hf[]=(preg_match('~;$~',$I)?"DELIMITER ;;\n$I;\nDELIMITER ":$I).";";return$f->query($I);}function
apply_queries($I,$S,$cc='table'){foreach($S
as$Q){if(!queries("$I ".$cc($Q)))return
false;}return
true;}function
queries_redirect($B,$D,$mf){list($hf,$Ag)=queries(null);return
query_redirect($hf,$B,$D,$mf,false,!$mf,$Ag);}function
format_time($bg){return
lang(1,max(0,microtime(true)-$bg));}function
remove_from_uri($Ge=""){return
substr(preg_replace("~(?<=[?&])($Ge".(SID?"":"|".session_name()).")=[^&]*&~",'',"$_SERVER[REQUEST_URI]&"),0,-1);}function
pagination($F,$pb){return" ".($F==$pb?$F+1:'<a href="'.h(remove_from_uri("page").($F?"&page=$F".($_GET["next"]?"&next=".urlencode($_GET["next"]):""):"")).'">'.($F+1)."</a>");}function
get_file($z,$xb=false){$rc=$_FILES[$z];if(!$rc)return
null;foreach($rc
as$z=>$X)$rc[$z]=(array)$X;$K='';foreach($rc["error"]as$z=>$l){if($l)return$l;$E=$rc["name"][$z];$Ig=$rc["tmp_name"][$z];$fb=file_get_contents($xb&&preg_match('~\.gz$~',$E)?"compress.zlib://$Ig":$Ig);if($xb){$bg=substr($fb,0,3);if(function_exists("iconv")&&preg_match("~^\xFE\xFF|^\xFF\xFE~",$bg,$sf))$fb=iconv("utf-16","utf-8",$fb);elseif($bg=="\xEF\xBB\xBF")$fb=substr($fb,3);$K.=$fb."\n\n";}else$K.=$fb;}return$K;}function
upload_error($l){$Kd=($l==UPLOAD_ERR_INI_SIZE?ini_get("upload_max_filesize"):0);return($l?lang(2).($Kd?" ".lang(3,$Kd):""):lang(4));}function
repeat_pattern($Pe,$yd){return
str_repeat("$Pe{0,65535}",$yd/65535)."$Pe{0,".($yd%65535)."}";}function
is_utf8($X){return(preg_match('~~u',$X)&&!preg_match('~[\0-\x8\xB\xC\xE-\x1F]~',$X));}function
shorten_utf8($fg,$yd=80,$jg=""){if(!preg_match("(^(".repeat_pattern("[\t\r\n -\x{10FFFF}]",$yd).")($)?)u",$fg,$C))preg_match("(^(".repeat_pattern("[\t\r\n -~]",$yd).")($)?)",$fg,$C);return
h($C[1]).$jg.(isset($C[2])?"":"<i>â€¦</i>");}function
format_number($X){return
strtr(number_format($X,0,".",lang(5)),preg_split('~~u',lang(6),-1,PREG_SPLIT_NO_EMPTY));}function
friendly_url($X){return
preg_replace('~[^a-z0-9_]~i','-',$X);}function
hidden_fields($ef,$Uc=array()){$K=false;while(list($z,$X)=each($ef)){if(!in_array($z,$Uc)){if(is_array($X)){foreach($X
as$kd=>$W)$ef[$z."[$kd]"]=$W;}else{$K=true;echo'<input type="hidden" name="'.h($z).'" value="'.h($X).'">';}}}return$K;}function
hidden_fields_get(){echo(sid()?'<input type="hidden" name="'.session_name().'" value="'.h(session_id()).'">':''),(SERVER!==null?'<input type="hidden" name="'.DRIVER.'" value="'.h(SERVER).'">':""),'<input type="hidden" name="username" value="'.h($_GET["username"]).'">';}function
table_status1($Q,$oc=false){$K=table_status($Q,$oc);return($K?$K:array("Name"=>$Q));}function
column_foreign_keys($Q){global$b;$K=array();foreach($b->foreignKeys($Q)as$o){foreach($o["source"]as$X)$K[$X][]=$o;}return$K;}function
enum_input($U,$xa,$m,$Y,$Wb=null){global$b;preg_match_all("~'((?:[^']|'')*)'~",$m["length"],$Fd);$K=($Wb!==null?"<label><input type='$U'$xa value='$Wb'".((is_array($Y)?in_array($Wb,$Y):$Y===0)?" checked":"")."><i>".lang(7)."</i></label>":"");foreach($Fd[1]as$t=>$X){$X=stripcslashes(str_replace("''","'",$X));$Oa=(is_int($Y)?$Y==$t+1:(is_array($Y)?in_array($t+1,$Y):$Y===$X));$K.=" <label><input type='$U'$xa value='".($t+1)."'".($Oa?' checked':'').'>'.h($b->editVal($X,$m)).'</label>';}return$K;}function
input($m,$Y,$q){global$Ug,$b,$y;$E=h(bracket_escape($m["field"]));echo"<td class='function'>";if(is_array($Y)&&!$q){$ua=array($Y);if(version_compare(PHP_VERSION,5.4)>=0)$ua[]=JSON_PRETTY_PRINT;$Y=call_user_func_array('json_encode',$ua);$q="json";}$uf=($y=="mssql"&&$m["auto_increment"]);if($uf&&!$_POST["save"])$q=null;$Dc=(isset($_GET["select"])||$uf?array("orig"=>lang(8)):array())+$b->editFunctions($m);$xa=" name='fields[$E]'";if($m["type"]=="enum")echo
h($Dc[""])."<td>".$b->editInput($_GET["edit"],$m,$xa,$Y);else{$Lc=(in_array($q,$Dc)||isset($Dc[$q]));echo(count($Dc)>1?"<select name='function[$E]'>".optionlist($Dc,$q===null||$Lc?$q:"")."</select>".on_help("getTarget(event).value.replace(/^SQL\$/, '')",1).script("qsl('select').onchange = functionChange;",""):h(reset($Dc))).'<td>';$ad=$b->editInput($_GET["edit"],$m,$xa,$Y);if($ad!="")echo$ad;elseif(preg_match('~bool~',$m["type"]))echo"<input type='hidden'$xa value='0'>"."<input type='checkbox'".(preg_match('~^(1|t|true|y|yes|on)$~i',$Y)?" checked='checked'":"")."$xa value='1'>";elseif($m["type"]=="set"){preg_match_all("~'((?:[^']|'')*)'~",$m["length"],$Fd);foreach($Fd[1]as$t=>$X){$X=stripcslashes(str_replace("''","'",$X));$Oa=(is_int($Y)?($Y>>$t)&1:in_array($X,explode(",",$Y),true));echo" <label><input type='checkbox' name='fields[$E][$t]' value='".(1<<$t)."'".($Oa?' checked':'').">".h($b->editVal($X,$m)).'</label>';}}elseif(preg_match('~blob|bytea|raw|file~',$m["type"])&&ini_bool("file_uploads"))echo"<input type='file' name='fields-$E'>";elseif(($zg=preg_match('~text|lob~',$m["type"]))||preg_match("~\n~",$Y)){if($zg&&$y!="sqlite")$xa.=" cols='50' rows='12'";else{$M=min(12,substr_count($Y,"\n")+1);$xa.=" cols='30' rows='$M'".($M==1?" style='height: 1.2em;'":"");}echo"<textarea$xa>".h($Y).'</textarea>';}elseif($q=="json"||preg_match('~^jsonb?$~',$m["type"]))echo"<textarea$xa cols='50' rows='12' class='jush-js'>".h($Y).'</textarea>';else{$Md=(!preg_match('~int~',$m["type"])&&preg_match('~^(\d+)(,(\d+))?$~',$m["length"],$C)?((preg_match("~binary~",$m["type"])?2:1)*$C[1]+($C[3]?1:0)+($C[2]&&!$m["unsigned"]?1:0)):($Ug[$m["type"]]?$Ug[$m["type"]]+($m["unsigned"]?0:1):0));if($y=='sql'&&min_version(5.6)&&preg_match('~time~',$m["type"]))$Md+=7;echo"<input".((!$Lc||$q==="")&&preg_match('~(?<!o)int(?!er)~',$m["type"])&&!preg_match('~\[\]~',$m["full_type"])?" type='number'":"")." value='".h($Y)."'".($Md?" data-maxlength='$Md'":"").(preg_match('~char|binary~',$m["type"])&&$Md>20?" size='40'":"")."$xa>";}echo$b->editHint($_GET["edit"],$m,$Y);$uc=0;foreach($Dc
as$z=>$X){if($z===""||!$X)break;$uc++;}if($uc)echo
script("mixin(qsl('td'), {onchange: partial(skipOriginal, $uc), oninput: function () { this.onchange(); }});");}}function
process_input($m){global$b,$k;$v=bracket_escape($m["field"]);$q=$_POST["function"][$v];$Y=$_POST["fields"][$v];if($m["type"]=="enum"){if($Y==-1)return
false;if($Y=="")return"NULL";return+$Y;}if($m["auto_increment"]&&$Y=="")return
null;if($q=="orig")return(preg_match('~^CURRENT_TIMESTAMP~i',$m["on_update"])?idf_escape($m["field"]):false);if($q=="NULL")return"NULL";if($m["type"]=="set")return
array_sum((array)$Y);if($q=="json"){$q="";$Y=json_decode($Y,true);if(!is_array($Y))return
false;return$Y;}if(preg_match('~blob|bytea|raw|file~',$m["type"])&&ini_bool("file_uploads")){$rc=get_file("fields-$v");if(!is_string($rc))return
false;return$k->quoteBinary($rc);}return$b->processInput($m,$Y,$q);}function
fields_from_edit(){global$k;$K=array();foreach((array)$_POST["field_keys"]as$z=>$X){if($X!=""){$X=bracket_escape($X);$_POST["function"][$X]=$_POST["field_funs"][$z];$_POST["fields"][$X]=$_POST["field_vals"][$z];}}foreach((array)$_POST["fields"]as$z=>$X){$E=bracket_escape($z,1);$K[$E]=array("field"=>$E,"privileges"=>array("insert"=>1,"update"=>1),"null"=>1,"auto_increment"=>($z==$k->primary),);}return$K;}function
search_tables(){global$b,$f;$_GET["where"][0]["val"]=$_POST["query"];$Kf="<ul>\n";foreach(table_status('',true)as$Q=>$R){$E=$b->tableName($R);if(isset($R["Engine"])&&$E!=""&&(!$_POST["tables"]||in_array($Q,$_POST["tables"]))){$J=$f->query("SELECT".limit("1 FROM ".table($Q)," WHERE ".implode(" AND ",$b->selectSearchProcess(fields($Q),array())),1));if(!$J||$J->fetch_row()){$af="<a href='".h(ME."select=".urlencode($Q)."&where[0][op]=".urlencode($_GET["where"][0]["op"])."&where[0][val]=".urlencode($_GET["where"][0]["val"]))."'>$E</a>";echo"$Kf<li>".($J?$af:"<p class='error'>$af: ".error())."\n";$Kf="";}}}echo($Kf?"<p class='message'>".lang(9):"</ul>")."\n";}function
dump_headers($Tc,$Td=false){global$b;$K=$b->dumpHeaders($Tc,$Td);$De=$_POST["output"];if($De!="text")header("Content-Disposition: attachment; filename=".$b->dumpFilename($Tc).".$K".($De!="file"&&!preg_match('~[^0-9a-z]~',$De)?".$De":""));session_write_close();ob_flush();flush();return$K;}function
dump_csv($L){foreach($L
as$z=>$X){if(preg_match("~[\"\n,;\t]~",$X)||$X==="")$L[$z]='"'.str_replace('"','""',$X).'"';}echo
implode(($_POST["format"]=="csv"?",":($_POST["format"]=="tsv"?"\t":";")),$L)."\r\n";}function
apply_sql_function($q,$c){return($q?($q=="unixepoch"?"DATETIME($c, '$q')":($q=="count distinct"?"COUNT(DISTINCT ":strtoupper("$q("))."$c)"):$c);}function
get_temp_dir(){$K=ini_get("upload_tmp_dir");if(!$K){if(function_exists('sys_get_temp_dir'))$K=sys_get_temp_dir();else{$sc=@tempnam("","");if(!$sc)return
false;$K=dirname($sc);unlink($sc);}}return$K;}function
file_open_lock($sc){$p=@fopen($sc,"r+");if(!$p){$p=@fopen($sc,"w");if(!$p)return;chmod($sc,0660);}flock($p,LOCK_EX);return$p;}function
file_write_unlock($p,$rb){rewind($p);fwrite($p,$rb);ftruncate($p,strlen($rb));flock($p,LOCK_UN);fclose($p);}function
password_file($h){$sc=get_temp_dir()."/adminer.key";$K=@file_get_contents($sc);if($K||!$h)return$K;$p=@fopen($sc,"w");if($p){chmod($sc,0660);$K=rand_string();fwrite($p,$K);fclose($p);}return$K;}function
rand_string(){return
md5(uniqid(mt_rand(),true));}function
select_value($X,$A,$m,$_g){global$b;if(is_array($X)){$K="";foreach($X
as$kd=>$W)$K.="<tr>".($X!=array_values($X)?"<th>".h($kd):"")."<td>".select_value($W,$A,$m,$_g);return"<table cellspacing='0'>$K</table>";}if(!$A)$A=$b->selectLink($X,$m);if($A===null){if(is_mail($X))$A="mailto:$X";if(is_url($X))$A=$X;}$K=$b->editVal($X,$m);if($K!==null){if(!is_utf8($K))$K="\0";elseif($_g!=""&&is_shortable($m))$K=shorten_utf8($K,max(0,+$_g));else$K=h($K);}return$b->selectVal($K,$A,$m,$X);}function
is_mail($Tb){$wa='[-a-z0-9!#$%&\'*+/=?^_`{|}~]';$Hb='[a-z0-9]([-a-z0-9]{0,61}[a-z0-9])';$Pe="$wa+(\\.$wa+)*@($Hb?\\.)+$Hb";return
is_string($Tb)&&preg_match("(^$Pe(,\\s*$Pe)*\$)i",$Tb);}function
is_url($fg){$Hb='[a-z0-9]([-a-z0-9]{0,61}[a-z0-9])';return
preg_match("~^(https?)://($Hb?\\.)+$Hb(:\\d+)?(/.*)?(\\?.*)?(#.*)?\$~i",$fg);}function
is_shortable($m){return
preg_match('~char|text|json|lob|geometry|point|linestring|polygon|string|bytea~',$m["type"]);}function
count_rows($Q,$Z,$gd,$s){global$y;$I=" FROM ".table($Q).($Z?" WHERE ".implode(" AND ",$Z):"");return($gd&&($y=="sql"||count($s)==1)?"SELECT COUNT(DISTINCT ".implode(", ",$s).")$I":"SELECT COUNT(*)".($gd?" FROM (SELECT 1$I GROUP BY ".implode(", ",$s).") x":$I));}function
slow_query($I){global$b,$T,$k;$j=$b->database();$Bg=$b->queryTimeout();$Tf=$k->slowQuery($I,$Bg);if(!$Tf&&support("kill")&&is_object($g=connect())&&($j==""||$g->select_db($j))){$md=$g->result(connects->_result=$this->query($I);}function
store_result(){return$this->_result;}function
next_result(){return
false;}function
result($I,$m=0){$J=$this->query($I);if(!$J||!$J->num_rows)return
false;return
mysql_result($J->_result,0,$m);}}class
Min_Result{var$num_rows,$_result,$_offset=0;function
__construct($J){$this->_result=$J;$this->num_rows=mysql_num_rows($J);}function
fetch_assoc(){return
mysql_fetch_assoc($this->_result);}function
fetch_row(){return
mysql_fetch_row($this->_result);}function
fetch_field(){$K=mysql_fetch_field($this->_result,$this->_offset++);$K->orgtable=$K->table;$K->orgname=$K->name;$K->charsetnr=($K->blob?63:0);return$K;}function
__destruct(){mysql_free_result($this->_result);}}}elseif(extension_loaded("pdo_mysql")){class
Min_DB
extends
Min_PDO{var$extension="PDO_MySQL";function
connect($O,$V,$G){global$b;$se=array(PDO::MYSQL_ATTR_LOCAL_INFILE=>false);$ag=$b->connectSsl();if($ag)$se+=array(PDO::MYSQL_ATTR_SSL_KEY=>$ag['key'],PDO::MYSQL_ATTR_SSL_CERT=>$ag['cert'],PDO::MYSQL_ATTR_SSL_CA=>$ag['ca'],);$this->dsn("mysql:charset=utf8;host=".str_replace(":",";unix_socket=",preg_replace('~:(\d)~',';port=\1',$O)),$V,$G,$se);return
true;}function
set_charset($Ma){$this->query("SET NAMES $Ma");}function
select_db($tb){return$this->query("USE ".idf_escape($tb));}function
query($I,$Vg=false){$this->setAttribute(1000,!$Vg);return
parent::query($I,$Vg);}}}class
Min_Driver
extends
Min_SQL{function
insert($Q,$P){return($P?parent::insert($Q,$P):queries("INSERT INTO ".table($Q)." ()\nVALUES ()"));}function
insertUpdate($Q,$M,$Ze){$d=array_keys(reset($M));$Xe="INSERT INTO ".table($Q)." (".implode(", ",$d).") VALUES\n";$kh=array();foreach($d
as$z)$kh[$z]="$z = VALUES($z)";$jg="\nON DUPLICATE KEY UPDATE ".implode(", ",$kh);$kh=array();$yd=0;foreach($M
as$P){$Y="(".implode(", ",$P).")";if($kh&&(strlen($Xe)+$yd+strlen($Y)+strlen($jg)>1e6)){if(!queries($Xe.implode(",\n",$kh).$jg))return
false;$kh=array();$yd=0;}$kh[]=$Y;$yd+=strlen($Y)+2;}return
queries($Xe.implode(",\n",$kh).$jg);}function
slowQuery($I,$Bg){if(min_version('5.7.8','10.1.2')){if(preg_match('~MariaDB~',$this->_conn->server_info))return"SET STATEMENT max_statement_time=$Bg FOR $I";elseif(preg_match('~^(SELECT\b)(.+)~is',$I,$C))return"$C[1] /*+ MAX_EXECUTION_TIME(".($Bg*1000).") */ $C[2]";}}function
convertSearch($v,$X,$m){return(preg_match('~char|text|enum|set~',$m["type"])&&!preg_match("~^utf8~",$m["collation"])&&preg_match('~[\x80-\xFF]~',$X['val'])?"CONVERT($v USING ".charset($this->_conn).")":$v);}function
warnings(){$J=$this->_conn->query("SHOW WARNINGS");if($J&&$J->num_rows){ob_start();select($J);return
ob_get_clean();}}function
tableHelp($E){$Dd=preg_match('~MariaDB~',$this->_conn->server_info);if(information_schema(DB))return
strtolower(($Dd?"information-schema-$E-table/":str_replace("_","-",$E)."-table.html"));if(DB=="mysql")return($Dd?"mysql$E-table/":"system-database.html");}}function
idf_escape($v){return"`".str_replace("`","``",$v)."`";}function
table($v){return
idf_escape($v);}function
connect(){global$b,$Ug,$gg;$f=new
Min_DB;$mb=$b->credentials();if($f->connect($mb[0],$mb[1],$mb[2])){$f->set_charset(charset($f));$f->query("SET sql_quote_show_create = 1, autocommit = 1");if(min_version('5.7.8',10.2,$f)){$gg[lang(23)][]="json";$Ug["json"]=4294967295;}return$f;}$K=$f->error;if(function_exists('iconv')&&!is_utf8($K)&&strlen($Cf=iconv("windows-1250","utf-8",$K))>strlen($K))$K=$Cf;return$K;}function
get_databases($vc){$K=get_session("dbs");if($K===null){$I=(min_version(5)?"SELECT SCHEMA_NAME FROM information_schema.SCHEMATA ORDER BY SCHEMA_NAME":"SHOW DATABASES");$K=($vc?slow_query($I):get_vals($I));restart_session();set_session("dbs",$K);stop_session();}return$K;}function
limit($I,$Z,$_,$fe=0,$Lf=" "){return" $I$Z".($_!==null?$Lf."LIMIT $_".($fe?" OFFSET $fe":""):"");}function
limit1($Q,$I,$Z,$Lf="\n"){return
limit($I,$Z,1,0,$Lf);}function
db_collation($j,$Ya){global$f;$K=null;$h=$f->result("SHOW CREATE DATABASE ".idf_escape($j),1);if(preg_match('~ COLLATE ([^ ]+)~',$h,$C))$K=$C[1];elseif(preg_match('~ CHARACTER SET ([^ ]+)~',$h,$C))$K=$Ya[$C[1]][-1];return$K;}function
engines(){$K=array();foreach(get_rows("SHOW ENGINES")as$L){if(preg_match("~YES|DEFAULT~",$L["Support"]))$K[]=$L["Engine"];}return$K;}function
logged_user(){global$f;return$f->result("SELECT USER()");}function
tables_list(){return
get_key_vals(min_version(5)?"SELECT TABLE_NAME, TABLE_TYPE FROM information_schema.TABLES WHERE TABLE_SCHEMA = DATABASE() ORDER BY TABLE_NAME":"SHOW TABLES");}function
count_tables($i){$K=array();foreach($i
as$j)$K[$j]=count(get_vals("SHOW TABLES IN ".idf_escape($j)));return$K;}function
table_status($E="",$oc=false){$K=array();foreach(get_rows($oc&&min_version(5)?"SELECT TABLE_NAME AS Name, ENGINE AS Engine, TABLE_COMMENT AS Comment FROM information_schema.TABLES WHERE TABLE_SCHEMA = DATABASE() ".($E!=""?"AND TABLE_NAME = ".q($E):"ORDER BY Name"):"SHOW TABLE STATUS".($E!=""?" LIKE ".q(addcslashes($E,"%_\\")):""))as$L){if($L["Engine"]=="InnoDB")$L["Comment"]=preg_replace('~(?:(.+); )?InnoDB free: .*~','\1',$L["Comment"]);if(!isset($L["Engine"]))$L["Comment"]="";if($E!="")return$L;$K[$L["Name"]]=$L;}return$K;}function
is_view($R){return$R["Engine"]===null;}function
fk_support($R){return
preg_match('~InnoDB|IBMDB2I~i',$R["Engine"])||(preg_match('~NDB~i',$R["Engine"])&&min_version(5.6));}function
fields($Q){$K=array();foreach(get_rows("SHOW FULL COLUMNS FROM ".table($Q))as$L){preg_match('~^([^( ]+)(?:\((.+)\))?( unsigned)?( zerofill)?$~',$L["Type"],$C);$K[$L["Field"]]=array("field"=>$L["Field"],"full_type"=>$L["Type"],"type"=>$C[1],"length"=>$C[2],"unsigned"=>ltrim($C[3].$C[4]),"default"=>($L["Default"]!=""||preg_match("~char|set~",$C[1])?$L["Default"]:null),"null"=>($L["Null"]=="YES"),"auto_increment"=>($L["Extra"]=="auto_increment"),"on_update"=>(preg_match('~^on update (.+)~i',$L["Extra"],$C)?$C[1]:""),"collation"=>$L["Collation"],"privileges"=>array_flip(preg_split('~, *~',$L["Privileges"])),"comment"=>$L["Comment"],"primary"=>($L["Key"]=="PRI"),);}return$K;}function
indexes($Q,$g=null){$K=array();foreach(get_rows("SHOW INDEX FROM ".table($Q),$g)as$L){$E=$L["Key_name"];$K[$E]["type"]=($E=="PRIMARY"?"PRIMARY":($L["Index_type"]=="FULLTEXT"?"FULLTEXT":($L["Non_unique"]?($L["Index_type"]=="SPATIAL"?"SPATIAL":"INDEX"):"UNIQUE")));$K[$E]["columns"][]=$L["Column_name"];$K[$E]["lengths"][]=($L["Index_type"]=="SPATIAL"?null:$L["Sub_part"]);$K[$E]["descs"][]=null;}return$K;}function
foreign_keys($Q){global$f,$me;static$Pe='(?:`(?:[^`]|``)+`)|(?:"(?:[^"]|"")+")';$K=array();$kb=$f->result("SHOW CREATE TABLE ".table($Q),1);if($kb){preg_match_all("~CONSTRAINT ($Pe) FOREIGN KEY ?\\(((?:$Pe,? ?)+)\\) REFERENCES ($Pe)(?:\\.($Pe))? \\(((?:$Pe,? ?)+)\\)(?: ON DELETE ($me))?(?: ON UPDATE ($me))?~",$kb,$Fd,PREG_SET_ORDER);foreach($Fd
as$C){preg_match_all("~$Pe~",$C[2],$Vf);preg_match_all("~$Pe~",$C[5],$vg);$K[idf_unescape($C[1])]=array("db"=>idf_unescape($C[4]!=""?$C[3]:$C[4]),"table"=>idf_unescape($C[4]!=""?$C[4]:$C[3]),"source"=>array_map('idf_unescape',$Vf[0]),"target"=>array_map('idf_unescape',$vg[0]),"on_delete"=>($C[6]?$C[6]:"RESTRICT"),"on_update"=>($C[7]?$C[7]:"RESTRICT"),);}}return$K;}function
view($E){global$f;return
array("select"=>preg_replace('~^(?:[^`]|`[^`]*`)*\s+AS\s+~isU','',$f->result("SHOW CREATE VIEW ".table($E),1)));}function
collations(){$K=array();foreach(get_rows("SHOW COLLATION")as$L){if($L["Default"])$K[$L["Charset"]][-1]=$L["Collation"];else$K[$L["Charset"]][]=$L["Collation"];}ksort($K);foreach($K
as$z=>$X)asort($K[$z]);return$K;}function
information_schema($j){return(min_version(5)&&$j=="information_schema")||(min_version(5.5)&&$j=="performance_schema");}function
error(){global$f;return
h(preg_replace('~^You have an error.*syntax to use~U',"Syntax error",$f->error));}function
create_database($j,$Xa){return
queries("CREATE DATABASE ".idf_escape($j).($Xa?" COLLATE ".q($Xa):""));}function
drop_databases($i){$K=apply_queries("DROP DATABASE",$i,'idf_escape');restart_session();set_session("dbs",null);return$K;}function
rename_database($E,$Xa){$K=false;if(create_database($E,$Xa)){$tf=array();foreach(tables_list()as$Q=>$U)$tf[]=table($Q)." TO ".idf_escape($E).".".table($Q);$K=(!$tf||queries("RENAME TABLE ".implode(", ",$tf)));if($K)queries("DROP DATABASE ".idf_escape(DB));restart_session();set_session("dbs",null);}return$K;}function
auto_increment(){$_a=" PRIMARY KEY";if($_GET["create"]!=""&&$_POST["auto_increment_col"]){foreach(indexes($_GET["create"])as$w){if(in_array($_POST["fields"][$_POST["auto_increment_col"]]["orig"],$w["columns"],true)){$_a="";break;}if($w["type"]=="PRIMARY")$_a=" UNIQUE";}}return" AUTO_INCREMENT$_a";}function
alter_table($Q,$E,$n,$xc,$cb,$Xb,$Xa,$za,$Le){$ta=array();foreach($n
as$m)$ta[]=($m[1]?($Q!=""?($m[0]!=""?"CHANGE ".idf_escape($m[0]):"ADD"):" ")." ".implode($m[1]).($Q!=""?$m[2]:""):"DROP ".idf_escape($m[0]));$ta=array_merge($ta,$xc);$cg=($cb!==null?" COMMENT=".q($cb):"").($Xb?" ENGINE=".q($Xb):"").($Xa?" COLLATE ".q($Xa):"").($za!=""?" AUTO_INCREMENT=$za":"");if($Q=="")return
queries("CREATE TABLE ".table($E)." (\n".implode(",\n",$ta)."\n)$cg$Le");if($Q!=$E)$ta[]="RENAME TO ".table($E);if($cg)$ta[]=ltrim($cg);return($ta||$Le?queries("ALTER TABLE ".table($Q)."\n".implode(",\n",$ta).$Le):true);}function
alter_indexes($Q,$ta){foreach($ta
as$z=>$X)$ta[$z]=($X[2]=="DROP"?"\nDROP INDEX ".idf_escape($X[1]):"\nADD $X[0] ".($X[0]=="PRIMARY"?"KEY ":"").($X[1]!=""?idf_escape($X[1])." ":"")."(".implode(", ",$X[2]).")");return
queries("ALTER TABLE ".table($Q).implode(",",$ta));}function
truncate_tables($S){return
apply_queries("TRUNCATE TABLE",$S);}function
drop_views($ph){return
queries("DROP VIEW ".implode(", ",array_map('table',$ph)));}function
drop_tables($S){return
queries("DROP TABLE ".implode(", ",array_map('table',$S)));}function
move_tables($S,$ph,$vg){$tf=array();foreach(array_merge($S,$ph)as$Q)$tf[]=table($Q)." TO ".idf_escape($vg).".".table($Q);return
queries("RENAME TABLE ".implode(", ",$tf));}function
copy_tables($S,$ph,$vg){queries("SET sql_mode = 'NO_AUTO_VALUE_ON_ZERO'");foreach($S
as$Q){$E=($vg==DB?table("copy_$Q"):idf_escape($vg).".".table($Q));if(!queries("CREATE TABLE $E LIKE ".table($Q))||!queries("INSERT INTO $E SELECT * FROM ".table($Q)))return
false;foreach(get_rows("SHOW TRIGGERS LIKE ".q(addcslashes($Q,"%_\\")))as$L){$Pg=$L["Trigger"];if(!queries("CREATE TRIGGER ".($vg==DB?idf_escape("copy_$Pg"):idf_escape($vg).".".idf_escape($Pg))." $L[Timing] $L[Event] ON $E FOR EACH ROW\n$L[Statement];"))return
false;}}foreach($ph
as$Q){$E=($vg==DB?table("copy_$Q"):idf_escape($vg).".".table($Q));$oh=view($Q);if(!queries("CREATE VIEW $E AS $oh[select]"))return
false;}return
true;}function
trigger($E){if($E=="")return
array();$M=get_rows("SHOW TRIGGERS WHERE `Trigger` = ".q($E));return
reset($M);}function
triggers($Q){$K=array();foreach(get_rows("SHOW TRIGGERS LIKE ".q(addcslashes($Q,"%_\\")))as$L)$K[$L["Trigger"]]=array($L["Timing"],$L["Event"]);return$K;}function
trigger_options(){return
array("Timing"=>array("BEFORE","AFTER"),"Event"=>array("INSERT","UPDATE","DELETE"),"Type"=>array("FOR EACH ROW"),);}function
routine($E,$U){global$f,$Zb,$Zc,$Ug;$ra=array("bool","boolean","integer","double precision","real","dec","numeric","fixed","national char","national varchar");$Wf="(?:\\s|/\\*[\s\S]*?\\*/|(?:#|-- )[^\n]*\n?|--\r?\n)";$Tg="((".implode("|",array_merge(array_keys($Ug),$ra)).")\\b(?:\\s*\\(((?:[^'\")]|$Zb)++)\\))?\\s*(zerofill\\s*)?(unsigned(?:\\s+zerofill)?)?)(?:\\s*(?:CHARSET|CHARACTER\\s+SET)\\s*['\"]?([^'\"\\s,]+)['\"]?)?";$Pe="$Wf*(".($U=="FUNCTION"?"":$Zc).")?\\s*(?:`((?:[^`]|``)*)`\\s*|\\b(\\S+)\\s+)$Tg";$h=$f->result("SHOW CREATE $U ".idf_escape($E),2);preg_match("~\\(((?:$Pe\\s*,?)*)\\)\\s*".($U=="FUNCTION"?"RETURNS\\s+$Tg\\s+":"")."(.*)~is",$h,$C);$n=array();preg_match_all("~$Pe\\s*,?~is",$C[1],$Fd,PREG_SET_ORDER);foreach($Fd
as$Ge){$E=str_replace("``","`",$Ge[2]).$Ge[3];$n[]=array("field"=>$E,"type"=>strtolower($Ge[5]),"length"=>preg_replace_callback("~$Zb~s",'normalize_enum',$Ge[6]),"unsigned"=>strtolower(preg_replace('~\s+~',' ',trim("$Ge[8] $Ge[7]"))),"null"=>1,"full_type"=>$Ge[4],"inout"=>strtoupper($Ge[1]),"collation"=>strtolower($Ge[9]),);}if($U!="FUNCTION")return
array("fields"=>$n,"definition"=>$C[11]);return
array("fields"=>$n,"returns"=>array("type"=>$C[12],"length"=>$C[13],"unsigned"=>$C[15],"collation"=>$C[16]),"definition"=>$C[17],"language"=>"SQL",);}function
routines(){return
get_rows("SELECT ROUTINE_NAME AS SPECIFIC_NAME, ROUTINE_NAME, ROUTINE_TYPE, DTD_IDENTIFIER FROM information_schema.ROUTINES WHERE ROUTINE_SCHEMA = ".q(DB));}function
routine_languages(){return
array();}function
routine_id($E,$L){return
idf_escape($E);}function
last_id(){global$f;return$f->result("SELECT LAST_INSERT_ID()");}function
explain($f,$I){return$f->query("EXPLAIN ".(min_version(5.1)?"PARTITIONS ":"").$I);}function
found_rows($R,$Z){return($Z||$R["Engine"]!="InnoDB"?null:$R["Rows"]);}function
types(){return
array();}function
schemas(){return
array();}function
get_schema(){return"";}function
set_schema($Ef){return
true;}function
create_sql($Q,$za,$hg){global$f;$K=$f->result("SHOW CREATE TABLE ".table($Q),1);if(!$za)$K=preg_replace('~ AUTO_INCREMENT=\d+~','',$K);return$K;}function
truncate_sql($Q){return"TRUNCATE ".table($Q);}function
use_sql($tb){return"USE ".idf_escape($tb);}function
trigger_sql($Q){$K="";foreach(get_rows("SHOW TRIGGERS LIKE ".q(addcslashes($Q,"%_\\")),null,"-- ")as$L)$K.="\nCREATE TRIGGER ".idf_escape($L["Trigger"])." $L[Timing] $L[Event] ON ".table($L["Table"])." FOR EACH ROW\n$L[Statement];;\n";return$K;}function
show_variables(){return
get_key_vals("SHOW VARIABLES");}function
process_list(){return
get_rows("SHOW FULL PROCESSLIST");}function
show_status(){return
get_key_vals("SHOW STATUS");}function
convert_field($m){if(preg_match("~binary~",$m["type"]))return"HEX(".idf_escape($m["field"]).")";if($m["type"]=="bit")return"BIN(".idf_escape($m["field"])." + 0)";if(preg_match("~geometry|point|linestring|polygon~",$m["type"]))return(min_version(8)?"ST_":"")."AsWKT(".idf_escape($m["field"]).")";}function
unconvert_field($m,$K){if(preg_match("~binary~",$m["type"]))$K="UNHEX($K)";if($m["type"]=="bit")$K="CONV($K, 2, 10) + 0";if(preg_match("~geometry|point|linestring|polygon~",$m["type"]))$K=(min_version(8)?"ST_":"")."GeomFromText($K)";return$K;}function
support($pc){return!preg_match("~scheme|sequence|type|view_trigger|materializedview".(min_version(8)?"":"|descidx".(min_version(5.1)?"":"|event|partitioning".(min_version(5)?"":"|routine|trigger|view")))."~",$pc);}function
kill_process($X){return
queries("KILL ".number($X));}function
connection_id(){return"SELECT CONNECTION_ID()";}function
max_connections(){global$f;return$f->result("SELECT @@max_connections");}$y="sql";$Ug=array();$gg=array();foreach(array(lang(24)=>array("tinyint"=>3,"smallint"=>5,"mediumint"=>8,"int"=>10,"bigint"=>20,"decimal"=>66,"float"=>12,"double"=>21),lang(25)=>array("date"=>10,"datetime"=>19,"timestamp"=>19,"time"=>10,"year"=>4),lang(23)=>array("char"=>255,"varchar"=>65535,"tinytext"=>255,"text"=>65535,"mediumtext"=>16777215,"longtext"=>4294967295),lang(26)=>array("enum"=>65535,"set"=>64),lang(27)=>array("bit"=>20,"binary"=>255,"varbinary"=>65535,"tinyblob"=>255,"blob"=>65535,"mediumblob"=>16777215,"longblob"=>4294967295),lang(28)=>array("geometry"=>0,"point"=>0,"linestring"=>0,"polygon"=>0,"multipoint"=>0,"multilinestring"=>0,"multipolygon"=>0,"geometrycollection"=>0),)as$z=>$X){$Ug+=$X;$gg[$z]=array_keys($X);}$bh=array("unsigned","zerofill","unsigned zerofill");$qe=array("=","<",">","<=",">=","!=","LIKE","LIKE %%","REGEXP","IN","FIND_IN_SET","IS NULL","NOT LIKE","NOT REGEXP","NOT IN","IS NOT NULL","SQL");$Dc=array("char_length","date","from_unixtime","lower","round","floor","ceil","sec_to_time","time_to_sec","upper");$Hc=array("avg","count","count distinct","group_concat","max","min","sum");$Pb=array(array("char"=>"md5/sha1/password/encrypt/uuid","binary"=>"md5/sha1","date|time"=>"now",),array(number_type()=>"+/-","date"=>"+ interval/- interval","time"=>"addtime/subtime","char|text"=>"concat",));}define("SERVER",$_GET[DRIVER]);define("DB",$_GET["db"]);define("ME",preg_replace('~^[^?]*/([^?]*).*~','\1',$_SERVER["REQUEST_URI"]).'?'.(sid()?SID.'&':'').(SERVER!==null?DRIVER."=".urlencode(SERVER).'&':'').(isset($_GET["username"])?"username=".urlencode($_GET["username"]).'&':'').(DB!=""?'db='.urlencode(DB).'&'.(isset($_GET["ns"])?"ns=".urlencode($_GET["ns"])."&":""):''));$ga="4.7.1";class
Adminer{var$operators;function
name(){return"<a href='https://www.adminer.org/'".target_blank()." id='h1'>Adminer</a>";}function
credentials(){return
array(SERVER,$_GET["username"],get_password());}function
connectSsl(){}function
permanentLogin($h=false){return
password_file($h);}function
bruteForceKey(){return$_SERVER["REMOTE_ADDR"];}function
serverName($O){return
h($O);}function
database(){return
DB;}function
databases($vc=true){return
get_databases($vc);}function
schemas(){return
schemas();}function
queryTimeout(){return
2;}function
headers(){}function
csp(){return
csp();}function
head(){return
true;}function
css(){$K=array();$sc="adminer.css";if(file_exists($sc))$K[]=$sc;return$K;}function
loginForm(){global$Ib;echo"<table cellspacing='0' class='layout'>\n",$this->loginFormField('driver','<tr><th>'.lang(29).'<td>',html_select("auth[driver]",$Ib,DRIVER,"loginDriver(this);")."\n"),$this->loginFormField('server','<tr><th>'.lang(30).'<td>','<input name="auth[server]" value="'.h(SERVER).'" title="hostname[:port]" placeholder="localhost" autocapitalize="off">'."\n"),$this->loginFormField('username','<tr><th>'.lang(31).'<td>','<input name="auth[username]" id="username" value="'.h($_GET["username"]).'" autocomplete="username" autocapitalize="off">'.script("focus(qs('#username')); qs('#username').form['auth[driver]'].onchange();")),$this->loginFormField('password','<tr><th>'.lang(32).'<td>','<input type="password" name="auth[password]" autocomplete="current-password">'."\n"),$this->loginFormField('db','<tr><th>'.lang(33).'<td>','<input name="auth[db]" value="'.h($_GET["db"]).'" autocapitalize="off">'."\n"),"</table>\n","<p><input type='submit' value='".lang(34)."'>\n",checkbox("auth[permanent]",1,$_COOKIE["adminer_permanent"],lang(35))."\n";}function
loginFormField($E,$Oc,$Y){return$Oc.$Y;}function
login($Bd,$G){if($G=="")return
lang(36,target_blank());return
true;}function
tableName($ng){return
h($ng["Name"]);}function
fieldName($m,$ue=0){return'<span title="'.h($m["full_type"]).'">'.h($m["field"]).'</span>';}function
selectLinks($ng,$P=""){global$y,$k;echo'<p class="links">';$Ad=array("select"=>lang(37));if(support("table")||support("indexes"))$Ad["table"]=lang(38);if(support("table")){if(is_view($ng))$Ad["view"]=lang(39);else$Ad["create"]=lang(40);}if($P!==null)$Ad["edit"]=lang(41);$E=$ng["Name"];foreach($Ad
as$z=>$X)echo" <a href='".h(ME)."$z=".urlencode($E).($z=="edit"?$P:"")."'".bold(isset($_GET[$z])).">$X</a>";echo
doc_link(array($y=>$k->tableHelp($E)),"?"),"\n";}function
foreignKeys($Q){return
foreign_keys($Q);}function
backwardKeys($Q,$mg){return
array();}function
backwardKeysPrint($Ba,$L){}function
selectQuery($I,$bg,$nc=false){global$y,$k;$K="</p>\n";if(!$nc&&($sh=$k->warnings())){$u="warnings";$K=", <a href='#$u'>".lang(42)."</a>".script("qsl('a').onclick = partial(toggle, '$u');","")."$K<div id='$u' class='hidden'>\n$sh</div>\n";}return"<p><code class='jush-$y'>".h(str_replace("\n"," ",$I))."</code> <span class='time'>(".format_time($bg).")</span>".(support("sql")?" <a href='".h(ME)."sql=".urlencode($I)."'>".lang(10)."</a>":"").$K;}function
sqlCommandQuery($I){return
shorten_utf8(trim($I),1000);}function
rowDescription($Q){return"";}function
rowDescriptions($M,$yc){return$M;}function
selectLink($X,$m){}function
selectVal($X,$A,$m,$Be){$K=($X===null?"<i>NULL</i>":(preg_match("~char|binary|boolean~",$m["type"])&&!preg_match("~var~",$m["type"])?"<code>$X</code>":$X));if(preg_match('~blob|bytea|raw|file~',$m["type"])&&!is_utf8($X))$K="<i>".lang(43,strlen($Be))."</i>";if(preg_match('~json~',$m["type"]))$K="<code class='jush-js'>$K</code>";return($A?"<a href='".h($A)."'".(is_url($A)?target_blank():"").">$K</a>":$K);}function
editVal($X,$m){return$X;}function
tableStructurePrint($n){echo"<div class='scrollable'>\n","<table cellspacing='0' class='nowrap'>\n","<thead><tr><th>".lang(44)."<td>".lang(45).(support("comment")?"<td>".lang(46):"")."</thead>\n";foreach($n
as$m){echo"<tr".odd()."><th>".h($m["field"]),"<td><span title='".h($m["collation"])."'>".h($m["full_type"])."</span>",($m["null"]?" <i>NULL</i>":""),($m["auto_increment"]?" <i>".lang(47)."</i>":""),(isset($m["default"])?" <span title='".lang(48)."'>[<b>".h($m["default"])."</b>]</span>":""),(support("comment")?"<td>".h($m["comment"]):""),"\n";}echo"</table>\n","</div>\n";}function
tableIndexesPrint($x){echo"<table cellspacing='0'>\n";foreach($x
as$E=>$w){ksort($w["columns"]);$af=array();foreach($w["columns"]as$z=>$X)$af[]="<i>".h($X)."</i>".($w["lengths"][$z]?"(".$w["lengths"][$z].")":"").($w["descs"][$z]?" DESC":"");echo"<tr title='".h($E)."'><th>$w[type]<td>".implode(", ",$af)."\n";}echo"</table>\n";}function
selectColumnsPrint($N,$d){global$Dc,$Hc;print_fieldset("select",lang(49),$N);$t=0;$N[""]=array();foreach($N
as$z=>$X){$X=$_GET["columns"][$z];$c=select_input(" name='columns[$t][col]'",$d,$X["col"],($z!==""?"selectFieldChange":"selectAddRow"));echo"<div>".($Dc||$Hc?"<select name='columns[$t][fun]'>".optionlist(array(-1=>"")+array_filter(array(lang(50)=>$Dc,lang(51)=>$Hc)),$X["fun"])."</select>".on_help("getTarget(event).value && getTarget(event).value.replace(/ |\$/, '(') + ')'",1).script("qsl('select').onchange = function () { helpClose();".($z!==""?"":" qsl('select, input', this.parentNode).onchange();")." };","")."($c)":$c)."</div>\n";$t++;}echo"</div></fieldset>\n";}function
selectSearchPrint($Z,$d,$x){print_fieldset("search",lang(52),$Z);foreach($x
as$t=>$w){if($w["type"]=="FULLTEXT"){echo"<div>(<i>".implode("</i>, <i>",array_map('h',$w["columns"]))."</i>) AGAINST"," <input type='search' name='fulltext[$t]' value='".h($_GET["fulltext"][$t])."'>",script("qsl('input').oninput = selectFieldChange;",""),checkbox("boolean[$t]",1,isset($_GET["boolean"][$t]),"BOOL"),"</div>\n";}}$La="this.parentNode.firstChild.onchange();";foreach(array_merge((array)$_GET["where"],array(array()))as$t=>$X){if(!$X||("$X[col]$X[val]"!=""&&in_array($X["op"],$this->operators))){echo"<div>".select_input(" name='where[$t][col]'",$d,$X["col"],($X?"selectFieldChange":"selectAddRow"),"(".lang(53).")"),html_select("where[$t][op]",$this->operators,$X["op"],$La),"<input type='search' name='where[$t][val]' value='".h($X["val"])."'>",script("mixin(qsl('input'), {oninput: function () { $La }, onkeydown: selectSearchKeydown, onsearch: selectSearchSearch});",""),"</div>\n";}}echo"</div></fieldset>\n";}function
selectOrderPrint($ue,$d,$x){print_fieldset("sort",lang(54),$ue);$t=0;foreach((array)$_GET["order"]as$z=>$X){if($X!=""){echo"<div>".select_input(" name='order[$t]'",$d,$X,"selectFieldChange"),checkbox("desc[$t]",1,isset($_GET["desc"][$z]),lang(55))."</div>\n";$t++;}}echo"<div>".select_input(" name='order[$t]'",$d,"","selectAddRow"),checkbox("desc[$t]",1,false,lang(55))."</div>\n","</div></fieldset>\n";}function
selectLimitPrint($_){echo"<fieldset><legend>".lang(56)."</legend><div>";echo"<input type='number' name='limit' class='size' value='".h($_)."'>",script("qsl('input').oninput = selectFieldChange;",""),"</div></fieldset>\n";}function
selectLengthPrint($_g){if($_g!==null){echo"<fieldset><legend>".lang(57)."</legend><div>","<input type='number' name='text_length' class='size' value='".h($_g)."'>","</div></fieldset>\n";}}function
selectActionPrint($x){echo"<fieldset><legend>".lang(58)."</legend><div>","<input type='submit' value='".lang(49)."'>"," <span id='noindex' title='".lang(59)."'></span>","<script".nonce().">\n","var indexColumns = ";$d=array();foreach($x
as$w){$qb=reset($w["columns"]);if($w["type"]!="FULLTEXT"&&$qb)$d[$qb]=1;}$d[""]=1;foreach($d
as$z=>$X)json_row($z);echo";\n","selectFieldChange.call(qs('#form')['select']);\n","</script>\n","</div></fieldset>\n";}function
selectCommandPrint(){return!information_schema(DB);}function
selectImportPrint(){return!information_schema(DB);}function
selectEmailPrint($Ub,$d){}function
selectColumnsProcess($d,$x){global$Dc,$Hc;$N=array();$s=array();foreach((array)$_GET["columns"]as$z=>$X){if($X["fun"]=="count"||($X["col"]!=""&&(!$X["fun"]||in_array($X["fun"],$Dc)||in_array($X["fun"],$Hc)))){$N[$z]=apply_sql_function($X["fun"],($X["col"]!=""?idf_escape($X["col"]):"*"));if(!in_array($X["fun"],$Hc))$s[]=$N[$z];}}return
array($N,$s);}function
selectSearchProcess($n,$x){global$f,$k;$K=array();foreach($x
as$t=>$w){if($w["type"]=="FULLTEXT"&&$_GET["fulltext"][$t]!="")$K[]="MATCH (".implode(", ",array_map('idf_escape',$w["columns"])).") AGAINST (".q($_GET["fulltext"][$t]).(isset($_GET["boolean"][$t])?" IN BOOLEAN MODE":"").")";}foreach((array)$_GET["where"]as$z=>$X){if("$X[col]$X[val]"!=""&&in_array($X["op"],$this->operators)){$Xe="";$db=" $X[op]";if(preg_match('~IN$~',$X["op"])){$Wc=process_length($X["val"]);$db.=" ".($Wc!=""?$Wc:"(NULL)");}elseif($X["op"]=="SQL")$db=" $X[val]";elseif($X["op"]=="LIKE %%")$db=" LIKE ".$this->processInput($n[$X["col"]],"%$X[val]%");elseif($X["op"]=="ILIKE %%")$db=" ILIKE ".$this->processInput($n[$X["col"]],"%$X[val]%");elseif($X["op"]=="FIND_IN_SET"){$Xe="$X[op](".q($X["val"]).", ";$db=")";}elseif(!preg_match('~NULL$~',$X["op"]))$db.=" ".$this->processInput($n[$X["col"]],$X["val"]);if($X["col"]!="")$K[]=$Xe.$k->convertSearch(idf_escape($X["col"]),$X,$n[$X["col"]]).$db;else{$Za=array();foreach($n
as$E=>$m){if((preg_match('~^[-\d.'.(preg_match('~IN$~',$X["op"])?',':'').']+$~',$X["val"])||!preg_match('~'.number_type().'|bit~',$m["type"]))&&(!preg_match("~[\x80-\xFF]~",$X["val"])||preg_match('~char|text|enum|set~',$m["type"])))$Za[]=$Xe.$k->convertSearch(idf_escape($E),$X,$m).$db;}$K[]=($Za?"(".implode(" OR ",$Za).")":"1 = 0");}}}return$K;}function
selectOrderProcess($n,$x){$K=array();foreach((array)$_GET["order"]as$z=>$X){if($X!="")$K[]=(preg_match('~^((COUNT\(DISTINCT |[A-Z0-9_]+\()(`(?:[^`]|``)+`|"(?:[^"]|"")+")\)|COUNT\(\*\))$~',$X)?$X:idf_escape($X)).(isset($_GET["desc"][$z])?" DESC":"");}return$K;}function
selectLimitProcess(){return(isset($_GET["limit"])?$_GET["limit"]:"50");}function
selectLengthProcess(){return(isset($_GET["text_length"])?$_GET["text_length"]:"100");}function
selectEmailProcess($Z,$yc){return
false;}function
selectQueryBuild($N,$Z,$s,$ue,$_,$F){return"";}function
messageQuery($I,$Ag,$nc=false){global$y,$k;restart_session();$Pc=&get_session("queries");if(!$Pc[$_GET["db"]])$Pc[$_GET["db"]]=array();if(strlen($I)>1e6)$I=preg_replace('~[\x80-\xFF]+$~','',substr($I,0,1e6))."\nâ€¦";$Pc[$_GET["db"]][]=array($I,time(),$Ag);$Zf="sql-".count($Pc[$_GET["db"]]);$K="<a href='#$Zf' class='toggle'>".lang(60)."</a>\n";if(!$nc&&($sh=$k->warnings())){$u="warnings-".count($Pc[$_GET["db"]]);$K="<a href='#$u' class='toggle'>".lang(42)."</a>, $K<div id='$u' class='hidden'>\n$sh</div>\n";}return" <span class='time'>".@date("H:i:s")."</span>"." $K<div id='$Zf' class='hidden'><pre><code class='jush-$y'>".shorten_utf8($I,1000)."</code></pre>".($Ag?" <span class='time'>($Ag)</span>":'').(support("sql")?'<p><a href="'.h(str_replace("db=".urlencode(DB),"db=".urlencode($_GET["db"]),ME).'sql=&history='.(count($Pc[$_GET["db"]])-1)).'">'.lang(10).'</a>':'').'</div>';}function
editFunctions($m){global$Pb;$K=($m["null"]?"NULL/":"");foreach($Pb
as$z=>$Dc){if(!$z||(!isset($_GET["call"])&&(isset($_GET["select"])||where($_GET)))){foreach($Dc
as$Pe=>$X){if(!$Pe||preg_match("~$Pe~",$m["type"]))$K.="/$X";}if($z&&!preg_match('~set|blob|bytea|raw|file~',$m["type"]))$K.="/SQL";}}if($m["auto_increment"]&&!isset($_GET["select"])&&!where($_GET))$K=lang(47);return
explode("/",$K);}function
editInput($Q,$m,$xa,$Y){if($m["type"]=="enum")return(isset($_GET["select"])?"<label><input type='radio'$xa value='-1' checked><i>".lang(8)."</i></label> ":"").($m["null"]?"<label><input type='radio'$xa value=''".($Y!==null||isset($_GET["select"])?"":" checked")."><i>NULL</i></label> ":"").enum_input("radio",$xa,$m,$Y,0);return"";}function
editHint($Q,$m,$Y){return"";}function
processInput($m,$Y,$q=""){if($q=="SQL")return$Y;$E=$m["field"];$K=q($Y);if(preg_match('~^(now|getdate|uuid)$~',$q))$K="$q()";elseif(preg_match('~^current_(date|timestamp)$~',$q))$K=$q;elseif(preg_match('~^([+-]|\|\|)$~',$q))$K=idf_escape($E)." $q $K";elseif(preg_match('~^[+-] interval$~',$q))$K=idf_escape($E)." $q ".(preg_match("~^(\\d+|'[0-9.: -]') [A-Z_]+\$~i",$Y)?$Y:$K);elseif(preg_match('~^(addtime|subtime|concat)$~',$q))$K="$q(".idf_escape($E).", $K)";elseif(preg_match('~^(md5|sha1|password|encrypt)$~',$q))$K="$q($K)";return
unconvert_field($m,$K);}function
dumpOutput(){$K=array('text'=>lang(61),'file'=>lang(62));if(function_exists('gzencode'))$K['gz']='gzip';return$K;}function
dumpFormat(){return
array('sql'=>'SQL','csv'=>'CSV,','csv;'=>'CSV;','tsv'=>'TSV');}function
dumpDatabase($j){}function
dumpTable($Q,$hg,$id=0){if($_POST["format"]!="sql"){echo"\xef\xbb\xbf";if($hg)dump_csv(array_keys(fields($Q)));}else{if($id==2){$n=array();foreach(fields($Q)as$E=>$m)$n[]=idf_escape($E)." $m[full_type]";$h="CREATE TABLE ".table($Q)." (".implode(", ",$n).")";}else$h=create_sql($Q,$_POST["auto_increment"],$hg);set_utf8mb4($h);if($hg&&$h){if($hg=="DROP+CREATE"||$id==1)echo"DROP ".($id==2?"VIEW":"TABLE")." IF EXISTS ".table($Q).";\n";if($id==1)$h=remove_definer($h);echo"$h;\n\n";}}}function
dumpData($Q,$hg,$I){global$f,$y;$Hd=($y=="sqlite"?0:1048576);if($hg){if($_POST["format"]=="sql"){if($hg=="TRUNCATE+INSERT")echo
truncate_sql($Q).";\n";$n=fields($Q);}$J=$f->query($I,1);if($J){$bd="";$Ja="";$ld=array();$jg="";$qc=($Q!=''?'fetch_assoc':'fetch_row');while($L=$J->$qc()){if(!$ld){$kh=array();foreach($L
as$X){$m=$J->fetch_field();$ld[]=$m->name;$z=idf_escape($m->name);$kh[]="$z = VALUES($z)";}$jg=($hg=="INSERT+UPDATE"?"\nON DUPLICATE KEY UPDATE ".implode(", ",$kh):"").";\n";}if($_POST["format"]!="sql"){if($hg=="table"){dump_csv($ld);$hg="INSERT";}dump_csv($L);}else{if(!$bd)$bd="INSERT INTO ".table($Q)." (".implode(", ",array_map('idf_escape',$ld)).") VALUES";foreach($L
as$z=>$X){$m=$n[$z];$L[$z]=($X!==null?unconvert_field($m,preg_match(number_type(),$m["type"])&&$X!=''&&!preg_match('~\[~',$m["full_type"])?$X:q(($X===false?0:$X))):"NULL");}$Cf=($Hd?"\n":" ")."(".implode(",\t",$L).")";if(!$Ja)$Ja=$bd.$Cf;elseif(strlen($Ja)+4+strlen($Cf)+strlen($jg)<$Hd)$Ja.=",$Cf";else{echo$Ja.$jg;$Ja=$bd.$Cf;}}}if($Ja)echo$Ja.$jg;}elseif($_POST["format"]=="sql")echo"-- ".str_replace("\n"," ",$f->error)."\n";}}function
dumpFilename($Tc){return
friendly_url($Tc!=""?$Tc:(SERVER!=""?SERVER:"localhost"));}function
dumpHeaders($Tc,$Td=false){$De=$_POST["output"];$kc=(preg_match('~sql~',$_POST["format"])?"sql":($Td?"tar":"csv"));header("Content-Type: ".($De=="gz"?"application/x-gzip":($kc=="tar"?"application/x-tar":($kc=="sql"||$De!="file"?"text/plain":"text/csv")."; charset=utf-8")));if($De=="gz")ob_start('ob_gzencode',1e6);return$kc;}function
importServerPath(){return"adminer.sql";}function
homepage(){echo'<p class="links">'.($_GET["ns"]==""&&support("database")?'<a href="'.h(ME).'database=">'.lang(63)."</a>\n":""),(support("scheme")?"<a href='".h(ME)."scheme='>".($_GET["ns"]!=""?lang(64):lang(65))."</a>\n":""),($_GET["ns"]!==""?'<a href="'.h(ME).'schema=">'.lang(66)."</a>\n":""),(support("privileges")?"<a href='".h(ME)."privileges='>".lang(67)."</a>\n":"");return
true;}function
navigation($Sd){global$ga,$y,$Ib,$f;echo'<h1>
',$this->name(),' <span class="version">',$ga,'</span>
<a href="https://www.adminer.org/#download"',target_blank(),' id="version">',(version_compare($ga,$_COOKIE["adminer_version"])<0?h($_COOKIE["adminer_version"]):""),'</a>
</h1>
';if($Sd=="auth"){$uc=true;foreach((array)$_SESSION["pwds"]as$mh=>$Nf){foreach($Nf
as$O=>$ih){foreach($ih
as$V=>$G){if($G!==null){if($uc){echo"<ul id='logins'>".script("mixin(qs('#logins'), {onmouseover: menuOver, onmouseout: menuOut});");$uc=false;}$wb=$_SESSION["db"][$mh][$O][$V];foreach(($wb?array_keys($wb):array(""))as$j)echo"<li><a href='".h(auth_url($mh,$O,$V,$j))."'>($Ib[$mh]) ".h($V.($O!=""?"@".$this->serverName($O):"").($j!=""?" - $j":""))."</a>\n";}}}}}else{if($_GET["ns"]!==""&&!$Sd&&DB!=""){$f->select_db(DB);$S=table_status('',true);}echo
script_src(preg_replace("~\\?.*~","",ME)."?file=jush.js&version=4.7.1");if(support("sql")){echo'<script',nonce(),'>
';if($S){$Ad=array();foreach($S
as$Q=>$U)$Ad[]=preg_quote($Q,'/');echo"var jushLinks = { $y: [ '".js_escape(ME).(support("table")?"table=":"select=")."\$&', /\\b(".implode("|",$Ad).")\\b/g ] };\n";foreach(array("bac","bra","sqlite_quo","mssql_bra")as$X)echo"jushLinks.$X = jushLinks.$y;\n";}$Mf=$f->server_info;echo'bodyLoad(\'',(is_object($f)?preg_replace('~^(\d\.?\d).*~s','\1',$Mf):""),'\'',(preg_match('~MariaDB~',$Mf)?", true":""),');
</script>
';}$this->databasesPrint($Sd);if(DB==""||!$Sd){echo"<p class='links'>".(support("sql")?"<a href='".h(ME)."sql='".bold(isset($_GET["sql"])&&!isset($_GET["import"])).">".lang(60)."</a>\n<a href='".h(ME)."import='".bold(isset($_GET["import"])).">".lang(68)."</a>\n":"")."";if(support("dump"))echo"<a href='".h(ME)."dump=".urlencode(isset($_GET["table"])?$_GET["table"]:$_GET["select"])."' id='dump'".bold(isset($_GET["dump"])).">".lang(69)."</a>\n";}if($_GET["ns"]!==""&&!$Sd&&DB!=""){echo'<a href="'.h(ME).'create="'.bold($_GET["create"]==="").">".lang(70)."</a>\n";if(!$S)echo"<p class='message'>".lang(9)."\n";else$this->tablesPrint($S);}}}function
databasesPrint($Sd){global$b,$f;$i=$this->databases();if($i&&!in_array(DB,$i))array_unshift($i,DB);echo'<form action="">
<p id="dbs">
';hidden_fields_get();$ub=script("mixin(qsl('select'), {onmousedown: dbMouseDown, onchange: dbChange});");echo"<span title='".lang(71)."'>".lang(72)."</span>: ".($i?"<select name='db'>".optionlist(array(""=>"")+$i,DB)."</select>$ub":"<input name='db' value='".h(DB)."' autocapitalize='off'>\n"),"<input type='submit' value='".lang(20)."'".($i?" class='hidden'":"").">\n";if($Sd!="db"&&DB!=""&&$f->select_db(DB)){}foreach(array("import","sql","schema","dump","privileges")as$X){if(isset($_GET[$X])){echo"<input type='hidden' name='$X' value=''>";break;}}echo"</p></form>\n";}function
tablesPrint($S){echo"<ul id='tables'>".script("mixin(qs('#tables'), {onmouseover: menuOver, onmouseout: menuOut});");foreach($S
as$Q=>$cg){$E=$this->tableName($cg);if($E!=""){echo'<li><a href="'.h(ME).'select='.urlencode($Q).'"'.bold($_GET["select"]==$Q||$_GET["edit"]==$Q,"select").">".lang(73)."</a> ",(support("table")||support("indexes")?'<a href="'.h(ME).'table='.urlencode($Q).'"'.bold(in_array($Q,array($_GET["table"],$_GET["create"],$_GET["indexes"],$_GET["foreign"],$_GET["trigger"])),(is_view($cg)?"view":"structure"))." title='".lang(38)."'>$E</a>":"<span>$E</span>")."\n";}}echo"</ul>\n";}}$b=(function_exists('adminer_object')?adminer_object():new
Adminer);if($b->operators===null)$b->operators=$qe;function
page_header($Dg,$l="",$Ia=array(),$Eg=""){global$ca,$ga,$b,$Ib,$y;page_headers();if(is_ajax()&&$l){page_messages($l);exit;}$Fg=$Dg.($Eg!=""?": $Eg":"");$Gg=strip_tags($Fg.(SERVER!=""&&SERVER!="localhost"?h(" - ".SERVER):"")." - ".$b->name());echo'<!DOCTYPE html>
<html lang="',$ca,'" dir="',lang(74),'">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="robots" content="noindex">
<title>',$Gg,'</title>
<link rel="stylesheet" type="text/css" href="',h(preg_replace("~\\?.*~","",ME)."?file=default.css&version=4.7.1"),'">
',script_src(preg_replace("~\\?.*~","",ME)."?file=functions.js&version=4.7.1");if($b->head()){echo'<link rel="shortcut icon" type="image/x-icon" href="',h(preg_replace("~\\?.*~","",ME)."?file=favicon.ico&version=4.7.1"),'">
<link rel="apple-touch-icon" href="',h(preg_replace("~\\?.*~","",ME)."?file=favicon.ico&version=4.7.1"),'">
';foreach($b->css()as$ob){echo'<link rel="stylesheet" type="text/css" href="',h($ob),'">
';}}echo'
<body class="',lang(74),' nojs">
';$sc=get_temp_dir()."/adminer.version";if(!$_COOKIE["adminer_version"]&&function_exists('openssl_verify')&&file_exists($sc)&&filemtime($sc)+86400>time()){$nh=unserialize(file_get_contents($sc));$gf="-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwqWOVuF5uw7/+Z70djoK
RlHIZFZPO0uYRezq90+7Amk+FDNd7KkL5eDve+vHRJBLAszF/7XKXe11xwliIsFs
DFWQlsABVZB3oisKCBEuI71J4kPH8dKGEWR9jDHFw3cWmoH3PmqImX6FISWbG3B8
h7FIx3jEaw5ckVPVTeo5JRm/1DZzJxjyDenXvBQ/6o9DgZKeNDgxwKzH+sw9/YCO
jHnq1cFpOIISzARlrHMa/43YfeNRAm/tsBXjSxembBPo7aQZLAWHmaj5+K19H10B
nCpz9Y++cipkVEiKRGih4ZEvjoFysEOdRLj6WiD/uUNky4xGeA6LaJqh5XpkFkcQ
fQIDAQAB
-----END PUBLIC KEY-----
";if(openssl_verify($nh["version"],base64_decode($nh["signature"]),$gf)==1)$_COOKIE["adminer_version"]=$nh["version"];}echo'<script',nonce(),'>
mixin(document.body, {onkeydown: bodyKeydown, onclick: bodyClick',(isset($_COOKIE["adminer_version"])?"":", onload: partial(verifyVersion, '$ga', '".js_escape(ME)."', '".get_token()."')");?>});
document.body.className = document.body.className.replace(/ nojs/, ' js');
var offlineMessage = '<?php echo
js_escape(lang(75)),'\';
var thousandsSeparator = \'',js_escape(lang(5)),'\';
</script>

<div id="help" class="jush-',$y,' jsonly hidden"></div>
',script("mixin(qs('#help'), {onmouseover: function () { helpOpen = 1; }, onmouseout: helpMouseout});"),'
<div id="content">
';if($Ia!==null){$A=substr(preg_replace('~\b(username|db|ns)=[^&]*&~','',ME),0,-1);echo'<p id="breadcrumb"><a href="'.h($A?$A:".").'">'.$Ib[DRIVER].'</a> &raquo; ';$A=substr(preg_replace('~\b(db|ns)=[^&]*&~','',ME),0,-1);$O=$b->serverName(SERVER);$O=($O!=""?$O:lang(30));if($Ia===false)echo"$O\n";else{echo"<a href='".($A?h($A):".")."' accesskey='1' title='Alt+Shift+1'>$O</a> &raquo; ";if($_GET["ns"]!=""||(DB!=""&&is_array($Ia)))echo'<a href="'.h($A."&db=".urlencode(DB).(support("scheme")?"&ns=":"")).'">'.h(DB).'</a> &raquo; ';if(is_array($Ia)){if($_GET["ns"]!="")echo'<a href="'.h(substr(ME,0,-1)).'">'.h($_GET["ns"]).'</a> &raquo; ';foreach($Ia
as$z=>$X){$Ab=(is_array($X)?$X[1]:h($X));if($Ab!="")echo"<a href='".h(ME."$z=").urlencode(is_array($X)?$X[0]:$X)."'>$Ab</a> &raquo; ";}}echo"$Dg\n";}}echo"<h2>$Fg</h2>\n","<div id='ajaxstatus' class='jsonly hidden'></div>\n";restart_session();page_messages($l);$i=&get_session("dbs");if(DB!=""&&$i&&!in_array(DB,$i,true))$i=null;stop_session();define("PAGE_HEADER",1);}function
page_headers(){global$b;header("Content-Type: text/html; charset=utf-8");header("Cache-Control: no-cache");header("X-Frame-Options: deny");header("X-XSS-Protection: 0");header("X-Content-Type-Options: nosniff");header("Referrer-Policy: origin-when-cross-origin");foreach($b->csp()as$nb){$Nc=array();foreach($nb
as$z=>$X)$Nc[]="$z $X";header("Content-Security-Policy: ".implode("; ",$Nc));}$b->headers();}function
csp(){return
array(array("script-src"=>"'self' 'unsafe-inline' 'nonce-".get_nonce()."' 'strict-dynamic'","connect-src"=>"'self'","frame-src"=>"https://www.adminer.org","object-src"=>"'none'","base-uri"=>"'none'","form-action"=>"'self'",),);}function
get_nonce(){static$be;if(!$be)$be=base64_encode(rand_string());return$be;}function
page_messages($l){$dh=preg_replace('~^[^?]*~','',$_SERVER["REQUEST_URI"]);$Qd=$_SESSION["messages"][$dh];if($Qd){echo"<div class='message'>".implode("</div>\n<div class='message'>",$Qd)."</div>".script("messagesPrint();");unset($_SESSION["messages"][$dh]);}if($l)echo"<div class='error'>$l</div>\n";}function
page_footer($Sd=""){global$b,$T;echo'</div>

';switch_lang();if($Sd!="auth"){echo'<form action="" method="post">
<p class="logout">
<input type="submit" name="logout" value="',lang(76),'" id="logout">
<input type="hidden" name="token" value="',$T,'">
</p>
</form>
';}echo'<div id="menu">
';$b->navigation($Sd);echo'</div>
',script("setupSubmitHighlight(document);");}function
int32($Vd){while($Vd>=2147483648)$Vd-=4294967296;while($Vd<=-2147483649)$Vd+=4294967296;return(int)$Vd;}function
long2str($W,$rh){$Cf='';foreach($W
as$X)$Cf.=pack('V',$X);if($rh)return
substr($Cf,0,end($W));return$Cf;}function
str2long($Cf,$rh){$W=array_values(unpack('V*',str_pad($Cf,4*ceil(strlen($Cf)/4),"\0")));if($rh)$W[]=strlen($Cf);return$W;}function
xxtea_mx($yh,$xh,$kg,$kd){return
int32((($yh>>5&0x7FFFFFF)^$xh<<2)+(($xh>>3&0x1FFFFFFF)^$yh<<4))^int32(($kg^$xh)+($kd^$yh));}function
encrypt_string($eg,$z){if($eg=="")return"";$z=array_values(unpack("V*",pack("H*",md5($z))));$W=str2long($eg,true);$Vd=count($W)-1;$yh=$W[$Vd];$xh=$W[0];$H=floor(6+52/($Vd+1));$kg=0;while($H-->0){$kg=int32($kg+0x9E3779B9);$Ob=$kg>>2&3;for($Ee=0;$Ee<$Vd;$Ee++){$xh=$W[$Ee+1];$Ud=xxtea_mx($yh,$xh,$kg,$z[$Ee&3^$Ob]);$yh=int32($W[$Ee]+$Ud);$W[$Ee]=$yh;}$xh=$W[0];$Ud=xxtea_mx($yh,$xh,$kg,$z[$Ee&3^$Ob]);$yh=int32($W[$Vd]+$Ud);$W[$Vd]=$yh;}return
long2str($W,false);}function
decrypt_string($eg,$z){if($eg=="")return"";if(!$z)return
false;$z=array_values(unpack("V*",pack("H*",md5($z))));$W=str2long($eg,false);$Vd=count($W)-1;$yh=$W[$Vd];$xh=$W[0];$H=floor(6+52/($Vd+1));$kg=int32($H*0x9E3779B9);while($kg){$Ob=$kg>>2&3;for($Ee=$Vd;$Ee>0;$Ee--){$yh=$W[$Ee-1];$Ud=xxtea_mx($yh,$xh,$kg,$z[$Ee&3^$Ob]);$xh=int32($W[$Ee]-$Ud);$W[$Ee]=$xh;}$yh=$W[$Vd];$Ud=xxtea_mx($yh,$xh,$kg,$z[$Ee&3^$Ob]);$xh=int32($W[0]-$Ud);$W[0]=$xh;$kg=int32($kg-0x9E3779B9);}return
long2str($W,true);}$f='';$Mc=$_SESSION["token"];if(!$Mc)$_SESSION["token"]=rand(1,1e6);$T=get_token();$Qe=array();if($_COOKIE["adminer_permanent"]){foreach(explode(" ",$_COOKIE["adminer_permanent"])as$X){list($z)=explode(":",$X);$Qe[$z]=$X;}}function
add_invalid_login(){global$b;$p=file_open_lock(get_temp_dir()."/adminer.invalid");if(!$p)return;$ed=unserialize(stream_get_contents($p));$Ag=time();if($ed){foreach($ed
as$fd=>$X){if($X[0]<$Ag)unset($ed[$fd]);}}$dd=&$ed[$b->bruteForceKey()];if(!$dd)$dd=array($Ag+30*60,0);$dd[1]++;file_write_unlock($p,serialize($ed));}function
check_invalid_login(){global$b;$ed=unserialize(@file_get_contents(get_temp_dir()."/adminer.invalid"));$dd=$ed[$b->bruteForceKey()];$ae=($dd[1]>29?$dd[0]-time():0);if($ae>0)auth_error(lang(77,ceil($ae/60)));}$ya=$_POST["auth"];if($ya){session_regenerate_id();$mh=$ya["driver"];$O=$ya["server"];$V=$ya["username"];$G=(string)$ya["password"];$j=$ya["db"];set_password($mh,$O,$V,$G);$_SESSION["db"][$mh][$O][$V][$j]=true;if($ya["permanent"]){$z=base64_encode($mh)."-".base64_encode($O)."-".base64_encode($V)."-".base64_encode($j);$bf=$b->permanentLogin(true);$Qe[$z]="$z:".base64_encode($bf?encrypt_string($G,$bf):"");cookie("adminer_permanent",implode(" ",$Qe));}if(count($_POST)==1||DRIVER!=$mh||SERVER!=$O||$_GET["username"]!==$V||DB!=$j)redirect(auth_url($mh,$O,$V,$j));}elseif($_POST["logout"]){if($Mc&&!verify_token()){page_header(lang(76),lang(78));page_footer("db");exit;}else{foreach(array("pwds","db","dbs","queries")as$z)set_session($z,null);unset_permanent();redirect(substr(preg_replace('~\b(username|db|ns)=[^&]*&~','',ME),0,-1),lang(79).' '.lang(80));}}elseif($Qe&&!$_SESSION["pwds"]){session_regenerate_id();$bf=$b->permanentLogin();foreach($Qe
as$z=>$X){list(,$Ra)=explode(":",$X);list($mh,$O,$V,$j)=array_map('base64_decode',explode("-",$z));set_password($mh,$O,$V,decrypt_string(base64_decode($Ra),$bf));$_SESSION["db"][$mh][$O][$V][$j]=true;}}function
unset_permanent(){global$Qe;foreach($Qe
as$z=>$X){list($mh,$O,$V,$j)=array_map('base64_decode',explode("-",$z));if($mh==DRIVER&&$O==SERVER&&$V==$_GET["username"]&&$j==DB)unset($Qe[$z]);}cookie("adminer_permanent",implode(" ",$Qe));}function
auth_error($l){global$b,$Mc;$Of=session_name();if(isset($_GET["username"])){header("HTTP/1.1 403 Forbidden");if(($_COOKIE[$Of]||$_GET[$Of])&&!$Mc)$l=lang(81);else{restart_session();add_invalid_login();$G=get_password();if($G!==null){if($G===false)$l.='<br>'.lang(82,target_blank(),'<code>permanentLogin()</code>');set_password(DRIVER,SERVER,$_GET["username"],null);}unset_permanent();}}if(!$_COOKIE[$Of]&&$_GET[$Of]&&ini_bool("session.use_only_cookies"))$l=lang(83);$He=session_get_cookie_params();cookie("adminer_key",($_COOKIE["adminer_key"]?$_COOKIE["adminer_key"]:rand_string()),$He["lifetime"]);page_header(lang(34),$l,null);echo"<form action='' method='post'>\n","<div>";if(hidden_fields($_POST,array("auth")))echo"<p class='message'>".lang(84)."\n";echo"</div>\n";$b->loginForm();echo"</form>\n";page_footer("auth");exit;}if(isset($_GET["username"])&&!class_exists("Min_DB")){unset($_SESSION["pwds"][DRIVER]);unset_permanent();page_header(lang(85),lang(86,implode(", ",$We)),false);page_footer("auth");exit;}stop_session(true);if(isset($_GET["username"])){list($Rc,$Se)=explode(":",SERVER,2);if(is_numeric($Se)&&$Se<1024)auth_error(lang(87));check_invalid_login();$f=connect();$k=new
Min_Driver($f);}$Bd=null;if(!is_object($f)||($Bd=$b->login($_GET["username"],get_password()))!==true){$l=(is_string($f)?h($f):(is_string($Bd)?$Bd:lang(88)));auth_error($l.(preg_match('~^ | $~',get_password())?'<br>'.lang(89):''));}if($ya&&$_POST["token"])$_POST["token"]=$T;$l='';if($_POST){if(!verify_token()){$Yc="max_input_vars";$Ld=ini_get($Yc);if(extension_loaded("suhosin")){foreach(array("suhosin.request.max_vars","suhosin.post.max_vars")as$z){$X=ini_get($z);if($X&&(!$Ld||$X<$Ld)){$Yc=$z;$Ld=$X;}}}$l=(!$_POST["token"]&&$Ld?lang(90,"'$Yc'"):lang(78).' '.lang(91));}}elseif($_SERVER["REQUEST_METHOD"]=="POST"){$l=lang(92,"'post_max_size'");if(isset($_GET["sql"]))$l.=' '.lang(93);}function
select($J,$g=null,$xe=array(),$_=0){global$y;$Ad=array();$x=array();$d=array();$Ga=array();$Ug=array();$K=array();odd('');for($t=0;(!$_||$t<$_)&&($L=$J->fetch_row());$t++){if(!$t){echo"<div class='scrollable'>\n","<table cellspacing='0' class='nowrap'>\n","<thead><tr>";for($jd=0;$jd<count($L);$jd++){$m=$J->fetch_field();$E=$m->name;$we=$m->orgtable;$ve=$m->orgname;$K[$m->table]=$we;if($xe&&$y=="sql")$Ad[$jd]=($E=="table"?"table=":($E=="possible_keys"?"indexes=":null));elseif($we!=""){if(!isset($x[$we])){$x[$we]=array();foreach(indexes($we,$g)as$w){if($w["type"]=="PRIMARY"){$x[$we]=array_flip($w["columns"]);break;}}$d[$we]=$x[$we];}if(isset($d[$we][$ve])){unset($d[$we][$ve]);$x[$we][$ve]=$jd;$Ad[$jd]=$we;}}if($m->charsetnr==63)$Ga[$jd]=true;$Ug[$jd]=$m->type;echo"<th".($we!=""||$m->name!=$ve?" title='".h(($we!=""?"$we.":"").$ve)."'":"").">".h($E).($xe?doc_link(array('sql'=>"explain-output.html#explain_".strtolower($E),'mariadb'=>"explain/#the-columns-in-explain-select",)):"");}echo"</thead>\n";}echo"<tr".odd().">";foreach($L
as$z=>$X){if($X===null)$X="<i>NULL</i>";elseif($Ga[$z]&&!is_utf8($X))$X="<i>".lang(43,strlen($X))."</i>";else{$X=h($X);if($Ug[$z]==254)$X="<code>$X</code>";}if(isset($Ad[$z])&&!$d[$Ad[$z]]){if($xe&&$y=="sql"){$Q=$L[array_search("table=",$Ad)];$A=$Ad[$z].urlencode($xe[$Q]!=""?$xe[$Q]:$Q);}else{$A="edit=".urlencode($Ad[$z]);foreach($x[$Ad[$z]]as$Va=>$jd)$A.="&where".urlencode("[".bracket_escape($Va)."]")."=".urlencode($L[$jd]);}$X="<a href='".h(ME.$A)."'>$X</a>";}echo"<td>$X";}}echo($t?"</table>\n</div>":"<p class='message'>".lang(12))."\n";return$K;}function
referencable_primary($Jf){$K=array();foreach(table_status('',true)as$og=>$Q){if($og!=$Jf&&fk_support($Q)){foreach(fields($og)as$m){if($m["primary"]){if($K[$og]){unset($K[$og]);break;}$K[$og]=$m;}}}}return$K;}function
adminer_settings(){parse_str($_COOKIE["adminer_settings"],$Qf);return$Qf;}function
adminer_setting($z){$Qf=adminer_settings();return$Qf[$z];}function
set_adminer_settings($Qf){return
cookie("adminer_settings",http_build_query($Qf+adminer_settings()));}function
textarea($E,$Y,$M=10,$Za=80){global$y;echo"<textarea name='$E' rows='$M' cols='$Za' class='sqlarea jush-$y' spellcheck='false' wrap='off'>";if(is_array($Y)){foreach($Y
as$X)echo
h($X[0])."\n\n\n";}else
echo
h($Y);echo"</textarea>";}function
edit_type($z,$m,$Ya,$zc=array(),$mc=array()){global$gg,$Ug,$bh,$me;$U=$m["type"];echo'<td><select name="',h($z),'[type]" class="type" aria-labelledby="label-type">';if($U&&!isset($Ug[$U])&&!isset($zc[$U])&&!in_array($U,$mc))$mc[]=$U;if($zc)$gg[lang(94)]=$zc;echo
optionlist(array_merge($mc,$gg),$U),'</select>
',on_help("getTarget(event).value",1),script("mixin(qsl('select'), {onfocus: function () { lastType = selectValue(this); }, onchange: editingTypeChange});",""),'<td><input name="',h($z),'[length]" value="',h($m["length"]),'" size="3"',(!$m["length"]&&preg_match('~var(char|binary)$~',$U)?" class='required'":"");echo' aria-labelledby="label-length">',script("mixin(qsl('input'), {onfocus: editingLengthFocus, oninput: editingLengthChange});",""),'<td class="options">',"<select name='".h($z)."[collation]'".(preg_match('~(char|text|enum|set)$~',$U)?"":" class='hidden'").'><option value="">('.lang(95).')'.optionlist($Ya,$m["collation"]).'</select>',($bh?"<select name='".h($z)."[unsigned]'".(!$U||preg_match(number_type(),$U)?"":" class='hidden'").'><option>'.optionlist($bh,$m["unsigned"]).'</select>':''),(isset($m['on_update'])?"<select name='".h($z)."[on_update]'".(preg_match('~timestamp|datetime~',$U)?"":" class='hidden'").'>'.optionlist(array(""=>"(".lang(96).")","CURRENT_TIMESTAMP"),(preg_match('~^CURRENT_TIMESTAMP~i',$m["on_update"])?"CURRENT_TIMESTAMP":$m["on_update"])).'</select>':''),($zc?"<select name='".h($z)."[on_delete]'".(preg_match("~`~",$U)?"":" class='hidden'")."><option value=''>(".lang(97).")".optionlist(explode("|",$me),$m["on_delete"])."</select> ":" ");}function
process_length($yd){global$Zb;return(preg_match("~^\\s*\\(?\\s*$Zb(?:\\s*,\\s*$Zb)*+\\s*\\)?\\s*\$~",$yd)&&preg_match_all("~$Zb~",$yd,$Fd)?"(".implode(",",$Fd[0]).")":preg_replace('~^[0-9].*~','(\0)',preg_replace('~[^-0-9,+()[\]]~','',$yd)));}function
process_type($m,$Wa="COLLATE"){global$bh;return" $m[type]".process_length($m["length"]).(preg_match(number_type(),$m["type"])&&in_array($m["unsigned"],$bh)?" $m[unsigned]":"").(preg_match('~char|text|enum|set~',$m["type"])&&$m["collation"]?" $Wa ".q($m["collation"]):"");}function
process_field($m,$Sg){return
array(idf_escape(trim($m["field"])),process_type($Sg),($m["null"]?" NULL":" NOT NULL"),default_value($m),(preg_match('~timestamp|datetime~',$m["type"])&&$m["on_update"]?" ON UPDATE $m[on_update]":""),(support("comment")&&$m["comment"]!=""?" COMMENT ".q($m["comment"]):""),($m["auto_increment"]?auto_increment():null),);}function
default_value($m){$yb=$m["default"];return($yb===null?"":" DEFAULT ".(preg_match('~char|binary|text|enum|set~',$m["type"])||preg_match('~^(?![a-z])~i',$yb)?q($yb):$yb));}function
type_class($U){foreach(array('char'=>'text','date'=>'time|year','binary'=>'blob','enum'=>'set',)as$z=>$X){if(preg_match("~$z|$X~",$U))return" class='$z'";}}function
edit_fields($n,$Ya,$U="TABLE",$zc=array()){global$Zc;$n=array_values($n);echo'<thead><tr>
';if($U=="PROCEDURE"){echo'<td>';}echo'<th id="label-name">',($U=="TABLE"?lang(98):lang(99)),'<td id="label-type">',lang(45),'<textarea id="enum-edit" rows="4" cols="12" wrap="off" style="display: none;"></textarea>',script("qs('#enum-edit').onblur = editingLengthBlur;"),'<td id="label-length">',lang(100),'<td>',lang(101);if($U=="TABLE"){echo'<td id="label-null">NULL
<td><input type="radio" name="auto_increment_col" value=""><acronym id="label-ai" title="',lang(47),'">AI</acronym>',doc_link(array('sql'=>"example-auto-increment.html",'mariadb'=>"auto_increment/",'sqlite'=>"autoinc.html",'pgsql'=>"datatype.html#DATATYPE-SERIAL",'mssql'=>"ms186775.aspx",)),'<td id="label-default">',lang(48),(support("comment")?"<td id='label-comment'>".lang(46):"");}echo'<td>',"<input type='image' class='icon' name='add[".(support("move_col")?0:count($n))."]' src='".h(preg_replace("~\\?.*~","",ME)."?file=plus.gif&version=4.7.1")."' alt='+' title='".lang(102)."'>".script("row_count = ".count($n).";"),'</thead>
<tbody>
',script("mixin(qsl('tbody'), {onclick: editingClick, onkeydown: editingKeydown, oninput: editingInput});");foreach($n
as$t=>$m){$t++;$ye=$m[($_POST?"orig":"field")];$Eb=(isset($_POST["add"][$t-1])||(isset($m["field"])&&!$_POST["drop_col"][$t]))&&(support("drop_col")||$ye=="");echo'<tr',($Eb?"":" style='display: none;'"),'>
',($U=="PROCEDURE"?"<td>".html_select("fields[$t][inout]",explode("|",$Zc),$m["inout"]):""),'<th>';if($Eb){echo'<input name="fields[',$t,'][field]" value="',h($m["field"]),'" data-maxlength="64" autocapitalize="off" aria-labelledby="label-name">',script("qsl('input').oninput = function () { editingNameChange.call(this);".($m["field"]!=""||count($n)>1?"":" editingAddRow.call(this);")." };","");}echo'<input type="hidden" name="fields[',$t,'][orig]" value="',h($ye),'">
';edit_type("fields[$t]",$m,$Ya,$zc);if($U=="TABLE"){echo'<td>',checkbox("fields[$t][null]",1,$m["null"],"","","block","label-null"),'<td><label class="block"><input type="radio" name="auto_increment_col" value="',$t,'"';if($m["auto_increment"]){echo' checked';}echo' aria-labelledby="label-ai"></label><td>',checkbox("fields[$t][has_default]",1,$m["has_default"],"","","","label-default"),'<input name="fields[',$t,'][default]" value="',h($m["default"]),'" aria-labelledby="label-default">',(support("comment")?"<td><input name='fields[$t][comment]' value='".h($m["comment"])."' data-maxlength='".(min_version(5.5)?1024:255)."' aria-labelledby='label-comment'>":"");}echo"<td>",(support("move_col")?"<input type='image' class='icon' name='add[$t]' src='".h(preg_replace("~\\?.*~","",ME)."?file=plus.gif&version=4.7.1")."' alt='+' title='".lang(102)."'> "."<input type='image' class='icon' name='up[$t]' src='".h(preg_replace("~\\?.*~","",ME)."?file=up.gif&version=4.7.1")."' alt='â†‘' title='".lang(103)."'> "."<input type='image' class='icon' name='down[$t]' src='".h(preg_replace("~\\?.*~","",ME)."?file=down.gif&version=4.7.1")."' alt='â†“' title='".lang(104)."'> ":""),($ye==""||support("drop_col")?"<input type='image' class='icon' name='drop_col[$t]' src='".h(preg_replace("~\\?.*~","",ME)."?file=cross.gif&version=4.7.1")."' alt='x' title='".lang(105)."'>":"");}}function
process_fields(&$n){$fe=0;if($_POST["up"]){$sd=0;foreach($n
as$z=>$m){if(key($_POST["up"])==$z){unset($n[$z]);array_splice($n,$sd,0,array($m));break;}if(isset($m["field"]))$sd=$fe;$fe++;}}elseif($_POST["down"]){$Ac=false;foreach($n
as$z=>$m){if(isset($m["field"])&&$Ac){unset($n[key($_POST["down"])]);array_splice($n,$fe,0,array($Ac));break;}if(key($_POST["down"])==$z)$Ac=$m;$fe++;}}elseif($_POST["add"]){$n=array_values($n);array_splice($n,key($_POST["add"]),0,array(array()));}elseif(!$_POST["drop_col"])return
false;return
true;}function
normalize_enum($C){return"'".str_replace("'","''",addcslashes(stripcslashes(str_replace($C[0][0].$C[0][0],$C[0][0],substr($C[0],1,-1))),'\\'))."'";}function
grant($r,$df,$d,$le){if(!$df)return
true;if($df==array("ALL PRIVILEGES","GRANT OPTION"))return($r=="GRANT"?queries("$r ALL PRIVILEGES$le WITH GRANT OPTION"):queries("$r ALL PRIVILEGES$le")&&queries("$r GRANT OPTION$le"));return
queries("$r ".preg_replace('~(GRANT OPTION)\([^)]*\)~','\1',implode("$d, ",$df).$d).$le);}function
drop_create($Jb,$h,$Kb,$yg,$Lb,$B,$Pd,$Nd,$Od,$ie,$Yd){if($_POST["drop"])query_redirect($Jb,$B,$Pd);elseif($ie=="")query_redirect($h,$B,$Od);elseif($ie!=$Yd){$lb=queries($h);queries_redirect($B,$Nd,$lb&&queries($Jb));if($lb)queries($Kb);}else
queries_redirect($B,$Nd,queries($yg)&&queries($Lb)&&queries($Jb)&&queries($h));}function
create_trigger($le,$L){global$y;$Cg=" $L[Timing] $L[Event]".($L["Event"]=="UPDATE OF"?" ".idf_escape($L["Of"]):"");return"CREATE TRIGGER ".idf_escape($L["Trigger"]).($y=="mssql"?$le.$Cg:$Cg.$le).rtrim(" $L[Type]\n$L[Statement]",";").";";}function
create_routine($_f,$L){global$Zc,$y;$P=array();$n=(array)$L["fields"];ksort($n);foreach($n
as$m){if($m["field"]!="")$P[]=(preg_match("~^($Zc)\$~",$m["inout"])?"$m[inout] ":"").idf_escape($m["field"]).process_type($m,"CHARACTER SET");}$zb=rtrim("\n$L[definition]",";");return"CREATE $_f ".idf_escape(trim($L["name"]))." (".implode(", ",$P).")".(isset($_GET["function"])?" RETURNS".process_type($L["returns"],"CHARACTER SET"):"").($L["language"]?" LANGUAGE $L[language]":"").($y=="pgsql"?" AS ".q($zb):"$zb;");}function
remove_definer($I){return
preg_replace('~^([A-Z =]+) DEFINER=`'.preg_replace('~@(.*)~','`@`(%|\1)',logged_user()).'`~','\1',$I);}function
format_foreign_key($o){global$me;return" FOREIGN KEY (".implode(", ",array_map('idf_escape',$o["source"])).") REFERENCES ".table($o["table"])." (".implode(", ",array_map('idf_escape',$o["target"])).")".(preg_match("~^($me)\$~",$o["on_delete"])?" ON DELETE $o[on_delete]":"").(preg_match("~^($me)\$~",$o["on_update"])?" ON UPDATE $o[on_update]":"");}function
tar_file($sc,$Hg){$K=pack("a100a8a8a8a12a12",$sc,644,0,0,decoct($Hg->size),decoct(time()));$Qa=8*32;for($t=0;$t<strlen($K);$t++)$Qa+=ord($K[$t]);$K.=sprintf("%06o",$Qa)."\0 ";echo$K,str_repeat("\0",512-strlen($K));$Hg->send();echo
str_repeat("\0",511-($Hg->size+511)%512);}function
ini_bytes($Yc){$X=ini_get($Yc);switch(strtolower(substr($X,-1))){case'g':$X*=1024;case'm':$X*=1024;case'k':$X*=1024;}return$X;}function
doc_link($Oe,$zg="<sup>?</sup>"){global$y,$f;$Mf=$f->server_info;$nh=preg_replace('~^(\d\.?\d).*~s','\1',$Mf);$fh=array('sql'=>"https://dev.mysql.com/doc/refman/$nh/en/",'sqlite'=>"https://www.sqlite.org/",'pgsql'=>"https://www.postgresql.org/docs/$nh/static/",'mssql'=>"https://msdn.microsoft.com/library/",'oracle'=>"https://download.oracle.com/docs/cd/B19306_01/server.102/b14200/",);if(preg_match('~MariaDB~',$Mf)){$fh['sql']="https://mariadb.com/kb/en/library/";$Oe['sql']=(isset($Oe['mariadb'])?$Oe['mariadb']:str_replace(".html","/",$Oe['sql']));}return($Oe[$y]?"<a href='$fh[$y]$Oe[$y]'".target_blank().">$zg</a>":"");}function
ob_gzencode($fg){return
gzencode($fg);}function
db_size($j){global$f;if(!$f->select_db($j))return"?";$K=0;foreach(table_status()as$R)$K+=$R["Data_length"]+$R["Index_length"];return
format_number($K);}function
set_utf8mb4($h){global$f;static$P=false;if(!$P&&preg_match('~\butf8mb4~i',$h)){$P=true;echo"SET NAMES ".charset($f).";\n\n";}}function
connect_error(){global$b,$f,$T,$l,$Ib;if(DB!=""){header("HTTP/1.1 404 Not Found");page_header(lang(33).": ".h(DB),lang(106),true);}else{if($_POST["db"]&&!$l)queries_redirect(substr(ME,0,-1),lang(107),drop_databases($_POST["db"]));page_header(lang(108),$l,false);echo"<p class='links'>\n";foreach(array('database'=>lang(109),'privileges'=>lang(67),'processlist'=>lang(110),'variables'=>lang(111),'status'=>lang(112),)as$z=>$X){if(support($z))echo"<a href='".h(ME)."$z='>$X</a>\n";}echo"<p>".lang(113,$Ib[DRIVER],"<b>".h($f->server_info)."</b>","<b>$f->extension</b>")."\n","<p>".lang(114,"<b>".h(logged_user())."</b>")."\n";$i=$b->databases();if($i){$Ff=support("scheme");$Ya=collations();echo"<form action='' method='post'>\n","<table cellspacing='0' class='checkable'>\n",script("mixin(qsl('table'), {onclick: tableClick, ondblclick: partialArg(tableClick, true)});"),"<thead><tr>".(support("database")?"<td>":"")."<th>".lang(33)." - <a href='".h(ME)."refresh=1'>".lang(115)."</a>"."<td>".lang(116)."<td>".lang(117)."<td>".lang(118)." - <a href='".h(ME)."dbsize=1'>".lang(119)."</a>".script("qsl('a').onclick = partial(ajaxSetHtml, '".js_escape(ME)."script=connect');","")."</thead>\n";$i=($_GET["dbsize"]?count_tables($i):array_flip($i));foreach($i
as$j=>$S){$zf=h(ME)."db=".urlencode($j);$u=h("Db-".$j);echo"<tr".odd().">".(support("database")?"<td>".checkbox("db[]",$j,in_array($j,(array)$_POST["db"]),"","","",$u):""),"<th><a href='$zf' id='$u'>".h($j)."</a>";$Xa=h(db_collation($j,$Ya));echo"<td>".(support("database")?"<a href='$zf".($Ff?"&amp;ns=":"")."&amp;database=' title='".lang(63)."'>$Xa</a>":$Xa),"<td align='right'><a href='$zf&amp;schema=' id='tables-".h($j)."' title='".lang(66)."'>".($_GET["dbsize"]?$S:"?")."</a>","<td align='right' id='size-".h($j)."'>".($_GET["dbsize"]?db_size($j):"?"),"\n";}echo"</table>\n",(support("database")?"<div class='footer'><div>\n"."<fieldset><legend>".lang(120)." <span id='selected'></span></legend><div>\n"."<input type='hidden' name='all' value=''>".script("qsl('input').onclick = function () { selectCount('selected', formChecked(this, /^db/)); };")."<input type='submit' name='drop' value='".lang(121)."'>".confirm()."\n"."</div></fieldset>\n"."</div></div>\n":""),"<input type='hidden' name='token' value='$T'>\n","</form>\n",script("tableCheck();");}}page_footer("db");}if(isset($_GET["status"]))$_GET["variables"]=$_GET["status"];if(isset($_GET["import"]))$_GET["sql"]=$_GET["import"];if(!(DB!=""?$f->select_db(DB):isset($_GET["sql"])||isset($_GET["dump"])||isset($_GET["database"])||isset($_GET["processlist"])||isset($_GET["privileges"])||isset($_GET["user"])||isset($_GET["variables"])||$_GET["script"]=="connect"||$_GET["script"]=="kill")){if(DB!=""||$_GET["refresh"]){restart_session();set_session("dbs",null);}connect_error();exit;}$me="RESTRICT|NO ACTION|CASCADE|SET NULL|SET DEFAULT";class
TmpFile{var$handler;var$size;function
__construct(){$this->handler=tmpfile();}function
write($gb){$this->size+=strlen($gb);fwrite($this->handler,$gb);}function
send(){fseek($this->handler,0);fpassthru($this->handler);fclose($this->handler);}}$Zb="'(?:''|[^'\\\\]|\\\\.)*'";$Zc="IN|OUT|INOUT";if(isset($_GET["select"])&&($_POST["edit"]||$_POST["clone"])&&!$_POST["save"])$_GET["edit"]=$_GET["select"];if(isset($_GET["callf"]))$_GET["call"]=$_GET["callf"];if(isset($_GET["function"]))$_GET["procedure"]=$_GET["function"];if(isset($_GET["download"])){$a=$_GET["download"];$n=fields($a);header("Content-Type: application/octet-stream");header("Content-Disposition: attachment; filename=".friendly_url("$a-".implode("_",$_GET["where"])).".".friendly_url($_GET["field"]));$N=array(idf_escape($_GET["field"]));$J=$k->select($a,$N,array(where($_GET,$n)),$N);$L=($J?$J->fetch_row():array());echo$k->value($L[0],$n[$_GET["field"]]);exit;}elseif(isset($_GET["table"])){$a=$_GET["table"];$n=fields($a);if(!$n)$l=error();$R=table_status1($a,true);$E=$b->tableName($R);page_header(($n&&is_view($R)?$R['Engine']=='materialized view'?lang(122):lang(123):lang(124)).": ".($E!=""?$E:h($a)),$l);$b->selectLinks($R);$cb=$R["Comment"];if($cb!="")echo"<p class='nowrap'>".lang(46).": ".h($cb)."\n";if($n)$b->tableStructurePrint($n);if(!is_view($R)){if(support("indexes")){echo"<h3 id='indexes'>".lang(125)."</h3>\n";$x=indexes($a);if($x)$b->tableIndexesPrint($x);echo'<p class="links"><a href="'.h(ME).'indexes='.urlencode($a).'">'.lang(126)."</a>\n";}if(fk_support($R)){echo"<h3 id='foreign-keys'>".lang(94)."</h3>\n";$zc=foreign_keys($a);if($zc){echo"<table cellspacing='0'>\n","<thead><tr><th>".lang(127)."<td>".lang(128)."<td>".lang(97)."<td>".lang(96)."<td></thead>\n";foreach($zc
as$E=>$o){echo"<tr title='".h($E)."'>","<th><i>".implode("</i>, <i>",array_map('h',$o["source"]))."</i>","<td><a href='".h($o["db"]!=""?preg_replace('~db=[^&]*~',"db=".urlencode($o["db"]),ME):($o["ns"]!=""?preg_replace('~ns=[^&]*~',"ns=".urlencode($o["ns"]),ME):ME))."table=".urlencode($o["table"])."'>".($o["db"]!=""?"<b>".h($o["db"])."</b>.":"").($o["ns"]!=""?"<b>".h($o["ns"])."</b>.":"").h($o["table"])."</a>","(<i>".implode("</i>, <i>",array_map('h',$o["target"]))."</i>)","<td>".h($o["on_delete"])."\n","<td>".h($o["on_update"])."\n",'<td><a href="'.h(ME.'foreign='.urlencode($a).'&name='.urlencode($E)).'">'.lang(129).'</a>';}echo"</table>\n";}echo'<p class="links"><a href="'.h(ME).'foreign='.urlencode($a).'">'.lang(130)."</a>\n";}}if(support(is_view($R)?"view_trigger":"trigger")){echo"<h3 id='triggers'>".lang(131)."</h3>\n";$Rg=triggers($a);if($Rg){echo"<table cellspacing='0'>\n";foreach($Rg
as$z=>$X)echo"<tr valign='top'><td>".h($X[0])."<td>".h($X[1])."<th>".h($z)."<td><a href='".h(ME.'trigger='.urlencode($a).'&name='.urlencode($z))."'>".lang(129)."</a>\n";echo"</table>\n";}echo'<p class="links"><a href="'.h(ME).'trigger='.urlencode($a).'">'.lang(132)."</a>\n";}}elseif(isset($_GET["schema"])){page_header(lang(66),"",array(),h(DB.($_GET["ns"]?".$_GET[ns]":"")));$pg=array();$qg=array();$ea=($_GET["schema"]?$_GET["schema"]:$_COOKIE["adminer_schema-".str_replace(".","_",DB)]);preg_match_all('~([^:]+):([-0-9.]+)x([-0-9.]+)(_|$)~',$ea,$Fd,PREG_SET_ORDER);foreach($Fd
as$t=>$C){$pg[$C[1]]=array($C[2],$C[3]);$qg[]="\n\t'".js_escape($C[1])."': [ $C[2], $C[3] ]";}$Jg=0;$Da=-1;$Ef=array();$qf=array();$wd=array();foreach(table_status('',true)as$Q=>$R){if(is_view($R))continue;$Te=0;$Ef[$Q]["fields"]=array();foreach(fields($Q)as$E=>$m){$Te+=1.25;$m["pos"]=$Te;$Ef[$Q]["fields"][$E]=$m;}$Ef[$Q]["pos"]=($pg[$Q]?$pg[$Q]:array($Jg,0));foreach($b->foreignKeys($Q)as$X){if(!$X["db"]){$ud=$Da;if($pg[$Q][1]||$pg[$X["table"]][1])$ud=min(floatval($pg[$Q][1]),floatval($pg[$X["table"]][1]))-1;else$Da-=.1;while($wd[(string)$ud])$ud-=.0001;$Ef[$Q]["references"][$X["table"]][(string)$ud]=array($X["source"],$X["target"]);$qf[$X["table"]][$Q][(string)$ud]=$X["target"];$wd[(string)$ud]=true;}}$Jg=max($Jg,$Ef[$Q]["pos"][0]+2.5+$Te);}echo'<div id="schema" style="height: ',$Jg,'em;">
<script',nonce(),'>
qs(\'#schema\').onselectstart = function () { return false; };
var tablePos = {',implode(",",$qg)."\n",'};
var em = qs(\'#schema\').offsetHeight / ',$Jg,';
document.onmousemove = schemaMousemove;
document.onmouseup = partialArg(schemaMouseup, \'',js_escape(DB),'\');
</script>
';foreach($Ef
as$E=>$Q){echo"<div class='table' style='top: ".$Q["pos"][0]."em; left: ".$Q["pos"][1]."em;'>",'<a href="'.h(ME).'table='.urlencode($E).'"><b>'.h($E)."</b></a>",script("qsl('div').onmousedown = schemaMousedown;");foreach($Q["fields"]as$m){$X='<span'.type_class($m["type"]).' title="'.h($m["full_type"].($m["null"]?" NULL":'')).'">'.h($m["field"]).'</span>';echo"<br>".($m["primary"]?"<i>$X</i>":$X);}foreach((array)$Q["references"]as$wg=>$rf){foreach($rf
as$ud=>$nf){$vd=$ud-$pg[$E][1];$t=0;foreach($nf[0]as$Vf)echo"\n<div class='references' title='".h($wg)."' id='refs$ud-".($t++)."' style='left: $vd"."em; top: ".$Q["fields"][$Vf]["pos"]."em; padding-top: .5em;'><div style='border-top: 1px solid Gray; width: ".(-$vd)."em;'></div></div>";}}foreach((array)$qf[$E]as$wg=>$rf){foreach($rf
as$ud=>$d){$vd=$ud-$pg[$E][1];$t=0;foreach($d
as$vg)echo"\n<div class='references' title='".h($wg)."' id='refd$ud-".($t++)."' style='left: $vd"."em; top: ".$Q["fields"][$vg]["pos"]."em; height: 1.25em; background: url(".h(preg_replace("~\\?.*~","",ME)."?file=arrow.gif) no-repeat right center;&version=4.7.1")."'><div style='height: .5em; border-bottom: 1px solid Gray; width: ".(-$vd)."em;'></div></div>";}}echo"\n</div>\n";}foreach($Ef
as$E=>$Q){foreach((array)$Q["references"]as$wg=>$rf){foreach($rf
as$ud=>$nf){$Rd=$Jg;$Jd=-10;foreach($nf[0]as$z=>$Vf){$Ue=$Q["pos"][0]+$Q["fields"][$Vf]["pos"];$Ve=$Ef[$wg]["pos"][0]+$Ef[$wg]["fields"][$nf[1][$z]]["pos"];$Rd=min($Rd,$Ue,$Ve);$Jd=max($Jd,$Ue,$Ve);}echo"<div class='references' id='refl$ud' style='left: $ud"."em; top: $Rd"."em; padding: .5em 0;'><div style='border-right: 1px solid Gray; margin-top: 1px; height: ".($Jd-$Rd)."em;'></div></div>\n";}}}echo'</div>
<p class="links"><a href="',h(ME."schema=".urlencode($ea)),'" id="schema-link">',lang(133),'</a>
';}elseif(isset($_GET["dump"])){$a=$_GET["dump"];if($_POST&&!$l){$jb="";foreach(array("output","format","db_style","routines","events","table_style","auto_increment","triggers","data_style")as$z)$jb.="&$z=".urlencode($_POST[$z]);cookie("adminer_export",substr($jb,1));$S=array_flip((array)$_POST["tables"])+array_flip((array)$_POST["data"]);$kc=dump_headers((count($S)==1?key($S):DB),(DB==""||count($S)>1));$hd=preg_match('~sql~',$_POST["format"]);if($hd){echo"-- Adminer $ga ".$Ib[DRIVER]." dump\n\n";if($y=="sql"){echo"SET NAMES utf8;
SET time_zone = '+00:00';
".($_POST["data_style"]?"SET foreign_key_checks = 0;
SET sql_mode = 'NO_AUTO_VALUE_ON_ZERO';
":"")."
";$f->query("SET time_zone = '+00:00';");}}$hg=$_POST["db_style"];$i=array(DB);if(DB==""){$i=$_POST["databases"];if(is_string($i))$i=explode("\n",rtrim(str_replace("\r","",$i),"\n"));}foreach((array)$i
as$j){$b->dumpDatabase($j);if($f->select_db($j)){if($hd&&preg_match('~CREATE~',$hg)&&($h=$f->result("SHOW CREATE DATABASE ".idf_escape($j),1))){set_utf8mb4($h);if($hg=="DROP+CREATE")echo"DROP DATABASE IF EXISTS ".idf_escape($j).";\n";echo"$h;\n";}if($hd){if($hg)echo
use_sql($j).";\n\n";$Ce="";if($_POST["routines"]){foreach(array("FUNCTION","PROCEDURE")as$_f){foreach(get_rows("SHOW $_f STATUS WHERE Db = ".q($j),null,"-- ")as$L){$h=remove_definer($f->result("SHOW CREATE $_f ".idf_escape($L["Name"]),2));set_utf8mb4($h);$Ce.=($hg!='DROP+CREATE'?"DROP $_f IF EXISTS ".idf_escape($L["Name"]).";;\n":"")."$h;;\n\n";}}}if($_POST["events"]){foreach(get_rows("SHOW EVENTS",null,"-- ")as$L){$h=remove_definer($f->result("SHOW CREATE EVENT ".idf_escape($L["Name"]),3));set_utf8mb4($h);$Ce.=($hg!='DROP+CREATE'?"DROP EVENT IF EXISTS ".idf_escape($L["Name"]).";;\n":"")."$h;;\n\n";}}if($Ce)echo"DELIMITER ;;\n\n$Ce"."DELIMITER ;\n\n";}if($_POST["table_style"]||$_POST["data_style"]){$ph=array();foreach(table_status('',true)as$E=>$R){$Q=(DB==""||in_array($E,(array)$_POST["tables"]));$rb=(DB==""||in_array($E,(array)$_POST["data"]));if($Q||$rb){if($kc=="tar"){$Hg=new
TmpFile;ob_start(array($Hg,'write'),1e5);}$b->dumpTable($E,($Q?$_POST["table_style"]:""),(is_view($R)?2:0));if(is_view($R))$ph[]=$E;elseif($rb){$n=fields($E);$b->dumpData($E,$_POST["data_style"],"SELECT *".convert_fields($n,$n)." FROM ".table($E));}if($hd&&$_POST["triggers"]&&$Q&&($Rg=trigger_sql($E)))echo"\nDELIMITER ;;\n$Rg\nDELIMITER ;\n";if($kc=="tar"){ob_end_flush();tar_file((DB!=""?"":"$j/")."$E.csv",$Hg);}elseif($hd)echo"\n";}}foreach($ph
as$oh)$b->dumpTable($oh,$_POST["table_style"],1);if($kc=="tar")echo
pack("x512");}}}if($hd)echo"-- ".$f->result("SELECT NOW()")."\n";exit;}page_header(lang(69),$l,($_GET["export"]!=""?array("table"=>$_GET["export"]):array()),h(DB));echo'
<form action="" method="post">
<table cellspacing="0" class="layout">
';$vb=array('','USE','DROP+CREATE','CREATE');$rg=array('','DROP+CREATE','CREATE');$sb=array('','TRUNCATE+INSERT','INSERT');if($y=="sql")$sb[]='INSERT+UPDATE';parse_str($_COOKIE["adminer_export"],$L);if(!$L)$L=array("output"=>"text","format"=>"sql","db_style"=>(DB!=""?"":"CREATE"),"table_style"=>"DROP+CREATE","data_style"=>"INSERT");if(!isset($L["events"])){$L["routines"]=$L["events"]=($_GET["dump"]=="");$L["triggers"]=$L["table_style"];}echo"<tr><th>".lang(134)."<td>".html_select("output",$b->dumpOutput(),$L["output"],0)."\n";echo"<tr><th>".lang(135)."<td>".html_select("format",$b->dumpFormat(),$L["format"],0)."\n";echo($y=="sqlite"?"":"<tr><th>".lang(33)."<td>".html_select('db_style',$vb,$L["db_style"]).(support("routine")?checkbox("routines",1,$L["routines"],lang(136)):"").(support("event")?checkbox("events",1,$L["events"],lang(137)):"")),"<tr><th>".lang(117)."<td>".html_select('table_style',$rg,$L["table_style"]).checkbox("auto_increment",1,$L["auto_increment"],lang(47)).(support("trigger")?checkbox("triggers",1,$L["triggers"],lang(131)):""),"<tr><th>".lang(138)."<td>".html_select('data_style',$sb,$L["data_style"]),'</table>
<p><input type="submit" value="',lang(69),'">
<input type="hidden" name="token" value="',$T,'">

<table cellspacing="0">
',script("qsl('table').onclick = dumpClick;");$Ye=array();if(DB!=""){$Oa=($a!=""?"":" checked");echo"<thead><tr>","<th style='text-align: left;'><label class='block'><input type='checkbox' id='check-tables'$Oa>".lang(117)."</label>".script("qs('#check-tables').onclick = partial(formCheck, /^tables\\[/);",""),"<th style='text-align: right;'><label class='block'>".lang(138)."<input type='checkbox' id='check-data'$Oa></label>".script("qs('#check-data').onclick = partial(formCheck, /^data\\[/);",""),"</thead>\n";$ph="";$sg=tables_list();foreach($sg
as$E=>$U){$Xe=preg_replace('~_.*~','',$E);$Oa=($a==""||$a==(substr($a,-1)=="%"?"$Xe%":$E));$af="<tr><td>".checkbox("tables[]",$E,$Oa,$E,"","block");if($U!==null&&!preg_match('~table~i',$U))$ph.="$af\n";else
echo"$af<td align='right'><label class='block'><span id='Rows-".h($E)."'></span>".checkbox("data[]",$E,$Oa)."</label>\n";$Ye[$Xe]++;}echo$ph;if($sg)echo
script("ajaxSetHtml('".js_escape(ME)."script=db');");}else{echo"<thead><tr><th style='text-align: left;'>","<label class='block'><input type='checkbox' id='check-databases'".($a==""?" checked":"").">".lang(33)."</label>",script("qs('#check-databases').onclick = partial(formCheck, /^databases\\[/);",""),"</thead>\n";$i=$b->databases();if($i){foreach($i
as$j){if(!information_schema($j)){$Xe=preg_replace('~_.*~','',$j);echo"<tr><td>".checkbox("databases[]",$j,$a==""||$a=="$Xe%",$j,"","block")."\n";$Ye[$Xe]++;}}}else
echo"<tr><td><textarea name='databases' rows='10' cols='20'></textarea>";}echo'</table>
</form>
';$uc=true;foreach($Ye
as$z=>$X){if($z!=""&&$X>1){echo($uc?"<p>":" ")."<a href='".h(ME)."dump=".urlencode("$z%")."'>".h($z)."</a>";$uc=false;}}}elseif(isset($_GET["privileges"])){page_header(lang(67));echo'<p class="links"><a href="'.h(ME).'user=">'.lang(139)."</a>";$J=$f->query("SELECT User, Host FROM mysql.".(DB==""?"user":"db WHERE ".q(DB)." LIKE Db")." ORDER BY Host, User");$r=$J;if(!$J)$J=$f->query("SELECT SUBSTRING_INDEX(CURRENT_USER, '@', 1) AS User, SUBSTRING_INDEX(CURRENT_USER, '@', -1) AS Host");echo"<form action=''><p>\n";hidden_fields_get();echo"<input type='hidden' name='db' value='".h(DB)."'>\n",($r?"":"<input type='hidden' name='grant' value=''>\n"),"<table cellspacing='0'>\n","<thead><tr><th>".lang(31)."<th>".lang(30)."<th></thead>\n";while($L=$J->fetch_assoc())echo'<tr'.odd().'><td>'.h($L["User"])."<td>".h($L["Host"]).'<td><a href="'.h(ME.'user='.urlencode($L["User"]).'&host='.urlencode($L["Host"])).'">'.lang(10)."</a>\n";if(!$r||DB!="")echo"<tr".odd()."><td><input name='user' autocapitalize='off'><td><input name='host' value='localhost' autocapitalize='off'><td><input type='submit' value='".lang(10)."'>\n";echo"</table>\n","</form>\n";}elseif(isset($_GET["sql"])){if(!$l&&$_POST["export"]){dump_headers("sql");$b->dumpTable("","");$b->dumpData("","table",$_POST["query"]);exit;}restart_session();$Qc=&get_session("queries");$Pc=&$Qc[DB];if(!$l&&$_POST["clear"]){$Pc=array();redirect(remove_from_uri("history"));}page_header((isset($_GET["import"])?lang(68):lang(60)),$l);if(!$l&&$_POST){$p=false;if(!isset($_GET["import"]))$I=$_POST["query"];elseif($_POST["webfile"]){$Yf=$b->importServerPath();$p=@fopen((file_exists($Yf)?$Yf:"compress.zlib://$Yf.gz"),"rb");$I=($p?fread($p,1e6):false);}else$I=get_file("sql_file",true);if(is_string($I)){if(function_exists('memory_get_usage'))@ini_set("memory_limit",max(ini_bytes("memory_limit"),2*strlen($I)+memory_get_usage()+8e6));if($I!=""&&strlen($I)<1e6){$H=$I.(preg_match("~;[ \t\r\n]*\$~",$I)?"":";");if(!$Pc||reset(end($Pc))!=$H){restart_session();$Pc[]=array($H,time());set_session("queries",$Qc);stop_session();}}$Wf="(?:\\s|/\\*[\s\S]*?\\*/|(?:#|-- )[^\n]*\n?|--\r?\n)";$_b=";";$fe=0;$Wb=true;$g=connect();if(is_object($g)&&DB!="")$g->select_db(DB);$bb=0;$bc=array();$Ie='[\'"'.($y=="sql"?'`#':($y=="sqlite"?'`[':($y=="mssql"?'[':''))).']|/\*|-- |$'.($y=="pgsql"?'|\$[^$]*\$':'');$Kg=microtime(true);parse_str($_COOKIE["adminer_export"],$ma);$Nb=$b->dumpFormat();unset($Nb["sql"]);while($I!=""){if(!$fe&&preg_match("~^$Wf*+DELIMITER\\s+(\\S+)~i",$I,$C)){$_b=$C[1];$I=substr($I,strlen($C[0]));}else{preg_match('('.preg_quote($_b)."\\s*|$Ie)",$I,$C,PREG_OFFSET_CAPTURE,$fe);list($Ac,$Te)=$C[0];if(!$Ac&&$p&&!feof($p))$I.=fread($p,1e5);else{if(!$Ac&&rtrim($I)=="")break;$fe=$Te+strlen($Ac);if($Ac&&rtrim($Ac)!=$_b){while(preg_match('('.($Ac=='/*'?'\*/':($Ac=='['?']':(preg_match('~^-- |^#~',$Ac)?"\n":preg_quote($Ac)."|\\\\."))).'|$)s',$I,$C,PREG_OFFSET_CAPTURE,$fe)){$Cf=$C[0][0];if(!$Cf&&$p&&!feof($p))$I.=fread($p,1e5);else{$fe=$C[0][1]+strlen($Cf);if($Cf[0]!="\\")break;}}}else{$Wb=false;$H=substr($I,0,$Te);$bb++;$af="<pre id='sql-$bb'><code class='jush-$y'>".$b->sqlCommandQuery($H)."</code></pre>\n";if($y=="sqlite"&&preg_match("~^$Wf*+ATTACH\\b~i",$H,$C)){echo$af,"<p class='error'>".lang(140)."\n";$bc[]=" <a href='#sql-$bb'>$bb</a>";if($_POST["error_stops"])break;}else{if(!$_POST["only_errors"]){echo$af;ob_flush();flush();}$bg=microtime(true);if($f->multi_query($H)&&is_object($g)&&preg_match("~^$Wf*+USE\\b~i",$H))$g->query($H);do{$J=$f->store_result();if($f->error){echo($_POST["only_errors"]?$af:""),"<p class='error'>".lang(141).($f->errno?" ($f->errno)":"").": ".error()."\n";$bc[]=" <a href='#sql-$bb'>$bb</a>";if($_POST["error_stops"])break
2;}else{$Ag=" <span class='time'>(".format_time($bg).")</span>".(strlen($H)<1000?" <a href='".h(ME)."sql=".urlencode(trim($H))."'>".lang(10)."</a>":"");$oa=$f->affected_rows;$sh=($_POST["only_errors"]?"":$k->warnings());$th="warnings-$bb";if($sh)$Ag.=", <a href='#$th'>".lang(42)."</a>".script("qsl('a').onclick = partial(toggle, '$th');","");$ic=null;$jc="explain-$bb";if(is_object($J)){$_=$_POST["limit"];$xe=select($J,$g,array(),$_);if(!$_POST["only_errors"]){echo"<form action='' method='post'>\n";$ce=$J->num_rows;echo"<p>".($ce?($_&&$ce>$_?lang(142,$_):"").lang(143,$ce):""),$Ag;if($g&&preg_match("~^($Wf|\\()*+SELECT\\b~i",$H)&&($ic=explain($g,$H)))echo", <a href='#$jc'>Explain</a>".script("qsl('a').onclick = partial(toggle, '$jc');","");$u="export-$bb";echo", <a href='#$u'>".lang(69)."</a>".script("qsl('a').onclick = partial(toggle, '$u');","")."<span id='$u' class='hidden'>: ".html_select("output",$b->dumpOutput(),$ma["output"])." ".html_select("format",$Nb,$ma["format"])."<input type='hidden' name='query' value='".h($H)."'>"." <input type='submit' name='export' value='".lang(69)."'><input type='hidden' name='token' value='$T'></span>\n"."</form>\n";}}else{if(preg_match("~^$Wf*+(CREATE|DROP|ALTER)$Wf++(DATABASE|SCHEMA)\\b~i",$H)){restart_session();set_session("dbs",null);stop_session();}if(!$_POST["only_errors"])echo"<p class='message' title='".h($f->info)."'>".lang(144,$oa)."$Ag\n";}echo($sh?"<div id='$th' class='hidden'>\n$sh</div>\n":"");if($ic){echo"<div id='$jc' class='hidden'>\n";select($ic,$g,$xe);echo"</div>\n";}}$bg=microtime(true);}while($f->next_result());}$I=substr($I,$fe);$fe=0;}}}}if($Wb)echo"<p class='message'>".lang(145)."\n";elseif($_POST["only_errors"]){echo"<p class='message'>".lang(146,$bb-count($bc))," <span class='time'>(".format_time($Kg).")</span>\n";}elseif($bc&&$bb>1)echo"<p class='error'>".lang(141).": ".implode("",$bc)."\n";}else
echo"<p class='error'>".upload_error($I)."\n";}echo'
<form action="" method="post" enctype="multipart/form-data" id="form">
';$gc="<input type='submit' value='".lang(147)."' title='Ctrl+Enter'>";if(!isset($_GET["import"])){$H=$_GET["sql"];if($_POST)$H=$_POST["query"];elseif($_GET["history"]=="all")$H=$Pc;elseif($_GET["history"]!="")$H=$Pc[$_GET["history"]][0];echo"<p>";textarea("query",$H,20);echo
script(($_POST?"":"qs('textarea').focus();\n")."qs('#form').onsubmit = partial(sqlSubmit, qs('#form'), '".remove_from_uri("sql|limit|error_stops|only_errors")."');"),"<p>$gc\n",lang(148).": <input type='number' name='limit' class='size' value='".h($_POST?$_POST["limit"]:$_GET["limit"])."'>\n";}else{echo"<fieldset><legend>".lang(149)."</legend><div>";$Ic=(extension_loaded("zlib")?"[.gz]":"");echo(ini_bool("file_uploads")?"SQL$Ic (&lt; ".ini_get("upload_max_filesize")."B): <input type='file' name='sql_file[]' multiple>\n$gc":lang(150)),"</div></fieldset>\n";$Vc=$b->importServerPath();if($Vc){echo"<fieldset><legend>".lang(151)."</legend><div>",lang(152,"<code>".h($Vc)."$Ic</code>"),' <input type="submit" name="webfile" value="'.lang(153).'">',"</div></fieldset>\n";}echo"<p>";}echo
checkbox("error_stops",1,($_POST?$_POST["error_stops"]:isset($_GET["import"])),lang(154))."\n",checkbox("only_errors",1,($_POST?$_POST["only_errors"]:isset($_GET["import"])),lang(155))."\n","<input type='hidden' name='token' value='$T'>\n";if(!isset($_GET["import"])&&$Pc){print_fieldset("history",lang(156),$_GET["history"]!="");for($X=end($Pc);$X;$X=prev($Pc)){$z=key($Pc);list($H,$Ag,$Rb)=$X;echo'<a href="'.h(ME."sql=&history=$z").'">'.lang(10)."</a>"." <span class='time' title='".@date('Y-m-d',$Ag)."'>".@date("H:i:s",$Ag)."</span>"." <code class='jush-$y'>".shorten_utf8(ltrim(str_replace("\n"," ",str_replace("\r","",preg_replace('~^(#|-- ).*~m','',$H)))),80,"</code>").($Rb?" <span class='time'>($Rb)</span>":"")."<br>\n";}echo"<input type='submit' name='clear' value='".lang(157)."'>\n","<a href='".h(ME."sql=&history=all")."'>".lang(158)."</a>\n","</div></fieldset>\n";}echo'</form>
';}elseif(isset($_GET["edit"])){$a=$_GET["edit"];$n=fields($a);$Z=(isset($_GET["select"])?($_POST["check"]&&count($_POST["check"])==1?where_check($_POST["check"][0],$n):""):where($_GET,$n));$ch=(isset($_GET["select"])?$_POST["edit"]:$Z);foreach($n
as$E=>$m){if(!isset($m["privileges"][$ch?"update":"insert"])||$b->fieldName($m)=="")unset($n[$E]);}if($_POST&&!$l&&!isset($_GET["select"])){$B=$_POST["referer"];if($_POST["insert"])$B=($ch?null:$_SERVER["REQUEST_URI"]);elseif(!preg_match('~^.+&select=.+$~',$B))$B=ME."select=".urlencode($a);$x=indexes($a);$Xg=unique_array($_GET["where"],$x);$jf="\nWHERE $Z";if(isset($_POST["delete"]))queries_redirect($B,lang(159),$k->delete($a,$jf,!$Xg));else{$P=array();foreach($n
as$E=>$m){$X=process_input($m);if($X!==false&&$X!==null)$P[idf_escape($E)]=$X;}if($ch){if(!$P)redirect($B);queries_redirect($B,lang(160),$k->update($a,$P,$jf,!$Xg));if(is_ajax()){page_headers();page_messages($l);exit;}}else{$J=$k->insert($a,$P);$td=($J?last_id():0);queries_redirect($B,lang(161,($td?" $td":"")),$J);}}}$L=null;if($_POST["save"])$L=(array)$_POST["fields"];elseif($Z){$N=array();foreach($n
as$E=>$m){if(isset($m["privileges"]["select"])){$va=convert_field($m);if($_POST["clone"]&&$m["auto_increment"])$va="''";if($y=="sql"&&preg_match("~enum|set~",$m["type"]))$va="1*".idf_escape($E);$N[]=($va?"$va AS ":"").idf_escape($E);}}$L=array();if(!support("table"))$N=array("*");if($N){$J=$k->select($a,$N,array($Z),$N,array(),(isset($_GET["select"])?2:1));if(!$J)$l=error();else{$L=$J->fetch_assoc();if(!$L)$L=false;}if(isset($_GET["select"])&&(!$L||$J->fetch_assoc()))$L=null;}}if(!support("table")&&!$n){if(!$Z){$J=$k->select($a,array("*"),$Z,array("*"));$L=($J?$J->fetch_assoc():false);if(!$L)$L=array($k->primary=>"");}if($L){foreach($L
as$z=>$X){if(!$Z)$L[$z]=null;$n[$z]=array("field"=>$z,"null"=>($z!=$k->primary),"auto_increment"=>($z==$k->primary));}}}edit_form($a,$n,$L,$ch);}elseif(isset($_GET["create"])){$a=$_GET["create"];$Je=array();foreach(array('HASH','LINEAR HASH','KEY','LINEAR KEY','RANGE','LIST')as$z)$Je[$z]=$z;$pf=referencable_primary($a);$zc=array();foreach($pf
as$og=>$m)$zc[str_replace("`","``",$og)."`".str_replace("`","``",$m["field"])]=$og;$_e=array();$R=array();if($a!=""){$_e=fields($a);$R=table_status($a);if(!$R)$l=lang(9);}$L=$_POST;$L["fields"]=(array)$L["fields"];if($L["auto_increment_col"])$L["fields"][$L["auto_increment_col"]]["auto_increment"]=true;if($_POST)set_adminer_settings(array("comments"=>$_POST["comments"],"defaults"=>$_POST["defaults"]));if($_POST&&!process_fields($L["fields"])&&!$l){if($_POST["drop"])queries_redirect(substr(ME,0,-1),lang(162),drop_tables(array($a)));else{$n=array();$sa=array();$gh=false;$xc=array();$ze=reset($_e);$qa=" FIRST";foreach($L["fields"]as$z=>$m){$o=$zc[$m["type"]];$Sg=($o!==null?$pf[$o]:$m);if($m["field"]!=""){if(!$m["has_default"])$m["default"]=null;if($z==$L["auto_increment_col"])$m["auto_increment"]=true;$ff=process_field($m,$Sg);$sa[]=array($m["orig"],$ff,$qa);if($ff!=process_field($ze,$ze)){$n[]=array($m["orig"],$ff,$qa);if($m["orig"]!=""||$qa)$gh=true;}if($o!==null)$xc[idf_escape($m["field"])]=($a!=""&&$y!="sqlite"?"ADD":" ").format_foreign_key(array('table'=>$zc[$m["type"]],'source'=>array($m["field"]),'target'=>array($Sg["field"]),'on_delete'=>$m["on_delete"],));$qa=" AFTER ".idf_escape($m["field"]);}elseif($m["orig"]!=""){$gh=true;$n[]=array($m["orig"]);}if($m["orig"]!=""){$ze=next($_e);if(!$ze)$qa="";}}$Le="";if($Je[$L["partition_by"]]){$Me=array();if($L["partition_by"]=='RANGE'||$L["partition_by"]=='LIST'){foreach(array_filter($L["partition_names"])as$z=>$X){$Y=$L["partition_values"][$z];$Me[]="\n  PARTITION ".idf_escape($X)." VALUES ".($L["partition_by"]=='RANGE'?"LESS THAN":"IN").($Y!=""?" ($Y)":" MAXVALUE");}}$Le.="\nPARTITION BY $L[partition_by]($L[partition])".($Me?" (".implode(",",$Me)."\n)":($L["partitions"]?" PARTITIONS ".(+$L["partitions"]):""));}elseif(support("partitioning")&&preg_match("~partitioned~",$R["Create_options"]))$Le.="\nREMOVE PARTITIONING";$D=lang(163);if($a==""){cookie("adminer_engine",$L["Engine"]);$D=lang(164);}$E=trim($L["name"]);queries_redirect(ME.(support("table")?"table=":"select=").urlencode($E),$D,alter_table($a,$E,($y=="sqlite"&&($gh||$xc)?$sa:$n),$xc,($L["Comment"]!=$R["Comment"]?$L["Comment"]:null),($L["Engine"]&&$L["Engine"]!=$R["Engine"]?$L["Engine"]:""),($L["Collation"]&&$L["Collation"]!=$R["Collation"]?$L["Collation"]:""),($L["Auto_increment"]!=""?number($L["Auto_increment"]):""),$Le));}}page_header(($a!=""?lang(40):lang(70)),$l,array("table"=>$a),h($a));if(!$_POST){$L=array("Engine"=>$_COOKIE["adminer_engine"],"fields"=>array(array("field"=>"","type"=>(isset($Ug["int"])?"int":(isset($Ug["integer"])?"integer":"")),"on_update"=>"")),"partition_names"=>array(""),);if($a!=""){$L=$R;$L["name"]=$a;$L["fields"]=array();if(!$_GET["auto_increment"])$L["Auto_increment"]="";foreach($_e
as$m){$m["has_default"]=isset($m["default"]);$L["fields"][]=$m;}if(support("partitioning")){$Cc="FROM information_schema.PARTITIONS WHERE TABLE_SCHEMA = ".q(DB)." AND TABLE_NAME = ".q($a);$J=$f->query("SELECT PARTITION_METHOD, PARTITION_ORDINAL_POSITION, PARTITION_EXPRESSION $Cc ORDER BY PARTITION_ORDINAL_POSITION DESC LIMIT 1");list($L["partition_by"],$L["partitions"],$L["partition"])=$J->fetch_row();$Me=get_key_vals("SELECT PARTITION_NAME, PARTITION_DESCRIPTION $Cc AND PARTITION_NAME != '' ORDER BY PARTITION_ORDINAL_POSITION");$Me[""]="";$L["partition_names"]=array_keys($Me);$L["partition_values"]=array_values($Me);}}}$Ya=collations();$Yb=engines();foreach($Yb
as$Xb){if(!strcasecmp($Xb,$L["Engine"])){$L["Engine"]=$Xb;break;}}echo'
<form action="" method="post" id="form">
<p>
';if(support("columns")||$a==""){echo
lang(165),': <input name="name" data-maxlength="64" value="',h($L["name"]),'" autocapitalize="off">
';if($a==""&&!$_POST)echo
script("focus(qs('#form')['name']);");echo($Yb?"<select name='Engine'>".optionlist(array(""=>"(".lang(166).")")+$Yb,$L["Engine"])."</select>".on_help("getTarget(event).value",1).script("qsl('select').onchange = helpClose;"):""),' ',($Ya&&!preg_match("~sqlite|mssql~",$y)?html_select("Collation",array(""=>"(".lang(95).")")+$Ya,$L["Collation"]):""),' <input type="submit" value="',lang(14),'">
';}echo'
';if(support("columns")){echo'<div class="scrollable">
<table cellspacing="0" id="edit-fields" class="nowrap">
';edit_fields($L["fields"],$Ya,"TABLE",$zc);echo'</table>
</div>
<p>
',lang(47),': <input type="number" name="Auto_increment" size="6" value="',h($L["Auto_increment"]),'">
',checkbox("defaults",1,($_POST?$_POST["defaults"]:adminer_setting("defaults")),lang(167),"columnShow(this.checked, 5)","jsonly"),(support("comment")?checkbox("comments",1,($_POST?$_POST["comments"]:adminer_setting("comments")),lang(46),"editingCommentsClick(this, true);","jsonly").' <input name="Comment" value="'.h($L["Comment"]).'" data-maxlength="'.(min_version(5.5)?2048:60).'">':''),'<p>
<input type="submit" value="',lang(14),'">
';}echo'
';if($a!=""){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,$a));}if(support("partitioning")){$Ke=preg_match('~RANGE|LIST~',$L["partition_by"]);print_fieldset("partition",lang(169),$L["partition_by"]);echo'<p>
',"<select name='partition_by'>".optionlist(array(""=>"")+$Je,$L["partition_by"])."</select>".on_help("getTarget(event).value.replace(/./, 'PARTITION BY \$&')",1).script("qsl('select').onchange = partitionByChange;"),'(<input name="partition" value="',h($L["partition"]),'">)
',lang(170),': <input type="number" name="partitions" class="size',($Ke||!$L["partition_by"]?" hidden":""),'" value="',h($L["partitions"]),'">
<table cellspacing="0" id="partition-table"',($Ke?"":" class='hidden'"),'>
<thead><tr><th>',lang(171),'<th>',lang(172),'</thead>
';foreach($L["partition_names"]as$z=>$X){echo'<tr>','<td><input name="partition_names[]" value="'.h($X).'" autocapitalize="off">',($z==count($L["partition_names"])-1?script("qsl('input').oninput = partitionNameChange;"):''),'<td><input name="partition_values[]" value="'.h($L["partition_values"][$z]).'">';}echo'</table>
</div></fieldset>
';}echo'<input type="hidden" name="token" value="',$T,'">
</form>
',script("qs('#form')['defaults'].onclick();".(support("comment")?" editingCommentsClick(qs('#form')['comments']);":""));}elseif(isset($_GET["indexes"])){$a=$_GET["indexes"];$Xc=array("PRIMARY","UNIQUE","INDEX");$R=table_status($a,true);if(preg_match('~MyISAM|M?aria'.(min_version(5.6,'10.0.5')?'|InnoDB':'').'~i',$R["Engine"]))$Xc[]="FULLTEXT";if(preg_match('~MyISAM|M?aria'.(min_version(5.7,'10.2.2')?'|InnoDB':'').'~i',$R["Engine"]))$Xc[]="SPATIAL";$x=indexes($a);$Ze=array();if($y=="mongo"){$Ze=$x["_id_"];unset($Xc[0]);unset($x["_id_"]);}$L=$_POST;if($_POST&&!$l&&!$_POST["add"]&&!$_POST["drop_col"]){$ta=array();foreach($L["indexes"]as$w){$E=$w["name"];if(in_array($w["type"],$Xc)){$d=array();$zd=array();$Bb=array();$P=array();ksort($w["columns"]);foreach($w["columns"]as$z=>$c){if($c!=""){$yd=$w["lengths"][$z];$Ab=$w["descs"][$z];$P[]=idf_escape($c).($yd?"(".(+$yd).")":"").($Ab?" DESC":"");$d[]=$c;$zd[]=($yd?$yd:null);$Bb[]=$Ab;}}if($d){$hc=$x[$E];if($hc){ksort($hc["columns"]);ksort($hc["lengths"]);ksort($hc["descs"]);if($w["type"]==$hc["type"]&&array_values($hc["columns"])===$d&&(!$hc["lengths"]||array_values($hc["lengths"])===$zd)&&array_values($hc["descs"])===$Bb){unset($x[$E]);continue;}}$ta[]=array($w["type"],$E,$P);}}}foreach($x
as$E=>$hc)$ta[]=array($hc["type"],$E,"DROP");if(!$ta)redirect(ME."table=".urlencode($a));queries_redirect(ME."table=".urlencode($a),lang(173),alter_indexes($a,$ta));}page_header(lang(125),$l,array("table"=>$a),h($a));$n=array_keys(fields($a));if($_POST["add"]){foreach($L["indexes"]as$z=>$w){if($w["columns"][count($w["columns"])]!="")$L["indexes"][$z]["columns"][]="";}$w=end($L["indexes"]);if($w["type"]||array_filter($w["columns"],'strlen'))$L["indexes"][]=array("columns"=>array(1=>""));}if(!$L){foreach($x
as$z=>$w){$x[$z]["name"]=$z;$x[$z]["columns"][]="";}$x[]=array("columns"=>array(1=>""));$L["indexes"]=$x;}echo'
<form action="" method="post">
<div class="scrollable">
<table cellspacing="0" class="nowrap">
<thead><tr>
<th id="label-type">',lang(174),'<th><input type="submit" class="wayoff">',lang(175),'<th id="label-name">',lang(176),'<th><noscript>',"<input type='image' class='icon' name='add[0]' src='".h(preg_replace("~\\?.*~","",ME)."?file=plus.gif&version=4.7.1")."' alt='+' title='".lang(102)."'>",'</noscript>
</thead>
';if($Ze){echo"<tr><td>PRIMARY<td>";foreach($Ze["columns"]as$z=>$c){echo
select_input(" disabled",$n,$c),"<label><input disabled type='checkbox'>".lang(55)."</label> ";}echo"<td><td>\n";}$jd=1;foreach($L["indexes"]as$w){if(!$_POST["drop_col"]||$jd!=key($_POST["drop_col"])){echo"<tr><td>".html_select("indexes[$jd][type]",array(-1=>"")+$Xc,$w["type"],($jd==count($L["indexes"])?"indexesAddRow.call(this);":1),"label-type"),"<td>";ksort($w["columns"]);$t=1;foreach($w["columns"]as$z=>$c){echo"<span>".select_input(" name='indexes[$jd][columns][$t]' title='".lang(44)."'",($n?array_combine($n,$n):$n),$c,"partial(".($t==count($w["columns"])?"indexesAddColumn":"indexesChangeColumn").", '".js_escape($y=="sql"?"":$_GET["indexes"]."_")."')"),($y=="sql"||$y=="mssql"?"<input type='number' name='indexes[$jd][lengths][$t]' class='size' value='".h($w["lengths"][$z])."' title='".lang(100)."'>":""),(support("descidx")?checkbox("indexes[$jd][descs][$t]",1,$w["descs"][$z],lang(55)):"")," </span>";$t++;}echo"<td><input name='indexes[$jd][name]' value='".h($w["name"])."' autocapitalize='off' aria-labelledby='label-name'>\n","<td><input type='image' class='icon' name='drop_col[$jd]' src='".h(preg_replace("~\\?.*~","",ME)."?file=cross.gif&version=4.7.1")."' alt='x' title='".lang(105)."'>".script("qsl('input').onclick = partial(editingRemoveRow, 'indexes\$1[type]');");}$jd++;}echo'</table>
</div>
<p>
<input type="submit" value="',lang(14),'">
<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["database"])){$L=$_POST;if($_POST&&!$l&&!isset($_POST["add_x"])){$E=trim($L["name"]);if($_POST["drop"]){$_GET["db"]="";queries_redirect(remove_from_uri("db|database"),lang(177),drop_databases(array(DB)));}elseif(DB!==$E){if(DB!=""){$_GET["db"]=$E;queries_redirect(preg_replace('~\bdb=[^&]*&~','',ME)."db=".urlencode($E),lang(178),rename_database($E,$L["collation"]));}else{$i=explode("\n",str_replace("\r","",$E));$ig=true;$sd="";foreach($i
as$j){if(count($i)==1||$j!=""){if(!create_database($j,$L["collation"]))$ig=false;$sd=$j;}}restart_session();set_session("dbs",null);queries_redirect(ME."db=".urlencode($sd),lang(179),$ig);}}else{if(!$L["collation"])redirect(substr(ME,0,-1));query_redirect("ALTER DATABASE ".idf_escape($E).(preg_match('~^[a-z0-9_]+$~i',$L["collation"])?" COLLATE $L[collation]":""),substr(ME,0,-1),lang(180));}}page_header(DB!=""?lang(63):lang(109),$l,array(),h(DB));$Ya=collations();$E=DB;if($_POST)$E=$L["name"];elseif(DB!="")$L["collation"]=db_collation(DB,$Ya);elseif($y=="sql"){foreach(get_vals("SHOW GRANTS")as$r){if(preg_match('~ ON (`(([^\\\\`]|``|\\\\.)*)%`\.\*)?~',$r,$C)&&$C[1]){$E=stripcslashes(idf_unescape("`$C[2]`"));break;}}}echo'
<form action="" method="post">
<p>
',($_POST["add_x"]||strpos($E,"\n")?'<textarea id="name" name="name" rows="10" cols="40">'.h($E).'</textarea><br>':'<input name="name" id="name" value="'.h($E).'" data-maxlength="64" autocapitalize="off">')."\n".($Ya?html_select("collation",array(""=>"(".lang(95).")")+$Ya,$L["collation"]).doc_link(array('sql'=>"charset-charsets.html",'mariadb'=>"supported-character-sets-and-collations/",'mssql'=>"ms187963.aspx",)):""),script("focus(qs('#name'));"),'<input type="submit" value="',lang(14),'">
';if(DB!="")echo"<input type='submit' name='drop' value='".lang(121)."'>".confirm(lang(168,DB))."\n";elseif(!$_POST["add_x"]&&$_GET["db"]=="")echo"<input type='image' class='icon' name='add' src='".h(preg_replace("~\\?.*~","",ME)."?file=plus.gif&version=4.7.1")."' alt='+' title='".lang(102)."'>\n";echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["call"])){$da=($_GET["name"]?$_GET["name"]:$_GET["call"]);page_header(lang(181).": ".h($da),$l);$_f=routine($_GET["call"],(isset($_GET["callf"])?"FUNCTION":"PROCEDURE"));$Wc=array();$Ce=array();foreach($_f["fields"]as$t=>$m){if(substr($m["inout"],-3)=="OUT")$Ce[$t]="@".idf_escape($m["field"])." AS ".idf_escape($m["field"]);if(!$m["inout"]||substr($m["inout"],0,2)=="IN")$Wc[]=$t;}if(!$l&&$_POST){$Ka=array();foreach($_f["fields"]as$z=>$m){if(in_array($z,$Wc)){$X=process_input($m);if($X===false)$X="''";if(isset($Ce[$z]))$f->query("SET @".idf_escape($m["field"])." = $X");}$Ka[]=(isset($Ce[$z])?"@".idf_escape($m["field"]):$X);}$I=(isset($_GET["callf"])?"SELECT":"CALL")." ".table($da)."(".implode(", ",$Ka).")";$bg=microtime(true);$J=$f->multi_query($I);$oa=$f->affected_rows;echo$b->selectQuery($I,$bg,!$J);if(!$J)echo"<p class='error'>".error()."\n";else{$g=connect();if(is_object($g))$g->select_db(DB);do{$J=$f->store_result();if(is_object($J))select($J,$g);else
echo"<p class='message'>".lang(182,$oa)."\n";}while($f->next_result());if($Ce)select($f->query("SELECT ".implode(", ",$Ce)));}}echo'
<form action="" method="post">
';if($Wc){echo"<table cellspacing='0' class='layout'>\n";foreach($Wc
as$z){$m=$_f["fields"][$z];$E=$m["field"];echo"<tr><th>".$b->fieldName($m);$Y=$_POST["fields"][$E];if($Y!=""){if($m["type"]=="enum")$Y=+$Y;if($m["type"]=="set")$Y=array_sum($Y);}input($m,$Y,(string)$_POST["function"][$E]);echo"\n";}echo"</table>\n";}echo'<p>
<input type="submit" value="',lang(181),'">
<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["foreign"])){$a=$_GET["foreign"];$E=$_GET["name"];$L=$_POST;if($_POST&&!$l&&!$_POST["add"]&&!$_POST["change"]&&!$_POST["change-js"]){$D=($_POST["drop"]?lang(183):($E!=""?lang(184):lang(185)));$B=ME."table=".urlencode($a);if(!$_POST["drop"]){$L["source"]=array_filter($L["source"],'strlen');ksort($L["source"]);$vg=array();foreach($L["source"]as$z=>$X)$vg[$z]=$L["target"][$z];$L["target"]=$vg;}if($y=="sqlite")queries_redirect($B,$D,recreate_table($a,$a,array(),array(),array(" $E"=>($_POST["drop"]?"":" ".format_foreign_key($L)))));else{$ta="ALTER TABLE ".table($a);$Jb="\nDROP ".($y=="sql"?"FOREIGN KEY ":"CONSTRAINT ").idf_escape($E);if($_POST["drop"])query_redirect($ta.$Jb,$B,$D);else{query_redirect($ta.($E!=""?"$Jb,":"")."\nADD".format_foreign_key($L),$B,$D);$l=lang(186)."<br>$l";}}}page_header(lang(187),$l,array("table"=>$a),h($a));if($_POST){ksort($L["source"]);if($_POST["add"])$L["source"][]="";elseif($_POST["change"]||$_POST["change-js"])$L["target"]=array();}elseif($E!=""){$zc=foreign_keys($a);$L=$zc[$E];$L["source"][]="";}else{$L["table"]=$a;$L["source"]=array("");}$Vf=array_keys(fields($a));$vg=($a===$L["table"]?$Vf:array_keys(fields($L["table"])));$of=array_keys(array_filter(table_status('',true),'fk_support'));echo'
<form action="" method="post">
<p>
';if($L["db"]==""&&$L["ns"]==""){echo
lang(188),':
',html_select("table",$of,$L["table"],"this.form['change-js'].value = '1'; this.form.submit();"),'<input type="hidden" name="change-js" value="">
<noscript><p><input type="submit" name="change" value="',lang(189),'"></noscript>
<table cellspacing="0">
<thead><tr><th id="label-source">',lang(127),'<th id="label-target">',lang(128),'</thead>
';$jd=0;foreach($L["source"]as$z=>$X){echo"<tr>","<td>".html_select("source[".(+$z)."]",array(-1=>"")+$Vf,$X,($jd==count($L["source"])-1?"foreignAddRow.call(this);":1),"label-source"),"<td>".html_select("target[".(+$z)."]",$vg,$L["target"][$z],1,"label-target");$jd++;}echo'</table>
<p>
',lang(97),': ',html_select("on_delete",array(-1=>"")+explode("|",$me),$L["on_delete"]),' ',lang(96),': ',html_select("on_update",array(-1=>"")+explode("|",$me),$L["on_update"]),doc_link(array('sql'=>"innodb-foreign-key-constraints.html",'mariadb'=>"foreign-keys/",'pgsql'=>"sql-createtable.html#SQL-CREATETABLE-REFERENCES",'mssql'=>"ms174979.aspx",'oracle'=>"clauses002.htm#sthref2903",)),'<p>
<input type="submit" value="',lang(14),'">
<noscript><p><input type="submit" name="add" value="',lang(190),'"></noscript>
';}if($E!=""){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,$E));}echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["view"])){$a=$_GET["view"];$L=$_POST;$Ae="VIEW";if($y=="pgsql"&&$a!=""){$cg=table_status($a);$Ae=strtoupper($cg["Engine"]);}if($_POST&&!$l){$E=trim($L["name"]);$va=" AS\n$L[select]";$B=ME."table=".urlencode($E);$D=lang(191);$U=($_POST["materialized"]?"MATERIALIZED VIEW":"VIEW");if(!$_POST["drop"]&&$a==$E&&$y!="sqlite"&&$U=="VIEW"&&$Ae=="VIEW")query_redirect(($y=="mssql"?"ALTER":"CREATE OR REPLACE")." VIEW ".table($E).$va,$B,$D);else{$xg=$E."_adminer_".uniqid();drop_create("DROP $Ae ".table($a),"CREATE $U ".table($E).$va,"DROP $U ".table($E),"CREATE $U ".table($xg).$va,"DROP $U ".table($xg),($_POST["drop"]?substr(ME,0,-1):$B),lang(192),$D,lang(193),$a,$E);}}if(!$_POST&&$a!=""){$L=view($a);$L["name"]=$a;$L["materialized"]=($Ae!="VIEW");if(!$l)$l=error();}page_header(($a!=""?lang(39):lang(194)),$l,array("table"=>$a),h($a));echo'
<form action="" method="post">
<p>',lang(176),': <input name="name" value="',h($L["name"]),'" data-maxlength="64" autocapitalize="off">
',(support("materializedview")?" ".checkbox("materialized",1,$L["materialized"],lang(122)):""),'<p>';textarea("select",$L["select"]);echo'<p>
<input type="submit" value="',lang(14),'">
';if($a!=""){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,$a));}echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["event"])){$aa=$_GET["event"];$cd=array("YEAR","QUARTER","MONTH","DAY","HOUR","MINUTE","WEEK","SECOND","YEAR_MONTH","DAY_HOUR","DAY_MINUTE","DAY_SECOND","HOUR_MINUTE","HOUR_SECOND","MINUTE_SECOND");$dg=array("ENABLED"=>"ENABLE","DISABLED"=>"DISABLE","SLAVESIDE_DISABLED"=>"DISABLE ON SLAVE");$L=$_POST;if($_POST&&!$l){if($_POST["drop"])query_redirect("DROP EVENT ".idf_escape($aa),substr(ME,0,-1),lang(195));elseif(in_array($L["INTERVAL_FIELD"],$cd)&&isset($dg[$L["STATUS"]])){$Df="\nON SCHEDULE ".($L["INTERVAL_VALUE"]?"EVERY ".q($L["INTERVAL_VALUE"])." $L[INTERVAL_FIELD]".($L["STARTS"]?" STARTS ".q($L["STARTS"]):"").($L["ENDS"]?" ENDS ".q($L["ENDS"]):""):"AT ".q($L["STARTS"]))." ON COMPLETION".($L["ON_COMPLETION"]?"":" NOT")." PRESERVE";queries_redirect(substr(ME,0,-1),($aa!=""?lang(196):lang(197)),queries(($aa!=""?"ALTER EVENT ".idf_escape($aa).$Df.($aa!=$L["EVENT_NAME"]?"\nRENAME TO ".idf_escape($L["EVENT_NAME"]):""):"CREATE EVENT ".idf_escape($L["EVENT_NAME"]).$Df)."\n".$dg[$L["STATUS"]]." COMMENT ".q($L["EVENT_COMMENT"]).rtrim(" DO\n$L[EVENT_DEFINITION]",";").";"));}}page_header(($aa!=""?lang(198).": ".h($aa):lang(199)),$l);if(!$L&&$aa!=""){$M=get_rows("SELECT * FROM information_schema.EVENTS WHERE EVENT_SCHEMA = ".q(DB)." AND EVENT_NAME = ".q($aa));$L=reset($M);}echo'
<form action="" method="post">
<table cellspacing="0" class="layout">
<tr><th>',lang(176),'<td><input name="EVENT_NAME" value="',h($L["EVENT_NAME"]),'" data-maxlength="64" autocapitalize="off">
<tr><th title="datetime">',lang(200),'<td><input name="STARTS" value="',h("$L[EXECUTE_AT]$L[STARTS]"),'">
<tr><th title="datetime">',lang(201),'<td><input name="ENDS" value="',h($L["ENDS"]),'">
<tr><th>',lang(202),'<td><input type="number" name="INTERVAL_VALUE" value="',h($L["INTERVAL_VALUE"]),'" class="size"> ',html_select("INTERVAL_FIELD",$cd,$L["INTERVAL_FIELD"]),'<tr><th>',lang(112),'<td>',html_select("STATUS",$dg,$L["STATUS"]),'<tr><th>',lang(46),'<td><input name="EVENT_COMMENT" value="',h($L["EVENT_COMMENT"]),'" data-maxlength="64">
<tr><th><td>',checkbox("ON_COMPLETION","PRESERVE",$L["ON_COMPLETION"]=="PRESERVE",lang(203)),'</table>
<p>';textarea("EVENT_DEFINITION",$L["EVENT_DEFINITION"]);echo'<p>
<input type="submit" value="',lang(14),'">
';if($aa!=""){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,$aa));}echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["procedure"])){$da=($_GET["name"]?$_GET["name"]:$_GET["procedure"]);$_f=(isset($_GET["function"])?"FUNCTION":"PROCEDURE");$L=$_POST;$L["fields"]=(array)$L["fields"];if($_POST&&!process_fields($L["fields"])&&!$l){$ye=routine($_GET["procedure"],$_f);$xg="$L[name]_adminer_".uniqid();drop_create("DROP $_f ".routine_id($da,$ye),create_routine($_f,$L),"DROP $_f ".routine_id($L["name"],$L),create_routine($_f,array("name"=>$xg)+$L),"DROP $_f ".routine_id($xg,$L),substr(ME,0,-1),lang(204),lang(205),lang(206),$da,$L["name"]);}page_header(($da!=""?(isset($_GET["function"])?lang(207):lang(208)).": ".h($da):(isset($_GET["function"])?lang(209):lang(210))),$l);if(!$_POST&&$da!=""){$L=routine($_GET["procedure"],$_f);$L["name"]=$da;}$Ya=get_vals("SHOW CHARACTER SET");sort($Ya);$Af=routine_languages();echo'
<form action="" method="post" id="form">
<p>',lang(176),': <input name="name" value="',h($L["name"]),'" data-maxlength="64" autocapitalize="off">
',($Af?lang(19).": ".html_select("language",$Af,$L["language"])."\n":""),'<input type="submit" value="',lang(14),'">
<div class="scrollable">
<table cellspacing="0" class="nowrap">
';edit_fields($L["fields"],$Ya,$_f);if(isset($_GET["function"])){echo"<tr><td>".lang(211);edit_type("returns",$L["returns"],$Ya,array(),($y=="pgsql"?array("void","trigger"):array()));}echo'</table>
</div>
<p>';textarea("definition",$L["definition"]);echo'<p>
<input type="submit" value="',lang(14),'">
';if($da!=""){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,$da));}echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["trigger"])){$a=$_GET["trigger"];$E=$_GET["name"];$Qg=trigger_options();$L=(array)trigger($E)+array("Trigger"=>$a."_bi");if($_POST){if(!$l&&in_array($_POST["Timing"],$Qg["Timing"])&&in_array($_POST["Event"],$Qg["Event"])&&in_array($_POST["Type"],$Qg["Type"])){$le=" ON ".table($a);$Jb="DROP TRIGGER ".idf_escape($E).($y=="pgsql"?$le:"");$B=ME."table=".urlencode($a);if($_POST["drop"])query_redirect($Jb,$B,lang(212));else{if($E!="")queries($Jb);queries_redirect($B,($E!=""?lang(213):lang(214)),queries(create_trigger($le,$_POST)));if($E!="")queries(create_trigger($le,$L+array("Type"=>reset($Qg["Type"]))));}}$L=$_POST;}page_header(($E!=""?lang(215).": ".h($E):lang(216)),$l,array("table"=>$a));echo'
<form action="" method="post" id="form">
<table cellspacing="0" class="layout">
<tr><th>',lang(217),'<td>',html_select("Timing",$Qg["Timing"],$L["Timing"],"triggerChange(/^".preg_quote($a,"/")."_[ba][iud]$/, '".js_escape($a)."', this.form);"),'<tr><th>',lang(218),'<td>',html_select("Event",$Qg["Event"],$L["Event"],"this.form['Timing'].onchange();"),(in_array("UPDATE OF",$Qg["Event"])?" <input name='Of' value='".h($L["Of"])."' class='hidden'>":""),'<tr><th>',lang(45),'<td>',html_select("Type",$Qg["Type"],$L["Type"]),'</table>
<p>',lang(176),': <input name="Trigger" value="',h($L["Trigger"]),'" data-maxlength="64" autocapitalize="off">
',script("qs('#form')['Timing'].onchange();"),'<p>';textarea("Statement",$L["Statement"]);echo'<p>
<input type="submit" value="',lang(14),'">
';if($E!=""){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,$E));}echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["user"])){$fa=$_GET["user"];$df=array(""=>array("All privileges"=>""));foreach(get_rows("SHOW PRIVILEGES")as$L){foreach(explode(",",($L["Privilege"]=="Grant option"?"":$L["Context"]))as$hb)$df[$hb][$L["Privilege"]]=$L["Comment"];}$df["Server Admin"]+=$df["File access on server"];$df["Databases"]["Create routine"]=$df["Procedures"]["Create routine"];unset($df["Procedures"]["Create routine"]);$df["Columns"]=array();foreach(array("Select","Insert","Update","References")as$X)$df["Columns"][$X]=$df["Tables"][$X];unset($df["Server Admin"]["Usage"]);foreach($df["Tables"]as$z=>$X)unset($df["Databases"][$z]);$Xd=array();if($_POST){foreach($_POST["objects"]as$z=>$X)$Xd[$X]=(array)$Xd[$X]+(array)$_POST["grants"][$z];}$Ec=array();$je="";if(isset($_GET["host"])&&($J=$f->query("SHOW GRANTS FOR ".q($fa)."@".q($_GET["host"])))){while($L=$J->fetch_row()){if(preg_match('~GRANT (.*) ON (.*) TO ~',$L[0],$C)&&preg_match_all('~ *([^(,]*[^ ,(])( *\([^)]+\))?~',$C[1],$Fd,PREG_SET_ORDER)){foreach($Fd
as$X){if($X[1]!="USAGE")$Ec["$C[2]$X[2]"][$X[1]]=true;if(preg_match('~ WITH GRANT OPTION~',$L[0]))$Ec["$C[2]$X[2]"]["GRANT OPTION"]=true;}}if(preg_match("~ IDENTIFIED BY PASSWORD '([^']+)~",$L[0],$C))$je=$C[1];}}if($_POST&&!$l){$ke=(isset($_GET["host"])?q($fa)."@".q($_GET["host"]):"''");if($_POST["drop"])query_redirect("DROP USER $ke",ME."privileges=",lang(219));else{$Zd=q($_POST["user"])."@".q($_POST["host"]);$Ne=$_POST["pass"];if($Ne!=''&&!$_POST["hashed"]){$Ne=$f->result("SELECT PASSWORD(".q($Ne).")");$l=!$Ne;}$lb=false;if(!$l){if($ke!=$Zd){$lb=queries((min_version(5)?"CREATE USER":"GRANT USAGE ON *.* TO")." $Zd IDENTIFIED BY PASSWORD ".q($Ne));$l=!$lb;}elseif($Ne!=$je)queries("SET PASSWORD FOR $Zd = ".q($Ne));}if(!$l){$xf=array();foreach($Xd
as$ee=>$r){if(isset($_GET["grant"]))$r=array_filter($r);$r=array_keys($r);if(isset($_GET["grant"]))$xf=array_diff(array_keys(array_filter($Xd[$ee],'strlen')),$r);elseif($ke==$Zd){$he=array_keys((array)$Ec[$ee]);$xf=array_diff($he,$r);$r=array_diff($r,$he);unset($Ec[$ee]);}if(preg_match('~^(.+)\s*(\(.*\))?$~U',$ee,$C)&&(!grant("REVOKE",$xf,$C[2]," ON $C[1] FROM $Zd")||!grant("GRANT",$r,$C[2]," ON $C[1] TO $Zd"))){$l=true;break;}}}if(!$l&&isset($_GET["host"])){if($ke!=$Zd)queries("DROP USER $ke");elseif(!isset($_GET["grant"])){foreach($Ec
as$ee=>$xf){if(preg_match('~^(.+)(\(.*\))?$~U',$ee,$C))grant("REVOKE",array_keys($xf),$C[2]," ON $C[1] FROM $Zd");}}}queries_redirect(ME."privileges=",(isset($_GET["host"])?lang(220):lang(221)),!$l);if($lb)$f->query("DROP USER $Zd");}}page_header((isset($_GET["host"])?lang(31).": ".h("$fa@$_GET[host]"):lang(139)),$l,array("privileges"=>array('',lang(67))));if($_POST){$L=$_POST;$Ec=$Xd;}else{$L=$_GET+array("host"=>$f->result("SELECT SUBSTRING_INDEX(CURRENT_USER, '@', -1)"));$L["pass"]=$je;if($je!="")$L["hashed"]=true;$Ec[(DB==""||$Ec?"":idf_escape(addcslashes(DB,"%_\\"))).".*"]=array();}echo'<form action="" method="post">
<table cellspacing="0" class="layout">
<tr><th>',lang(30),'<td><input name="host" data-maxlength="60" value="',h($L["host"]),'" autocapitalize="off">
<tr><th>',lang(31),'<td><input name="user" data-maxlength="80" value="',h($L["user"]),'" autocapitalize="off">
<tr><th>',lang(32),'<td><input name="pass" id="pass" value="',h($L["pass"]),'" autocomplete="new-password">
';if(!$L["hashed"])echo
script("typePassword(qs('#pass'));");echo
checkbox("hashed",1,$L["hashed"],lang(222),"typePassword(this.form['pass'], this.checked);"),'</table>

';echo"<table cellspacing='0'>\n","<thead><tr><th colspan='2'>".lang(67).doc_link(array('sql'=>"grant.html#priv_level"));$t=0;foreach($Ec
as$ee=>$r){echo'<th>'.($ee!="*.*"?"<input name='objects[$t]' value='".h($ee)."' size='10' autocapitalize='off'>":"<input type='hidden' name='objects[$t]' value='*.*' size='10'>*.*");$t++;}echo"</thead>\n";foreach(array(""=>"","Server Admin"=>lang(30),"Databases"=>lang(33),"Tables"=>lang(124),"Columns"=>lang(44),"Procedures"=>lang(223),)as$hb=>$Ab){foreach((array)$df[$hb]as$cf=>$cb){echo"<tr".odd()."><td".($Ab?">$Ab<td":" colspan='2'").' lang="en" title="'.h($cb).'">'.h($cf);$t=0;foreach($Ec
as$ee=>$r){$E="'grants[$t][".h(strtoupper($cf))."]'";$Y=$r[strtoupper($cf)];if($hb=="Server Admin"&&$ee!=(isset($Ec["*.*"])?"*.*":".*"))echo"<td>";elseif(isset($_GET["grant"]))echo"<td><select name=$E><option><option value='1'".($Y?" selected":"").">".lang(224)."<option value='0'".($Y=="0"?" selected":"").">".lang(225)."</select>";else{echo"<td align='center'><label class='block'>","<input type='checkbox' name=$E value='1'".($Y?" checked":"").($cf=="All privileges"?" id='grants-$t-all'>":">".($cf=="Grant option"?"":script("qsl('input').onclick = function () { if (this.checked) formUncheck('grants-$t-all'); };"))),"</label>";}$t++;}}}echo"</table>\n",'<p>
<input type="submit" value="',lang(14),'">
';if(isset($_GET["host"])){echo'<input type="submit" name="drop" value="',lang(121),'">',confirm(lang(168,"$fa@$_GET[host]"));}echo'<input type="hidden" name="token" value="',$T,'">
</form>
';}elseif(isset($_GET["processlist"])){if(support("kill")&&$_POST&&!$l){$nd=0;foreach((array)$_POST["kill"]as$X){if(kill_process($X))$nd++;}queries_redirect(ME."processlist=",lang(226,$nd),$nd||!$_POST["kill"]);}page_header(lang(110),$l);echo'
<form action="" method="post">
<div class="scrollable">
<table cellspacing="0" class="nowrap checkable">
',script("mixin(qsl('table'), {onclick: tableClick, ondblclick: partialArg(tableClick, true)});");$t=-1;foreach(process_list()as$t=>$L){if(!$t){echo"<thead><tr lang='en'>".(support("kill")?"<th>":"");foreach($L
as$z=>$X)echo"<th>$z".doc_link(array('sql'=>"show-processlist.html#processlist_".strtolower($z),'pgsql'=>"monitoring-stats.html#PG-STAT-ACTIVITY-VIEW",'oracle'=>"../b14237/dynviews_2088.htm",));echo"</thead>\n";}echo"<tr".odd().">".(support("kill")?"<td>".checkbox("kill[]",$L[$y=="sql"?"Id":"pid"],0):"");foreach($L
as$z=>$X)echo"<td>".(($y=="sql"&&$z=="Info"&&preg_match("~Query|Killed~",$L["Command"])&&$X!="")||($y=="pgsql"&&$z=="current_query"&&$X!="<IDLE>")||($y=="oracle"&&$z=="sql_text"&&$X!="")?"<code class='jush-$y'>".shorten_utf8($X,100,"</code>").' <a href="'.h(ME.($L["db"]!=""?"db=".urlencode($L["db"])."&":"")."sql=".urlencode($X)).'">'.lang(227).'</a>':h($X));echo"\n";}echo'</table>
</div>
<p>
';if(support("kill")){echo($t+1)."/".lang(228,max_connections()),"<p><input type='submit' value='".lang(229)."'>\n";}echo'<input type="hidden" name="token" value="',$T,'">
</form>
',script("tableCheck();");}elseif(isset($_GET["select"])){$a=$_GET["select"];$R=table_status1($a);$x=indexes($a);$n=fields($a);$zc=column_foreign_keys($a);$ge=$R["Oid"];parse_str($_COOKIE["adminer_import"],$na);$yf=array();$d=array();$_g=null;foreach($n
as$z=>$m){$E=$b->fieldName($m);if(isset($m["privileges"]["select"])&&$E!=""){$d[$z]=html_entity_decode(strip_tags($E),ENT_QUOTES);if(is_shortable($m))$_g=$b->selectLengthProcess();}$yf+=$m["privileges"];}list($N,$s)=$b->selectColumnsProcess($d,$x);$gd=count($s)<count($N);$Z=$b->selectSearchProcess($n,$x);$ue=$b->selectOrderProcess($n,$x);$_=$b->selectLimitProcess();if($_GET["val"]&&is_ajax()){header("Content-Type: text/plain; charset=utf-8");foreach($_GET["val"]as$Yg=>$L){$va=convert_field($n[key($L)]);$N=array($va?$va:idf_escape(key($L)));$Z[]=where_check($Yg,$n);$K=$k->select($a,$N,$Z,$N);if($K)echo
reset($K->fetch_row());}exit;}$Ze=$ah=null;foreach($x
as$w){if($w["type"]=="PRIMARY"){$Ze=array_flip($w["columns"]);$ah=($N?$Ze:array());foreach($ah
as$z=>$X){if(in_array(idf_escape($z),$N))unset($ah[$z]);}break;}}if($ge&&!$Ze){$Ze=$ah=array($ge=>0);$x[]=array("type"=>"PRIMARY","columns"=>array($ge));}if($_POST&&!$l){$vh=$Z;if(!$_POST["all"]&&is_array($_POST["check"])){$Pa=array();foreach($_POST["check"]as$Na)$Pa[]=where_check($Na,$n);$vh[]="((".implode(") OR (",$Pa)."))";}$vh=($vh?"\nWHERE ".implode(" AND ",$vh):"");if($_POST["export"]){cookie("adminer_import","output=".urlencode($_POST["output"])."&format=".urlencode($_POST["format"]));dump_headers($a);$b->dumpTable($a,"");$Cc=($N?implode(", ",$N):"*").convert_fields($d,$n,$N)."\nFROM ".table($a);$Gc=($s&&$gd?"\nGROUP BY ".implode(", ",$s):"").($ue?"\nORDER BY ".implode(", ",$ue):"");if(!is_array($_POST["check"])||$Ze)$I="SELECT $Cc$vh$Gc";else{$Wg=array();foreach($_POST["check"]as$X)$Wg[]="(SELECT".limit($Cc,"\nWHERE ".($Z?implode(" AND ",$Z)." AND ":"").where_check($X,$n).$Gc,1).")";$I=implode(" UNION ALL ",$Wg);}$b->dumpData($a,"table",$I);exit;}if(!$b->selectEmailProcess($Z,$zc)){if($_POST["save"]||$_POST["delete"]){$J=true;$oa=0;$P=array();if(!$_POST["delete"]){foreach($d
as$E=>$X){$X=process_input($n[$E]);if($X!==null&&($_POST["clone"]||$X!==false))$P[idf_escape($E)]=($X!==false?$X:idf_escape($E));}}if($_POST["delete"]||$P){if($_POST["clone"])$I="INTO ".table($a)." (".implode(", ",array_keys($P)).")\nSELECT ".implode(", ",$P)."\nFROM ".table($a);if($_POST["all"]||($Ze&&is_array($_POST["check"]))||$gd){$J=($_POST["delete"]?$k->delete($a,$vh):($_POST["clone"]?queries("INSERT $I$vh"):$k->update($a,$P,$vh)));$oa=$f->affected_rows;}else{foreach((array)$_POST["check"]as$X){$uh="\nWHERE ".($Z?implode(" AND ",$Z)." AND ":"").where_check($X,$n);$J=($_POST["delete"]?$k->delete($a,$uh,1):($_POST["clone"]?queries("INSERT".limit1($a,$I,$uh)):$k->update($a,$P,$uh,1)));if(!$J)break;$oa+=$f->affected_rows;}}}$D=lang(230,$oa);if($_POST["clone"]&&$J&&$oa==1){$td=last_id();if($td)$D=lang(161," $td");}queries_redirect(remove_from_uri($_POST["all"]&&$_POST["delete"]?"page":""),$D,$J);if(!$_POST["delete"]){edit_form($a,$n,(array)$_POST["fields"],!$_POST["clone"]);page_footer();exit;}}elseif(!$_POST["import"]){if(!$_POST["val"])$l=lang(231);else{$J=true;$oa=0;foreach($_POST["val"]as$Yg=>$L){$P=array();foreach($L
as$z=>$X){$z=bracket_escape($z,1);$P[idf_escape($z)]=(preg_match('~char|text~',$n[$z]["type"])||$X!=""?$b->processInput($n[$z],$X):"NULL");}$J=$k->update($a,$P," WHERE ".($Z?implode(" AND ",$Z)." AND ":"").where_check($Yg,$n),!$gd&&!$Ze," ");if(!$J)break;$oa+=$f->affected_rows;}queries_redirect(remove_from_uri(),lang(230,$oa),$J);}}elseif(!is_string($rc=get_file("csv_file",true)))$l=upload_error($rc);elseif(!preg_match('~~u',$rc))$l=lang(232);else{cookie("adminer_import","output=".urlencode($na["output"])."&format=".urlencode($_POST["separator"]));$J=true;$Za=array_keys($n);preg_match_all('~(?>"[^"]*"|[^"\r\n]+)+~',$rc,$Fd);$oa=count($Fd[0]);$k->begin();$Lf=($_POST["separator"]=="csv"?",":($_POST["separator"]=="tsv"?"\t":";"));$M=array();foreach($Fd[0]as$z=>$X){preg_match_all("~((?>\"[^\"]*\")+|[^$Lf]*)$Lf~",$X.$Lf,$Gd);if(!$z&&!array_diff($Gd[1],$Za)){$Za=$Gd[1];$oa--;}else{$P=array();foreach($Gd[1]as$t=>$Va)$P[idf_escape($Za[$t])]=($Va==""&&$n[$Za[$t]]["null"]?"NULL":q(str_replace('""','"',preg_replace('~^"|"$~','',$Va))));$M[]=$P;}}$J=(!$M||$k->insertUpdate($a,$M,$Ze));if($J)$J=$k->commit();queries_redirect(remove_from_uri("page"),lang(233,$oa),$J);$k->rollback();}}}$og=$b->tableName($R);if(is_ajax()){page_headers();ob_start();}else
page_header(lang(49).": $og",$l);$P=null;if(isset($yf["insert"])||!support("table")){$P="";foreach((array)$_GET["where"]as$X){if($zc[$X["col"]]&&count($zc[$X["col"]])==1&&($X["op"]=="="||(!$X["op"]&&!preg_match('~[_%]~',$X["val"]))))$P.="&set".urlencode("[".bracket_escape($X["col"])."]")."=".urlencode($X["val"]);}}$b->selectLinks($R,$P);if(!$d&&support("table"))echo"<p class='error'>".lang(234).($n?".":": ".error())."\n";else{echo"<form action='' id='form'>\n","<div style='display: none;'>";hidden_fields_get();echo(DB!=""?'<input type="hidden" name="db" value="'.h(DB).'">'.(isset($_GET["ns"])?'<input type="hidden" name="ns" value="'.h($_GET["ns"]).'">':""):"");echo'<input type="hidden" name="select" value="'.h($a).'">',"</div>\n";$b->selectColumnsPrint($N,$d);$b->selectSearchPrint($Z,$d,$x);$b->selectOrderPrint($ue,$d,$x);$b->selectLimitPrint($_);$b->selectLengthPrint($_g);$b->selectActionPrint($x);echo"</form>\n";$F=$_GET["page"];if($F=="last"){$Bc=$f->result(count_rows($a,$Z,$gd,$s));$F=floor(max(0,$Bc-1)/$_);}$Gf=$N;$Fc=$s;if(!$Gf){$Gf[]="*";$ib=convert_fields($d,$n,$N);if($ib)$Gf[]=substr($ib,2);}foreach($N
as$z=>$X){$m=$n[idf_unescape($X)];if($m&&($va=convert_field($m)))$Gf[$z]="$va AS $X";}if(!$gd&&$ah){foreach($ah
as$z=>$X){$Gf[]=idf_escape($z);if($Fc)$Fc[]=idf_escape($z);}}$J=$k->select($a,$Gf,$Z,$Fc,$ue,$_,$F,true);if(!$J)echo"<p class='error'>".error()."\n";else{if($y=="mssql"&&$F)$J->seek($_*$F);$Vb=array();echo"<form action='' method='post' enctype='multipart/form-data'>\n";$M=array();while($L=$J->fetch_assoc()){if($F&&$y=="oracle")unset($L["RNUM"]);$M[]=$L;}if($_GET["page"]!="last"&&$_!=""&&$s&&$gd&&$y=="sql")$Bc=$f->result(" SELECT FOUND_ROWS()");if(!$M)echo"<p class='message'>".lang(12)."\n";else{$Ca=$b->backwardKeys($a,$og);echo"<div class='scrollable'>","<table id='table' cellspacing='0' class='nowrap checkable'>",script("mixin(qs('#table'), {onclick: tableClick, ondblclick: partialArg(tableClick, true), onkeydown: editingKeydown});"),"<thead><tr>".(!$s&&$N?"":"<td><input type='checkbox' id='all-page' class='jsonly'>".script("qs('#all-page').onclick = partial(formCheck, /check/);","")." <a href='".h($_GET["modify"]?remove_from_uri("modify"):$_SERVER["REQUEST_URI"]."&modify=1")."'>".lang(235)."</a>");$Wd=array();$Dc=array();reset($N);$lf=1;foreach($M[0]as$z=>$X){if(!isset($ah[$z])){$X=$_GET["columns"][key($N)];$m=$n[$N?($X?$X["col"]:current($N)):$z];$E=($m?$b->fieldName($m,$lf):($X["fun"]?"*":$z));if($E!=""){$lf++;$Wd[$z]=$E;$c=idf_escape($z);$Sc=remove_from_uri('(order|desc)[^=]*|page').'&order%5B0%5D='.urlencode($z);$Ab="&desc%5B0%5D=1";echo"<th>".script("mixin(qsl('th'), {onmouseover: partial(columnMouse), onmouseout: partial(columnMouse, ' hidden')});",""),'<a href="'.h($Sc.($ue[0]==$c||$ue[0]==$z||(!$ue&&$gd&&$s[0]==$c)?$Ab:'')).'">';echo
apply_sql_function($X["fun"],$E)."</a>";echo"<span class='column hidden'>","<a href='".h($Sc.$Ab)."' title='".lang(55)."' class='text'> â†“</a>";if(!$X["fun"]){echo'<a href="#fieldset-search" title="'.lang(52).'" class="text jsonly"> =</a>',script("qsl('a').onclick = partial(selectSearch, '".js_escape($z)."');");}echo"</span>";}$Dc[$z]=$X["fun"];next($N);}}$zd=array();if($_GET["modify"]){foreach($M
as$L){foreach($L
as$z=>$X)$zd[$z]=max($zd[$z],min(40,strlen(utf8_decode($X))));}}echo($Ca?"<th>".lang(236):"")."</thead>\n";if(is_ajax()){if($_%2==1&&$F%2==1)odd();ob_end_clean();}foreach($b->rowDescriptions($M,$zc)as$Vd=>$L){$Xg=unique_array($M[$Vd],$x);if(!$Xg){$Xg=array();foreach($M[$Vd]as$z=>$X){if(!preg_match('~^(COUNT\((\*|(DISTINCT )?`(?:[^`]|``)+`)\)|(AVG|GROUP_CONCAT|MAX|MIN|SUM)\(`(?:[^`]|``)+`\))$~',$z))$Xg[$z]=$X;}}$Yg="";foreach($Xg
as$z=>$X){if(($y=="sql"||$y=="pgsql")&&preg_match('~char|text|enum|set~',$n[$z]["type"])&&strlen($X)>64){$z=(strpos($z,'(')?$z:idf_escape($z));$z="MD5(".($y!='sql'||preg_match("~^utf8~",$n[$z]["collation"])?$z:"CONVERT($z USING ".charset($f).")").")";$X=md5($X);}$Yg.="&".($X!==null?urlencode("where[".bracket_escape($z)."]")."=".urlencode($X):"null%5B%5D=".urlencode($z));}echo"<tr".odd().">".(!$s&&$N?"":"<td>".checkbox("check[]",substr($Yg,1),in_array(substr($Yg,1),(array)$_POST["check"])).($gd||information_schema(DB)?"":" <a href='".h(ME."edit=".urlencode($a).$Yg)."' class='edit'>".lang(237)."</a>"));foreach($L
as$z=>$X){if(isset($Wd[$z])){$m=$n[$z];$X=$k->value($X,$m);if($X!=""&&(!isset($Vb[$z])||$Vb[$z]!=""))$Vb[$z]=(is_mail($X)?$Wd[$z]:"");$A="";if(preg_match('~blob|bytea|raw|file~',$m["type"])&&$X!="")$A=ME.'download='.urlencode($a).'&field='.urlencode($z).$Yg;if(!$A&&$X!==null){foreach((array)$zc[$z]as$o){if(count($zc[$z])==1||end($o["source"])==$z){$A="";foreach($o["source"]as$t=>$Vf)$A.=where_link($t,$o["target"][$t],$M[$Vd][$Vf]);$A=($o["db"]!=""?preg_replace('~([?&]db=)[^&]+~','\1'.urlencode($o["db"]),ME):ME).'select='.urlencode($o["table"]).$A;if($o["ns"])$A=preg_replace('~([?&]ns=)[^&]+~','\1'.urlencode($o["ns"]),$A);if(count($o["source"])==1)break;}}}if($z=="COUNT(*)"){$A=ME."select=".urlencode($a);$t=0;foreach((array)$_GET["where"]as$W){if(!array_key_exists($W["col"],$Xg))$A.=where_link($t++,$W["col"],$W["val"],$W["op"]);}foreach($Xg
as$kd=>$W)$A.=where_link($t++,$kd,$W);}$X=select_value($X,$A,$m,$_g);$u=h("val[$Yg][".bracket_escape($z)."]");$Y=$_POST["val"][$Yg][bracket_escape($z)];$Qb=!is_array($L[$z])&&is_utf8($X)&&$M[$Vd][$z]==$L[$z]&&!$Dc[$z];$zg=preg_match('~text|lob~',$m["type"]);if(($_GET["modify"]&&$Qb)||$Y!==null){$Jc=h($Y!==null?$Y:$L[$z]);echo"<td>".($zg?"<textarea name='$u' cols='30' rows='".(substr_count($L[$z],"\n")+1)."'>$Jc</textarea>":"<input name='$u' value='$Jc' size='$zd[$z]'>");}else{$Cd=strpos($X,"<i>â€¦</i>");echo"<td id='$u' data-text='".($Cd?2:($zg?1:0))."'".($Qb?"":" data-warning='".h(lang(238))."'").">$X</td>";}}}if($Ca)echo"<td>";$b->backwardKeysPrint($Ca,$M[$Vd]);echo"</tr>\n";}if(is_ajax())exit;echo"</table>\n","</div>\n";}if(!is_ajax()){if($M||$F){$fc=true;if($_GET["page"]!="last"){if($_==""||(count($M)<$_&&($M||!$F)))$Bc=($F?$F*$_:0)+count($M);elseif($y!="sql"||!$gd){$Bc=($gd?false:found_rows($R,$Z));if($Bc<max(1e4,2*($F+1)*$_))$Bc=reset(slow_query(count_rows($a,$Z,$gd,$s)));else$fc=false;}}$Fe=($_!=""&&($Bc===false||$Bc>$_||$F));if($Fe){echo(($Bc===false?count($M)+1:$Bc-$F*$_)>$_?'<p><a href="'.h(remove_from_uri("page")."&page=".($F+1)).'" class="loadmore">'.lang(239).'</a>'.script("qsl('a').onclick = partial(selectLoadMore, ".(+$_).", '".lang(240)."â€¦');",""):''),"\n";}}echo"<div class='footer'><div>\n";if($M||$F){if($Fe){$Id=($Bc===false?$F+(count($M)>=$_?2:1):floor(($Bc-1)/$_));echo"<fieldset>";if($y!="simpledb"){echo"<legend><a href='".h(remove_from_uri("page"))."'>".lang(241)."</a></legend>",script("qsl('a').onclick = function () { pageClick(this.href, +prompt('".lang(241)."', '".($F+1)."')); return false; };"),pagination(0,$F).($F>5?" â€¦":"");for($t=max(1,$F-4);$t<min($Id,$F+5);$t++)echo
pagination($t,$F);if($Id>0){echo($F+5<$Id?" â€¦":""),($fc&&$Bc!==false?pagination($Id,$F):" <a href='".h(remove_from_uri("page")."&page=last")."' title='~$Id'>".lang(242)."</a>");}}else{echo"<legend>".lang(241)."</legend>",pagination(0,$F).($F>1?" â€¦":""),($F?pagination($F,$F):""),($Id>$F?pagination($F+1,$F).($Id>$F+1?" â€¦":""):"");}echo"</fieldset>\n";}echo"<fieldset>","<legend>".lang(243)."</legend>";$Fb=($fc?"":"~ ").$Bc;echo
checkbox("all",1,0,($Bc!==false?($fc?"":"~ ").lang(143,$Bc):""),"var checked = formChecked(this, /check/); selectCount('selected', this.checked ? '$Fb' : checked); selectCount('selected2', this.checked || !checked ? '$Fb' : checked);")."\n","</fieldset>\n";if($b->selectCommandPrint()){echo'<fieldset',($_GET["modify"]?'':' class="jsonly"'),'><legend>',lang(235),'</legend><div>
<input type="submit" value="',lang(14),'"',($_GET["modify"]?'':' title="'.lang(231).'"'),'>
</div></fieldset>
<fieldset><legend>',lang(120),' <span id="selected"></span></legend><div>
<input type="submit" name="edit" value="',lang(10),'">
<input type="submit" name="clone" value="',lang(227),'">
<input type="submit" name="delete" value="',lang(18),'">',confirm(),'</div></fieldset>
';}$_c=$b->dumpFormat();foreach((array)$_GET["columns"]as$c){if($c["fun"]){unset($_c['sql']);break;}}if($_c){print_fieldset("export",lang(69)." <span id='selected2'></span>");$De=$b->dumpOutput();echo($De?html_select("output",$De,$na["output"])." ":""),html_select("format",$_c,$na["format"])," <input type='submit' name='export' value='".lang(69)."'>\n","</div></fieldset>\n";}$b->selectEmailPrint(array_filter($Vb,'strlen'),$d);}echo"</div></div>\n";if($b->selectImportPrint()){echo"<div>","<a href='#import'>".lang(68)."</a>",script("qsl('a').onclick = partial(toggle, 'import');",""),"<span id='import' class='hidden'>: ","<input type='file' name='csv_file'> ",html_select("separator",array("csv"=>"CSV,","csv;"=>"CSV;","tsv"=>"TSV"),$na["format"],1);echo" <input type='submit' name='import' value='".lang(68)."'>","</span>","</div>";}echo"<input type='hidden' name='token' value='$T'>\n","</form>\n",(!$s&&$N?"":script("tableCheck();"));}}}if(is_ajax()){ob_end_clean();exit;}}elseif(isset($_GET["variables"])){$cg=isset($_GET["status"]);page_header($cg?lang(112):lang(111));$lh=($cg?show_status():show_variables());if(!$lh)echo"<p class='message'>".lang(12)."\n";else{echo"<table cellspacing='0'>\n";foreach($lh
as$z=>$X){echo"<tr>","<th><code class='jush-".$y.($cg?"status":"set")."'>".h($z)."</code>","<td>".h($X);}echo"</table>\n";}}elseif(isset($_GET["script"])){header("Content-Type: text/javascript; charset=utf-8");if($_GET["script"]=="db"){$lg=array("Data_length"=>0,"Index_length"=>0,"Data_free"=>0);foreach(table_status()as$E=>$R){json_row("Comment-$E",h($R["Comment"]));if(!is_view($R)){foreach(array("Engine","Collation")as$z)json_row("$z-$E",h($R[$z]));foreach($lg+array("Auto_increment"=>0,"Rows"=>0)as$z=>$X){if($R[$z]!=""){$X=format_number($R[$z]);json_row("$z-$E",($z=="Rows"&&$X&&$R["Engine"]==($Xf=="pgsql"?"table":"InnoDB")?"~ $X":$X));if(isset($lg[$z]))$lg[$z]+=($R["Engine"]!="InnoDB"||$z!="Data_free"?$R[$z]:0);}elseif(array_key_exists($z,$R))json_row("$z-$E");}}}foreach($lg
as$z=>$X)json_row("sum-$z",format_number($X));json_row("");}elseif($_GET["script"]=="kill")$f->query("KILL ".number($_POST["kill"]));else{foreach(count_tables($b->databases())as$j=>$X){json_row("tables-$j",$X);json_row("size-$j",db_size($j));}json_row("");}exit;}else{$tg=array_merge((array)$_POST["tables"],(array)$_POST["views"]);if($tg&&!$l&&!$_POST["search"]){$J=true;$D="";if($y=="sql"&&$_POST["tables"]&&count($_POST["tables"])>1&&($_POST["drop"]||$_POST["truncate"]||$_POST["copy"]))queries("SET foreign_key_checks = 0");if($_POST["truncate"]){if($_POST["tables"])$J=truncate_tables($_POST["tables"]);$D=lang(244);}elseif($_POST["move"]){$J=move_tables((array)$_POST["tables"],(array)$_POST["views"],$_POST["target"]);$D=lang(245);}elseif($_POST["copy"]){$J=copy_tables((array)$_POST["tables"],(array)$_POST["views"],$_POST["target"]);$D=lang(246);}elseif($_POST["drop"]){if($_POST["views"])$J=drop_views($_POST["views"]);if($J&&$_POST["tables"])$J=drop_tables($_POST["tables"]);$D=lang(247);}elseif($y!="sql"){$J=($y=="sqlite"?queries("VACUUM"):apply_queries("VACUUM".($_POST["optimize"]?"":" ANALYZE"),$_POST["tables"]));$D=lang(248);}elseif(!$_POST["tables"])$D=lang(9);elseif($J=queries(($_POST["optimize"]?"OPTIMIZE":($_POST["check"]?"CHECK":($_POST["repair"]?"REPAIR":"ANALYZE")))." TABLE ".implode(", ",array_map('idf_escape',$_POST["tables"])))){while($L=$J->fetch_assoc())$D.="<b>".h($L["Table"])."</b>: ".h($L["Msg_text"])."<br>";}queries_redirect(substr(ME,0,-1),$D,$J);}page_header(($_GET["ns"]==""?lang(33).": ".h(DB):lang(249).": ".h($_GET["ns"])),$l,true);if($b->homepage()){if($_GET["ns"]!==""){echo"<h3 id='tables-views'>".lang(250)."</h3>\n";$sg=tables_list();if(!$sg)echo"<p class='message'>".lang(9)."\n";else{echo"<form action='' method='post'>\n";if(support("table")){echo"<fieldset><legend>".lang(251)." <span id='selected2'></span></legend><div>","<input type='search' name='query' value='".h($_POST["query"])."'>",script("qsl('input').onkeydown = partialArg(bodyKeydown, 'search');","")," <input type='submit' name='search' value='".lang(52)."'>\n","</div></fieldset>\n";if($_POST["search"]&&$_POST["query"]!=""){$_GET["where"][0]["op"]="LIKE %%";search_tables();}}$Gb=doc_link(array('sql'=>'show-table-status.html'));echo"<div class='scrollable'>\n","<table cellspacing='0' class='nowrap checkable'>\n",script("mixin(qsl('table'), {onclick: tableClick, ondblclick: partialArg(tableClick, true)});"),'<thead><tr class="wrap">','<td><input id="check-all" type="checkbox" class="jsonly">'.script("qs('#check-all').onclick = partial(formCheck, /^(tables|views)\[/);",""),'<th>'.lang(124),'<td>'.lang(252).doc_link(array('sql'=>'storage-engines.html')),'<td>'.lang(116).doc_link(array('sql'=>'charset-charsets.html','mariadb'=>'supported-character-sets-and-collations/')),'<td>'.lang(253).$Gb,'<td>'.lang(254).$Gb,'<td>'.lang(255).$Gb,'<td>'.lang(47).doc_link(array('sql'=>'example-auto-increment.html','mariadb'=>'auto_increment/')),'<td>'.lang(256).$Gb,(support("comment")?'<td>'.lang(46).$Gb:''),"</thead>\n";$S=0;foreach($sg
as$E=>$U){$oh=($U!==null&&!preg_match('~table~i',$U));$u=h("Table-".$E);echo'<tr'.odd().'><td>'.checkbox(($oh?"views[]":"tables[]"),$E,in_array($E,$tg,true),"","","",$u),'<th>'.(support("table")||support("indexes")?"<a href='".h(ME)."table=".urlencode($E)."' title='".lang(38)."' id='$u'>".h($E).'</a>':h($E));if($oh){echo'<td colspan="6"><a href="'.h(ME)."view=".urlencode($E).'" title="'.lang(39).'">'.(preg_match('~materialized~i',$U)?lang(122):lang(123)).'</a>','<td align="right"><a href="'.h(ME)."select=".urlencode($E).'" title="'.lang(37).'">?</a>';}else{foreach(array("Engine"=>array(),"Collation"=>array(),"Data_length"=>array("create",lang(40)),"Index_length"=>array("indexes",lang(126)),"Data_free"=>array("edit",lang(41)),"Auto_increment"=>array("auto_increment=1&create",lang(40)),"Rows"=>array("select",lang(37)),)as$z=>$A){$u=" id='$z-".h($E)."'";echo($A?"<td align='right'>".(support("table")||$z=="Rows"||(support("indexes")&&$z!="Data_length")?"<a href='".h(ME."$A[0]=").urlencode($E)."'$u title='$A[1]'>?</a>":"<span$u>?</span>"):"<td id='$z-".h($E)."'>");}$S++;}echo(support("comment")?"<td id='Comment-".h($E)."'>":"");}echo"<tr><td><th>".lang(228,count($sg)),"<td>".h($y=="sql"?$f->result("SELECT @@storage_engine"):""),"<td>".h(db_collation(DB,collations()));foreach(array("Data_length","Index_length","Data_free")as$z)echo"<td align='right' id='sum-$z'>";echo"</table>\n","</div>\n";if(!information_schema(DB)){echo"<div class='footer'><div>\n";$jh="<input type='submit' value='".lang(257)."'> ".on_help("'VACUUM'");$re="<input type='submit' name='optimize' value='".lang(258)."'> ".on_help($y=="sql"?"'OPTIMIZE TABLE'":"'VACUUM OPTIMIZE'");echo"<fieldset><legend>".lang(120)." <span id='selected'></span></legend><div>".($y=="sqlite"?$jh:($y=="pgsql"?$jh.$re:($y=="sql"?"<input type='submit' value='".lang(259)."'> ".on_help("'ANALYZE TABLE'").$re."<input type='submit' name='check' value='".lang(260)."'> ".on_help("'CHECK TABLE'")."<input type='submit' name='repair' value='".lang(261)."'> ".on_help("'REPAIR TABLE'"):"")))."<input type='submit' name='truncate' value='".lang(262)."'> ".on_help($y=="sqlite"?"'DELETE'":"'TRUNCATE".($y=="pgsql"?"'":" TABLE'")).confirm()."<input type='submit' name='drop' value='".lang(121)."'>".on_help("'DROP TABLE'").confirm()."\n";$i=(support("scheme")?$b->schemas():$b->databases());if(count($i)!=1&&$y!="sqlite"){$j=(isset($_POST["target"])?$_POST["target"]:(support("scheme")?$_GET["ns"]:DB));echo"<p>".lang(263).": ",($i?html_select("target",$i,$j):'<input name="target" value="'.h($j).'" autocapitalize="off">')," <input type='submit' name='move' value='".lang(264)."'>",(support("copy")?" <input type='submit' name='copy' value='".lang(265)."'>":""),"\n";}echo"<input type='hidden' name='all' value=''>";echo
script("qsl('input').onclick = function () { selectCount('selected', formChecked(this, /^(tables|views)\[/));".(support("table")?" selectCount('selected2', formChecked(this, /^tables\[/) || $S);":"")." }"),"<input type='hidden' name='token' value='$T'>\n","</div></fieldset>\n","</div></div>\n";}echo"</form>\n",script("tableCheck();");}echo'<p class="links"><a href="'.h(ME).'create=">'.lang(70)."</a>\n",(support("view")?'<a href="'.h(ME).'view=">'.lang(194)."</a>\n":"");if(support("routine")){echo"<h3 id='routines'>".lang(136)."</h3>\n";$Bf=routines();if($Bf){echo"<table cellspacing='0'>\n",'<thead><tr><th>'.lang(176).'<td>'.lang(45).'<td>'.lang(211)."<td></thead>\n";odd('');foreach($Bf
as$L){$E=($L["SPECIFIC_NAME"]==$L["ROUTINE_NAME"]?"":"&name=".urlencode($L["ROUTINE_NAME"]));echo'<tr'.odd().'>','<th><a href="'.h(ME.($L["ROUTINE_TYPE"]!="PROCEDURE"?'callf=':'call=').urlencode($L["SPECIFIC_NAME"]).$E).'">'.h($L["ROUTINE_NAME"]).'</a>','<td>'.h($L["ROUTINE_TYPE"]),'<td>'.h($L["DTD_IDENTIFIER"]),'<td><a href="'.h(ME.($L["ROUTINE_TYPE"]!="PROCEDURE"?'function=':'procedure=').urlencode($L["SPECIFIC_NAME"]).$E).'">'.lang(129)."</a>";}echo"</table>\n";}echo'<p class="links">'.(support("procedure")?'<a href="'.h(ME).'procedure=">'.lang(210).'</a>':'').'<a href="'.h(ME).'function=">'.lang(209)."</a>\n";}if(support("event")){echo"<h3 id='events'>".lang(137)."</h3>\n";$M=get_rows("SHOW EVENTS");if($M){echo"<table cellspacing='0'>\n","<thead><tr><th>".lang(176)."<td>".lang(266)."<td>".lang(200)."<td>".lang(201)."<td></thead>\n";foreach($M
as$L){echo"<tr>","<th>".h($L["Name"]),"<td>".($L["Execute at"]?lang(267)."<td>".$L["Execute at"]:lang(202)." ".$L["Interval value"]." ".$L["Interval field"]."<td>$L[Starts]"),"<td>$L[Ends]",'<td><a href="'.h(ME).'event='.urlencode($L["Name"]).'">'.lang(129).'</a>';}echo"</table>\n";$dc=$f->result("SELECT @@event_scheduler");if($dc&&$dc!="ON")echo"<p class='error'><code class='jush-sqlset'>event_scheduler</code>: ".h($dc)."\n";}echo'<p class="links"><a href="'.h(ME).'event=">'.lang(199)."</a>\n";}if($sg)echo
script("ajaxSetHtml('".js_escape(ME)."script=db');");}}}page_footer();n
